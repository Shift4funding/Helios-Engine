import { connect, disconnect } from '../setup/testDb';
import request from 'supertest';
import app from '../../src/app'; // Adjust the path as necessary
import { createUser, loginUser } from '../../src/controllers/userController'; // Adjust the path as necessary

describe('Statement API Integration Tests', () => {
  let authToken;

  beforeAll(async () => {
    await connect();
    const user = await createUser({ username: 'testuser', password: 'password' });
    authToken = await loginUser({ username: user.username, password: 'password' });
  });

  afterAll(async () => {
    await disconnect();
  });

  it('should respond to health check', async () => {
    const response = await request(app).get('/health');
    expect(response.status).toBe(200);
  });

  it('should require authentication for protected routes', async () => {
    const response = await request(app).get('/api/statements');
    expect(response.status).toBe(401);
  });

  // Add more tests here, ensuring to use authToken where necessary
});