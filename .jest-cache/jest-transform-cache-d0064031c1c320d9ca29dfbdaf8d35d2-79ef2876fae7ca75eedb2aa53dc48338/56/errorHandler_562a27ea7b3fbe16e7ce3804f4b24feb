b210aead4658cdbea868781b529f35a4
"use strict";

const logger = require('../config/logger');
class AppError extends Error {
  constructor(statusCode, message) {
    super(message);
    this.statusCode = statusCode;
    this.status = `${statusCode}`.startsWith('4') ? 'fail' : 'error';
    Error.captureStackTrace(this, this.constructor);
  }
}
const errorHandler = (err, req, res, next) => {
  err.statusCode = err.statusCode || 500;
  err.status = err.status || 'error';
  if (process.env.NODE_ENV === 'development') {
    logger.error('Error ðŸ’¥:', {
      status: err.status,
      error: err,
      message: err.message,
      stack: err.stack
    });
    return res.status(err.statusCode).json({
      status: err.status,
      error: err,
      message: err.message,
      stack: err.stack
    });
  }

  // Production error response
  logger.error('Error ðŸ’¥:', err);
  if (err.isOperational) {
    return res.status(err.statusCode).json({
      status: err.status,
      message: err.message
    });
  }

  // Programming or unknown errors
  return res.status(500).json({
    status: 'error',
    message: 'Something went wrong!'
  });
};
module.exports = {
  AppError,
  errorHandler
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJsb2dnZXIiLCJyZXF1aXJlIiwiQXBwRXJyb3IiLCJFcnJvciIsImNvbnN0cnVjdG9yIiwic3RhdHVzQ29kZSIsIm1lc3NhZ2UiLCJzdGF0dXMiLCJzdGFydHNXaXRoIiwiY2FwdHVyZVN0YWNrVHJhY2UiLCJlcnJvckhhbmRsZXIiLCJlcnIiLCJyZXEiLCJyZXMiLCJuZXh0IiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwiZXJyb3IiLCJzdGFjayIsImpzb24iLCJpc09wZXJhdGlvbmFsIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbImVycm9ySGFuZGxlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBsb2dnZXIgPSByZXF1aXJlKCcuLi9jb25maWcvbG9nZ2VyJyk7XHJcblxyXG5jbGFzcyBBcHBFcnJvciBleHRlbmRzIEVycm9yIHtcclxuICAgIGNvbnN0cnVjdG9yKHN0YXR1c0NvZGUsIG1lc3NhZ2UpIHtcclxuICAgICAgICBzdXBlcihtZXNzYWdlKTtcclxuICAgICAgICB0aGlzLnN0YXR1c0NvZGUgPSBzdGF0dXNDb2RlO1xyXG4gICAgICAgIHRoaXMuc3RhdHVzID0gYCR7c3RhdHVzQ29kZX1gLnN0YXJ0c1dpdGgoJzQnKSA/ICdmYWlsJyA6ICdlcnJvcic7XHJcbiAgICAgICAgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgdGhpcy5jb25zdHJ1Y3Rvcik7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNvbnN0IGVycm9ySGFuZGxlciA9IChlcnIsIHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgICBlcnIuc3RhdHVzQ29kZSA9IGVyci5zdGF0dXNDb2RlIHx8IDUwMDtcclxuICAgIGVyci5zdGF0dXMgPSBlcnIuc3RhdHVzIHx8ICdlcnJvcic7XHJcblxyXG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XHJcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciDwn5KlOicsIHtcclxuICAgICAgICAgICAgc3RhdHVzOiBlcnIuc3RhdHVzLFxyXG4gICAgICAgICAgICBlcnJvcjogZXJyLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiBlcnIubWVzc2FnZSxcclxuICAgICAgICAgICAgc3RhY2s6IGVyci5zdGFja1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyhlcnIuc3RhdHVzQ29kZSkuanNvbih7XHJcbiAgICAgICAgICAgIHN0YXR1czogZXJyLnN0YXR1cyxcclxuICAgICAgICAgICAgZXJyb3I6IGVycixcclxuICAgICAgICAgICAgbWVzc2FnZTogZXJyLm1lc3NhZ2UsXHJcbiAgICAgICAgICAgIHN0YWNrOiBlcnIuc3RhY2tcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBQcm9kdWN0aW9uIGVycm9yIHJlc3BvbnNlXHJcbiAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIPCfkqU6JywgZXJyKTtcclxuXHJcbiAgICBpZiAoZXJyLmlzT3BlcmF0aW9uYWwpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyhlcnIuc3RhdHVzQ29kZSkuanNvbih7XHJcbiAgICAgICAgICAgIHN0YXR1czogZXJyLnN0YXR1cyxcclxuICAgICAgICAgICAgbWVzc2FnZTogZXJyLm1lc3NhZ2VcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBQcm9ncmFtbWluZyBvciB1bmtub3duIGVycm9yc1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICBzdGF0dXM6ICdlcnJvcicsXHJcbiAgICAgICAgbWVzc2FnZTogJ1NvbWV0aGluZyB3ZW50IHdyb25nISdcclxuICAgIH0pO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7IEFwcEVycm9yLCBlcnJvckhhbmRsZXIgfTsiXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTUEsTUFBTSxHQUFHQyxPQUFPLENBQUMsa0JBQWtCLENBQUM7QUFFMUMsTUFBTUMsUUFBUSxTQUFTQyxLQUFLLENBQUM7RUFDekJDLFdBQVdBLENBQUNDLFVBQVUsRUFBRUMsT0FBTyxFQUFFO0lBQzdCLEtBQUssQ0FBQ0EsT0FBTyxDQUFDO0lBQ2QsSUFBSSxDQUFDRCxVQUFVLEdBQUdBLFVBQVU7SUFDNUIsSUFBSSxDQUFDRSxNQUFNLEdBQUcsR0FBR0YsVUFBVSxFQUFFLENBQUNHLFVBQVUsQ0FBQyxHQUFHLENBQUMsR0FBRyxNQUFNLEdBQUcsT0FBTztJQUNoRUwsS0FBSyxDQUFDTSxpQkFBaUIsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDTCxXQUFXLENBQUM7RUFDbkQ7QUFDSjtBQUVBLE1BQU1NLFlBQVksR0FBR0EsQ0FBQ0MsR0FBRyxFQUFFQyxHQUFHLEVBQUVDLEdBQUcsRUFBRUMsSUFBSSxLQUFLO0VBQzFDSCxHQUFHLENBQUNOLFVBQVUsR0FBR00sR0FBRyxDQUFDTixVQUFVLElBQUksR0FBRztFQUN0Q00sR0FBRyxDQUFDSixNQUFNLEdBQUdJLEdBQUcsQ0FBQ0osTUFBTSxJQUFJLE9BQU87RUFFbEMsSUFBSVEsT0FBTyxDQUFDQyxHQUFHLENBQUNDLFFBQVEsS0FBSyxhQUFhLEVBQUU7SUFDeENqQixNQUFNLENBQUNrQixLQUFLLENBQUMsV0FBVyxFQUFFO01BQ3RCWCxNQUFNLEVBQUVJLEdBQUcsQ0FBQ0osTUFBTTtNQUNsQlcsS0FBSyxFQUFFUCxHQUFHO01BQ1ZMLE9BQU8sRUFBRUssR0FBRyxDQUFDTCxPQUFPO01BQ3BCYSxLQUFLLEVBQUVSLEdBQUcsQ0FBQ1E7SUFDZixDQUFDLENBQUM7SUFFRixPQUFPTixHQUFHLENBQUNOLE1BQU0sQ0FBQ0ksR0FBRyxDQUFDTixVQUFVLENBQUMsQ0FBQ2UsSUFBSSxDQUFDO01BQ25DYixNQUFNLEVBQUVJLEdBQUcsQ0FBQ0osTUFBTTtNQUNsQlcsS0FBSyxFQUFFUCxHQUFHO01BQ1ZMLE9BQU8sRUFBRUssR0FBRyxDQUFDTCxPQUFPO01BQ3BCYSxLQUFLLEVBQUVSLEdBQUcsQ0FBQ1E7SUFDZixDQUFDLENBQUM7RUFDTjs7RUFFQTtFQUNBbkIsTUFBTSxDQUFDa0IsS0FBSyxDQUFDLFdBQVcsRUFBRVAsR0FBRyxDQUFDO0VBRTlCLElBQUlBLEdBQUcsQ0FBQ1UsYUFBYSxFQUFFO0lBQ25CLE9BQU9SLEdBQUcsQ0FBQ04sTUFBTSxDQUFDSSxHQUFHLENBQUNOLFVBQVUsQ0FBQyxDQUFDZSxJQUFJLENBQUM7TUFDbkNiLE1BQU0sRUFBRUksR0FBRyxDQUFDSixNQUFNO01BQ2xCRCxPQUFPLEVBQUVLLEdBQUcsQ0FBQ0w7SUFDakIsQ0FBQyxDQUFDO0VBQ047O0VBRUE7RUFDQSxPQUFPTyxHQUFHLENBQUNOLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ2EsSUFBSSxDQUFDO0lBQ3hCYixNQUFNLEVBQUUsT0FBTztJQUNmRCxPQUFPLEVBQUU7RUFDYixDQUFDLENBQUM7QUFDTixDQUFDO0FBRURnQixNQUFNLENBQUNDLE9BQU8sR0FBRztFQUFFckIsUUFBUTtFQUFFUTtBQUFhLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=