{"version":3,"names":["_getJestObj","mock","warn","jest","fn","require","validateRequest","validateFileUpload","ValidationError","body","describe","mockReq","mockRes","mockNext","beforeEach","path","headers","status","mockReturnThis","json","testValidations","isString","notEmpty","it","testField","expect","toHaveBeenCalledWith","toHaveBeenCalledTimes","any","file","mimetype","size","objectContaining","message","stringContaining","buffer","Buffer","from","originalname","analysisValidation","isISO8601","isIn","dateRange","start","end","metadata","requestedBy","priority"],"sources":["validateRequest.test.js"],"sourcesContent":["const { validateRequest, validateFileUpload } = require('../../src/middleware/validateRequest');\r\nconst { ValidationError } = require('../../src/utils/errors');\r\nconst { body } = require('express-validator');\r\n\r\n// Mock logger\r\njest.mock('../../src/config/logger', () => ({\r\n    warn: jest.fn()\r\n}));\r\n\r\ndescribe('Request Validation Middleware', () => {\r\n    let mockReq;\r\n    let mockRes;\r\n    let mockNext;\r\n\r\n    beforeEach(() => {\r\n        mockReq = {\r\n            path: '/test',\r\n            headers: {},\r\n            body: {}\r\n        };\r\n        mockRes = {\r\n            status: jest.fn().mockReturnThis(),\r\n            json: jest.fn()\r\n        };\r\n        mockNext = jest.fn();\r\n    });\r\n\r\n    describe('validateRequest', () => {\r\n        const testValidations = [\r\n            body('testField').isString().notEmpty()\r\n        ];\r\n\r\n        it('should pass valid request', async () => {\r\n            mockReq.body.testField = 'valid value';\r\n            \r\n            await validateRequest(testValidations)(mockReq, mockRes, mockNext);\r\n            \r\n            expect(mockNext).toHaveBeenCalledWith();\r\n            expect(mockNext).toHaveBeenCalledTimes(1);\r\n        });\r\n\r\n        it('should catch validation errors', async () => {\r\n            mockReq.body.testField = '';\r\n            \r\n            await validateRequest(testValidations)(mockReq, mockRes, mockNext);\r\n            \r\n            expect(mockNext).toHaveBeenCalledWith(\r\n                expect.any(ValidationError)\r\n            );\r\n        });\r\n    });\r\n\r\n    describe('validateFileUpload', () => {\r\n        it('should pass valid PDF file', () => {\r\n            mockReq.file = {\r\n                mimetype: 'application/pdf',\r\n                size: 1024 * 1024 // 1MB\r\n            };\r\n\r\n            validateFileUpload(mockReq, mockRes, mockNext);\r\n            \r\n            expect(mockNext).toHaveBeenCalledWith();\r\n            expect(mockNext).toHaveBeenCalledTimes(1);\r\n        });\r\n\r\n        it('should reject missing file', () => {\r\n            validateFileUpload(mockReq, mockRes, mockNext);\r\n            \r\n            expect(mockNext).toHaveBeenCalledWith(\r\n                expect.objectContaining({\r\n                    message: expect.stringContaining('No PDF file provided')\r\n                })\r\n            );\r\n        });\r\n\r\n        it('should reject non-PDF files', () => {\r\n            mockReq.file = {\r\n                mimetype: 'image/jpeg',\r\n                size: 1024\r\n            };\r\n\r\n            validateFileUpload(mockReq, mockRes, mockNext);\r\n            \r\n            expect(mockNext).toHaveBeenCalledWith(\r\n                expect.objectContaining({\r\n                    message: expect.stringContaining('Only PDF files are allowed')\r\n                })\r\n            );\r\n        });\r\n\r\n        it('should reject large files', () => {\r\n            mockReq.file = {\r\n                mimetype: 'application/pdf',\r\n                size: 11 * 1024 * 1024 // 11MB\r\n            };\r\n\r\n            validateFileUpload(mockReq, mockRes, mockNext);\r\n            \r\n            expect(mockNext).toHaveBeenCalledWith(\r\n                expect.objectContaining({\r\n                    message: expect.stringContaining('exceeds 10MB limit')\r\n                })\r\n            );\r\n        });\r\n\r\n        it('should reject invalid PDF signature', () => {\r\n            mockReq.file = {\r\n                mimetype: 'application/pdf',\r\n                size: 1024,\r\n                buffer: Buffer.from('not a real pdf'),\r\n                originalname: 'test.pdf'\r\n            };\r\n\r\n            validateFileUpload(mockReq, mockRes, mockNext);\r\n            expect(mockNext).toHaveBeenCalledWith(\r\n                expect.objectContaining({\r\n                    message: expect.stringContaining('Invalid PDF file format')\r\n                })\r\n            );\r\n        });\r\n    });\r\n\r\n    describe('Extended Validations', () => {\r\n        const analysisValidation = [\r\n            body('dateRange.start').isISO8601(),\r\n            body('dateRange.end').isISO8601(),\r\n            body('metadata.requestedBy').isString().notEmpty(),\r\n            body('metadata.priority').isIn(['low', 'medium', 'high'])\r\n        ];\r\n\r\n        it('should validate date range correctly', async () => {\r\n            mockReq.body = {\r\n                dateRange: {\r\n                    start: '2025-01-01',\r\n                    end: '2025-12-31'\r\n                }\r\n            };\r\n\r\n            await validateRequest(analysisValidation)(mockReq, mockRes, mockNext);\r\n            expect(mockNext).toHaveBeenCalledWith();\r\n        });\r\n\r\n        it('should reject invalid date range', async () => {\r\n            mockReq.body = {\r\n                dateRange: {\r\n                    start: '2025-12-31',\r\n                    end: '2025-01-01'\r\n                }\r\n            };\r\n\r\n            await validateRequest(analysisValidation)(mockReq, mockRes, mockNext);\r\n            expect(mockNext).toHaveBeenCalledWith(\r\n                expect.any(ValidationError)\r\n            );\r\n        });\r\n\r\n        it('should validate metadata fields', async () => {\r\n            mockReq.body = {\r\n                metadata: {\r\n                    requestedBy: 'John Doe',\r\n                    priority: 'high'\r\n                }\r\n            };\r\n\r\n            await validateRequest(analysisValidation)(mockReq, mockRes, mockNext);\r\n            expect(mockNext).toHaveBeenCalledWith();\r\n        });\r\n    });\r\n});"],"mappings":";;AAIA;AACAA,WAAA,GAAKC,IAAI,CAAC,yBAAyB,EAAE,OAAO;EACxCC,IAAI,EAAEC,IAAI,CAACC,EAAE,CAAC;AAClB,CAAC,CAAC,CAAC;AAAC,SAAAJ,YAAA;EAAA;IAAAG;EAAA,IAAAE,OAAA;EAAAL,WAAA,GAAAA,CAAA,KAAAG,IAAA;EAAA,OAAAA,IAAA;AAAA;AAPJ,MAAM;EAAEG,eAAe;EAAEC;AAAmB,CAAC,GAAGF,OAAO,CAAC,sCAAsC,CAAC;AAC/F,MAAM;EAAEG;AAAgB,CAAC,GAAGH,OAAO,CAAC,wBAAwB,CAAC;AAC7D,MAAM;EAAEI;AAAK,CAAC,GAAGJ,OAAO,CAAC,mBAAmB,CAAC;AAO7CK,QAAQ,CAAC,+BAA+B,EAAE,MAAM;EAC5C,IAAIC,OAAO;EACX,IAAIC,OAAO;EACX,IAAIC,QAAQ;EAEZC,UAAU,CAAC,MAAM;IACbH,OAAO,GAAG;MACNI,IAAI,EAAE,OAAO;MACbC,OAAO,EAAE,CAAC,CAAC;MACXP,IAAI,EAAE,CAAC;IACX,CAAC;IACDG,OAAO,GAAG;MACNK,MAAM,EAAEd,IAAI,CAACC,EAAE,CAAC,CAAC,CAACc,cAAc,CAAC,CAAC;MAClCC,IAAI,EAAEhB,IAAI,CAACC,EAAE,CAAC;IAClB,CAAC;IACDS,QAAQ,GAAGV,IAAI,CAACC,EAAE,CAAC,CAAC;EACxB,CAAC,CAAC;EAEFM,QAAQ,CAAC,iBAAiB,EAAE,MAAM;IAC9B,MAAMU,eAAe,GAAG,CACpBX,IAAI,CAAC,WAAW,CAAC,CAACY,QAAQ,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,CAC1C;IAEDC,EAAE,CAAC,2BAA2B,EAAE,YAAY;MACxCZ,OAAO,CAACF,IAAI,CAACe,SAAS,GAAG,aAAa;MAEtC,MAAMlB,eAAe,CAACc,eAAe,CAAC,CAACT,OAAO,EAAEC,OAAO,EAAEC,QAAQ,CAAC;MAElEY,MAAM,CAACZ,QAAQ,CAAC,CAACa,oBAAoB,CAAC,CAAC;MACvCD,MAAM,CAACZ,QAAQ,CAAC,CAACc,qBAAqB,CAAC,CAAC,CAAC;IAC7C,CAAC,CAAC;IAEFJ,EAAE,CAAC,gCAAgC,EAAE,YAAY;MAC7CZ,OAAO,CAACF,IAAI,CAACe,SAAS,GAAG,EAAE;MAE3B,MAAMlB,eAAe,CAACc,eAAe,CAAC,CAACT,OAAO,EAAEC,OAAO,EAAEC,QAAQ,CAAC;MAElEY,MAAM,CAACZ,QAAQ,CAAC,CAACa,oBAAoB,CACjCD,MAAM,CAACG,GAAG,CAACpB,eAAe,CAC9B,CAAC;IACL,CAAC,CAAC;EACN,CAAC,CAAC;EAEFE,QAAQ,CAAC,oBAAoB,EAAE,MAAM;IACjCa,EAAE,CAAC,4BAA4B,EAAE,MAAM;MACnCZ,OAAO,CAACkB,IAAI,GAAG;QACXC,QAAQ,EAAE,iBAAiB;QAC3BC,IAAI,EAAE,IAAI,GAAG,IAAI,CAAC;MACtB,CAAC;MAEDxB,kBAAkB,CAACI,OAAO,EAAEC,OAAO,EAAEC,QAAQ,CAAC;MAE9CY,MAAM,CAACZ,QAAQ,CAAC,CAACa,oBAAoB,CAAC,CAAC;MACvCD,MAAM,CAACZ,QAAQ,CAAC,CAACc,qBAAqB,CAAC,CAAC,CAAC;IAC7C,CAAC,CAAC;IAEFJ,EAAE,CAAC,4BAA4B,EAAE,MAAM;MACnChB,kBAAkB,CAACI,OAAO,EAAEC,OAAO,EAAEC,QAAQ,CAAC;MAE9CY,MAAM,CAACZ,QAAQ,CAAC,CAACa,oBAAoB,CACjCD,MAAM,CAACO,gBAAgB,CAAC;QACpBC,OAAO,EAAER,MAAM,CAACS,gBAAgB,CAAC,sBAAsB;MAC3D,CAAC,CACL,CAAC;IACL,CAAC,CAAC;IAEFX,EAAE,CAAC,6BAA6B,EAAE,MAAM;MACpCZ,OAAO,CAACkB,IAAI,GAAG;QACXC,QAAQ,EAAE,YAAY;QACtBC,IAAI,EAAE;MACV,CAAC;MAEDxB,kBAAkB,CAACI,OAAO,EAAEC,OAAO,EAAEC,QAAQ,CAAC;MAE9CY,MAAM,CAACZ,QAAQ,CAAC,CAACa,oBAAoB,CACjCD,MAAM,CAACO,gBAAgB,CAAC;QACpBC,OAAO,EAAER,MAAM,CAACS,gBAAgB,CAAC,4BAA4B;MACjE,CAAC,CACL,CAAC;IACL,CAAC,CAAC;IAEFX,EAAE,CAAC,2BAA2B,EAAE,MAAM;MAClCZ,OAAO,CAACkB,IAAI,GAAG;QACXC,QAAQ,EAAE,iBAAiB;QAC3BC,IAAI,EAAE,EAAE,GAAG,IAAI,GAAG,IAAI,CAAC;MAC3B,CAAC;MAEDxB,kBAAkB,CAACI,OAAO,EAAEC,OAAO,EAAEC,QAAQ,CAAC;MAE9CY,MAAM,CAACZ,QAAQ,CAAC,CAACa,oBAAoB,CACjCD,MAAM,CAACO,gBAAgB,CAAC;QACpBC,OAAO,EAAER,MAAM,CAACS,gBAAgB,CAAC,oBAAoB;MACzD,CAAC,CACL,CAAC;IACL,CAAC,CAAC;IAEFX,EAAE,CAAC,qCAAqC,EAAE,MAAM;MAC5CZ,OAAO,CAACkB,IAAI,GAAG;QACXC,QAAQ,EAAE,iBAAiB;QAC3BC,IAAI,EAAE,IAAI;QACVI,MAAM,EAAEC,MAAM,CAACC,IAAI,CAAC,gBAAgB,CAAC;QACrCC,YAAY,EAAE;MAClB,CAAC;MAED/B,kBAAkB,CAACI,OAAO,EAAEC,OAAO,EAAEC,QAAQ,CAAC;MAC9CY,MAAM,CAACZ,QAAQ,CAAC,CAACa,oBAAoB,CACjCD,MAAM,CAACO,gBAAgB,CAAC;QACpBC,OAAO,EAAER,MAAM,CAACS,gBAAgB,CAAC,yBAAyB;MAC9D,CAAC,CACL,CAAC;IACL,CAAC,CAAC;EACN,CAAC,CAAC;EAEFxB,QAAQ,CAAC,sBAAsB,EAAE,MAAM;IACnC,MAAM6B,kBAAkB,GAAG,CACvB9B,IAAI,CAAC,iBAAiB,CAAC,CAAC+B,SAAS,CAAC,CAAC,EACnC/B,IAAI,CAAC,eAAe,CAAC,CAAC+B,SAAS,CAAC,CAAC,EACjC/B,IAAI,CAAC,sBAAsB,CAAC,CAACY,QAAQ,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,EAClDb,IAAI,CAAC,mBAAmB,CAAC,CAACgC,IAAI,CAAC,CAAC,KAAK,EAAE,QAAQ,EAAE,MAAM,CAAC,CAAC,CAC5D;IAEDlB,EAAE,CAAC,sCAAsC,EAAE,YAAY;MACnDZ,OAAO,CAACF,IAAI,GAAG;QACXiC,SAAS,EAAE;UACPC,KAAK,EAAE,YAAY;UACnBC,GAAG,EAAE;QACT;MACJ,CAAC;MAED,MAAMtC,eAAe,CAACiC,kBAAkB,CAAC,CAAC5B,OAAO,EAAEC,OAAO,EAAEC,QAAQ,CAAC;MACrEY,MAAM,CAACZ,QAAQ,CAAC,CAACa,oBAAoB,CAAC,CAAC;IAC3C,CAAC,CAAC;IAEFH,EAAE,CAAC,kCAAkC,EAAE,YAAY;MAC/CZ,OAAO,CAACF,IAAI,GAAG;QACXiC,SAAS,EAAE;UACPC,KAAK,EAAE,YAAY;UACnBC,GAAG,EAAE;QACT;MACJ,CAAC;MAED,MAAMtC,eAAe,CAACiC,kBAAkB,CAAC,CAAC5B,OAAO,EAAEC,OAAO,EAAEC,QAAQ,CAAC;MACrEY,MAAM,CAACZ,QAAQ,CAAC,CAACa,oBAAoB,CACjCD,MAAM,CAACG,GAAG,CAACpB,eAAe,CAC9B,CAAC;IACL,CAAC,CAAC;IAEFe,EAAE,CAAC,iCAAiC,EAAE,YAAY;MAC9CZ,OAAO,CAACF,IAAI,GAAG;QACXoC,QAAQ,EAAE;UACNC,WAAW,EAAE,UAAU;UACvBC,QAAQ,EAAE;QACd;MACJ,CAAC;MAED,MAAMzC,eAAe,CAACiC,kBAAkB,CAAC,CAAC5B,OAAO,EAAEC,OAAO,EAAEC,QAAQ,CAAC;MACrEY,MAAM,CAACZ,QAAQ,CAAC,CAACa,oBAAoB,CAAC,CAAC;IAC3C,CAAC,CAAC;EACN,CAAC,CAAC;AACN,CAAC,CAAC","ignoreList":[]}