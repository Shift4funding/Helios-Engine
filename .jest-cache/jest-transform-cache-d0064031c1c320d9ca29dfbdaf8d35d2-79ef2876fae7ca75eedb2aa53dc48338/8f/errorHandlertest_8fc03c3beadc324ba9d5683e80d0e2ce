28bec486403536af4e24446d5cc8f022
"use strict";

_getJestObj().mock('../../src/config/logger');
function _getJestObj() {
  const {
    jest
  } = require("@jest/globals");
  _getJestObj = () => jest;
  return jest;
}
const errorHandler = require('../../src/middleware/errorHandler');
const {
  AppError
} = require('../../src/utils/errors');
const logger = require('../../src/config/logger');
describe('Error Handler Middleware', () => {
  let mockReq;
  let mockRes;
  let mockNext;
  beforeEach(() => {
    mockReq = {
      path: '/test',
      method: 'GET',
      id: 'test-id'
    };
    mockRes = {
      status: jest.fn().mockReturnThis(),
      json: jest.fn()
    };
    mockNext = jest.fn();
    logger.error.mockClear();
  });
  it('should handle operational errors', () => {
    const error = new AppError('Test error', 400);
    errorHandler(error, mockReq, mockRes, mockNext);
    expect(mockRes.status).toHaveBeenCalledWith(400);
    expect(mockRes.json).toHaveBeenCalledWith({
      status: 'fail',
      message: 'Test error'
    });
    expect(logger.error).toHaveBeenCalled();
  });
  it('should hide error details in production', () => {
    process.env.NODE_ENV = 'production';
    const error = new Error('System error');
    errorHandler(error, mockReq, mockRes, mockNext);
    expect(mockRes.status).toHaveBeenCalledWith(500);
    expect(mockRes.json).toHaveBeenCalledWith({
      status: 'error',
      message: 'Something went wrong'
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2V0SmVzdE9iaiIsIm1vY2siLCJqZXN0IiwicmVxdWlyZSIsImVycm9ySGFuZGxlciIsIkFwcEVycm9yIiwibG9nZ2VyIiwiZGVzY3JpYmUiLCJtb2NrUmVxIiwibW9ja1JlcyIsIm1vY2tOZXh0IiwiYmVmb3JlRWFjaCIsInBhdGgiLCJtZXRob2QiLCJpZCIsInN0YXR1cyIsImZuIiwibW9ja1JldHVyblRoaXMiLCJqc29uIiwiZXJyb3IiLCJtb2NrQ2xlYXIiLCJpdCIsImV4cGVjdCIsInRvSGF2ZUJlZW5DYWxsZWRXaXRoIiwibWVzc2FnZSIsInRvSGF2ZUJlZW5DYWxsZWQiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJFcnJvciJdLCJzb3VyY2VzIjpbImVycm9ySGFuZGxlci50ZXN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGVycm9ySGFuZGxlciA9IHJlcXVpcmUoJy4uLy4uL3NyYy9taWRkbGV3YXJlL2Vycm9ySGFuZGxlcicpO1xyXG5jb25zdCB7IEFwcEVycm9yIH0gPSByZXF1aXJlKCcuLi8uLi9zcmMvdXRpbHMvZXJyb3JzJyk7XHJcbmNvbnN0IGxvZ2dlciA9IHJlcXVpcmUoJy4uLy4uL3NyYy9jb25maWcvbG9nZ2VyJyk7XHJcblxyXG5qZXN0Lm1vY2soJy4uLy4uL3NyYy9jb25maWcvbG9nZ2VyJyk7XHJcblxyXG5kZXNjcmliZSgnRXJyb3IgSGFuZGxlciBNaWRkbGV3YXJlJywgKCkgPT4ge1xyXG4gICAgbGV0IG1vY2tSZXE7XHJcbiAgICBsZXQgbW9ja1JlcztcclxuICAgIGxldCBtb2NrTmV4dDtcclxuXHJcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICBtb2NrUmVxID0ge1xyXG4gICAgICAgICAgICBwYXRoOiAnL3Rlc3QnLFxyXG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICBpZDogJ3Rlc3QtaWQnXHJcbiAgICAgICAgfTtcclxuICAgICAgICBtb2NrUmVzID0ge1xyXG4gICAgICAgICAgICBzdGF0dXM6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgICAgICAgICBqc29uOiBqZXN0LmZuKClcclxuICAgICAgICB9O1xyXG4gICAgICAgIG1vY2tOZXh0ID0gamVzdC5mbigpO1xyXG4gICAgICAgIGxvZ2dlci5lcnJvci5tb2NrQ2xlYXIoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG9wZXJhdGlvbmFsIGVycm9ycycsICgpID0+IHtcclxuICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBBcHBFcnJvcignVGVzdCBlcnJvcicsIDQwMCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgZXJyb3JIYW5kbGVyKGVycm9yLCBtb2NrUmVxLCBtb2NrUmVzLCBtb2NrTmV4dCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgZXhwZWN0KG1vY2tSZXMuc3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCg0MDApO1xyXG4gICAgICAgIGV4cGVjdChtb2NrUmVzLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICAgICAgc3RhdHVzOiAnZmFpbCcsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdUZXN0IGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGV4cGVjdChsb2dnZXIuZXJyb3IpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGlkZSBlcnJvciBkZXRhaWxzIGluIHByb2R1Y3Rpb24nLCAoKSA9PiB7XHJcbiAgICAgICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAncHJvZHVjdGlvbic7XHJcbiAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ1N5c3RlbSBlcnJvcicpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGVycm9ySGFuZGxlcihlcnJvciwgbW9ja1JlcSwgbW9ja1JlcywgbW9ja05leHQpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGV4cGVjdChtb2NrUmVzLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNTAwKTtcclxuICAgICAgICBleHBlY3QobW9ja1Jlcy5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgICAgIHN0YXR1czogJ2Vycm9yJyxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1NvbWV0aGluZyB3ZW50IHdyb25nJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0pOyJdLCJtYXBwaW5ncyI6Ijs7QUFJQUEsV0FBQSxHQUFLQyxJQUFJLENBQUMseUJBQXlCLENBQUM7QUFBQyxTQUFBRCxZQUFBO0VBQUE7SUFBQUU7RUFBQSxJQUFBQyxPQUFBO0VBQUFILFdBQUEsR0FBQUEsQ0FBQSxLQUFBRSxJQUFBO0VBQUEsT0FBQUEsSUFBQTtBQUFBO0FBSnJDLE1BQU1FLFlBQVksR0FBR0QsT0FBTyxDQUFDLG1DQUFtQyxDQUFDO0FBQ2pFLE1BQU07RUFBRUU7QUFBUyxDQUFDLEdBQUdGLE9BQU8sQ0FBQyx3QkFBd0IsQ0FBQztBQUN0RCxNQUFNRyxNQUFNLEdBQUdILE9BQU8sQ0FBQyx5QkFBeUIsQ0FBQztBQUlqREksUUFBUSxDQUFDLDBCQUEwQixFQUFFLE1BQU07RUFDdkMsSUFBSUMsT0FBTztFQUNYLElBQUlDLE9BQU87RUFDWCxJQUFJQyxRQUFRO0VBRVpDLFVBQVUsQ0FBQyxNQUFNO0lBQ2JILE9BQU8sR0FBRztNQUNOSSxJQUFJLEVBQUUsT0FBTztNQUNiQyxNQUFNLEVBQUUsS0FBSztNQUNiQyxFQUFFLEVBQUU7SUFDUixDQUFDO0lBQ0RMLE9BQU8sR0FBRztNQUNOTSxNQUFNLEVBQUViLElBQUksQ0FBQ2MsRUFBRSxDQUFDLENBQUMsQ0FBQ0MsY0FBYyxDQUFDLENBQUM7TUFDbENDLElBQUksRUFBRWhCLElBQUksQ0FBQ2MsRUFBRSxDQUFDO0lBQ2xCLENBQUM7SUFDRE4sUUFBUSxHQUFHUixJQUFJLENBQUNjLEVBQUUsQ0FBQyxDQUFDO0lBQ3BCVixNQUFNLENBQUNhLEtBQUssQ0FBQ0MsU0FBUyxDQUFDLENBQUM7RUFDNUIsQ0FBQyxDQUFDO0VBRUZDLEVBQUUsQ0FBQyxrQ0FBa0MsRUFBRSxNQUFNO0lBQ3pDLE1BQU1GLEtBQUssR0FBRyxJQUFJZCxRQUFRLENBQUMsWUFBWSxFQUFFLEdBQUcsQ0FBQztJQUU3Q0QsWUFBWSxDQUFDZSxLQUFLLEVBQUVYLE9BQU8sRUFBRUMsT0FBTyxFQUFFQyxRQUFRLENBQUM7SUFFL0NZLE1BQU0sQ0FBQ2IsT0FBTyxDQUFDTSxNQUFNLENBQUMsQ0FBQ1Esb0JBQW9CLENBQUMsR0FBRyxDQUFDO0lBQ2hERCxNQUFNLENBQUNiLE9BQU8sQ0FBQ1MsSUFBSSxDQUFDLENBQUNLLG9CQUFvQixDQUFDO01BQ3RDUixNQUFNLEVBQUUsTUFBTTtNQUNkUyxPQUFPLEVBQUU7SUFDYixDQUFDLENBQUM7SUFDRkYsTUFBTSxDQUFDaEIsTUFBTSxDQUFDYSxLQUFLLENBQUMsQ0FBQ00sZ0JBQWdCLENBQUMsQ0FBQztFQUMzQyxDQUFDLENBQUM7RUFFRkosRUFBRSxDQUFDLHlDQUF5QyxFQUFFLE1BQU07SUFDaERLLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxRQUFRLEdBQUcsWUFBWTtJQUNuQyxNQUFNVCxLQUFLLEdBQUcsSUFBSVUsS0FBSyxDQUFDLGNBQWMsQ0FBQztJQUV2Q3pCLFlBQVksQ0FBQ2UsS0FBSyxFQUFFWCxPQUFPLEVBQUVDLE9BQU8sRUFBRUMsUUFBUSxDQUFDO0lBRS9DWSxNQUFNLENBQUNiLE9BQU8sQ0FBQ00sTUFBTSxDQUFDLENBQUNRLG9CQUFvQixDQUFDLEdBQUcsQ0FBQztJQUNoREQsTUFBTSxDQUFDYixPQUFPLENBQUNTLElBQUksQ0FBQyxDQUFDSyxvQkFBb0IsQ0FBQztNQUN0Q1IsTUFBTSxFQUFFLE9BQU87TUFDZlMsT0FBTyxFQUFFO0lBQ2IsQ0FBQyxDQUFDO0VBQ04sQ0FBQyxDQUFDO0FBQ04sQ0FBQyxDQUFDIiwiaWdub3JlTGlzdCI6W119