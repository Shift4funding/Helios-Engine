20abbf7d6b1bfa7342f1ebfbc406aea6
"use strict";

const PerplexityService = require('../../src/services/perplexityService');
const mockTransactions = require('../fixtures/mockTransactions');
const axios = require('axios');
const MockAdapter = require('axios-mock-adapter');
describe('PerplexityService', () => {
  let perplexityService;
  let mockAxios;
  beforeEach(() => {
    perplexityService = new PerplexityService();
    mockAxios = new MockAdapter(axios);
  });
  afterEach(() => {
    mockAxios.restore();
  });
  it('should perform deep financial analysis', async () => {
    // Mock successful API response
    mockAxios.onPost(process.env.PERPLEXITY_API_URL).reply(200, {
      choices: [{
        message: {
          content: 'Analysis results here...'
        },
        finish_reason: 'stop'
      }]
    });
    const analysis = await perplexityService.analyzeTransactions(mockTransactions);
    expect(analysis).toHaveProperty('structured');
    expect(analysis).toHaveProperty('metadata');
    expect(analysis.metadata.model).toBe('sonar-medium-online');
  });
  it('should handle API errors gracefully', async () => {
    // Mock API error
    mockAxios.onPost(process.env.PERPLEXITY_API_URL).reply(400, {
      error: 'Bad Request'
    });
    await expect(perplexityService.analyzeTransactions(mockTransactions)).rejects.toThrow('Analysis failed');
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQZXJwbGV4aXR5U2VydmljZSIsInJlcXVpcmUiLCJtb2NrVHJhbnNhY3Rpb25zIiwiYXhpb3MiLCJNb2NrQWRhcHRlciIsImRlc2NyaWJlIiwicGVycGxleGl0eVNlcnZpY2UiLCJtb2NrQXhpb3MiLCJiZWZvcmVFYWNoIiwiYWZ0ZXJFYWNoIiwicmVzdG9yZSIsIml0Iiwib25Qb3N0IiwicHJvY2VzcyIsImVudiIsIlBFUlBMRVhJVFlfQVBJX1VSTCIsInJlcGx5IiwiY2hvaWNlcyIsIm1lc3NhZ2UiLCJjb250ZW50IiwiZmluaXNoX3JlYXNvbiIsImFuYWx5c2lzIiwiYW5hbHl6ZVRyYW5zYWN0aW9ucyIsImV4cGVjdCIsInRvSGF2ZVByb3BlcnR5IiwibWV0YWRhdGEiLCJtb2RlbCIsInRvQmUiLCJlcnJvciIsInJlamVjdHMiLCJ0b1Rocm93Il0sInNvdXJjZXMiOlsicGVycGxleGl0eVNlcnZpY2UudGVzdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBQZXJwbGV4aXR5U2VydmljZSA9IHJlcXVpcmUoJy4uLy4uL3NyYy9zZXJ2aWNlcy9wZXJwbGV4aXR5U2VydmljZScpO1xyXG5jb25zdCBtb2NrVHJhbnNhY3Rpb25zID0gcmVxdWlyZSgnLi4vZml4dHVyZXMvbW9ja1RyYW5zYWN0aW9ucycpO1xyXG5jb25zdCBheGlvcyA9IHJlcXVpcmUoJ2F4aW9zJyk7XHJcbmNvbnN0IE1vY2tBZGFwdGVyID0gcmVxdWlyZSgnYXhpb3MtbW9jay1hZGFwdGVyJyk7XHJcblxyXG5kZXNjcmliZSgnUGVycGxleGl0eVNlcnZpY2UnLCAoKSA9PiB7XHJcbiAgICBsZXQgcGVycGxleGl0eVNlcnZpY2U7XHJcbiAgICBsZXQgbW9ja0F4aW9zO1xyXG5cclxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgIHBlcnBsZXhpdHlTZXJ2aWNlID0gbmV3IFBlcnBsZXhpdHlTZXJ2aWNlKCk7XHJcbiAgICAgICAgbW9ja0F4aW9zID0gbmV3IE1vY2tBZGFwdGVyKGF4aW9zKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGFmdGVyRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgbW9ja0F4aW9zLnJlc3RvcmUoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcGVyZm9ybSBkZWVwIGZpbmFuY2lhbCBhbmFseXNpcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAvLyBNb2NrIHN1Y2Nlc3NmdWwgQVBJIHJlc3BvbnNlXHJcbiAgICAgICAgbW9ja0F4aW9zLm9uUG9zdChwcm9jZXNzLmVudi5QRVJQTEVYSVRZX0FQSV9VUkwpLnJlcGx5KDIwMCwge1xyXG4gICAgICAgICAgICBjaG9pY2VzOiBbe1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICdBbmFseXNpcyByZXN1bHRzIGhlcmUuLi4nXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZmluaXNoX3JlYXNvbjogJ3N0b3AnXHJcbiAgICAgICAgICAgIH1dXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGFuYWx5c2lzID0gYXdhaXQgcGVycGxleGl0eVNlcnZpY2UuYW5hbHl6ZVRyYW5zYWN0aW9ucyhtb2NrVHJhbnNhY3Rpb25zKTtcclxuICAgICAgICBcclxuICAgICAgICBleHBlY3QoYW5hbHlzaXMpLnRvSGF2ZVByb3BlcnR5KCdzdHJ1Y3R1cmVkJyk7XHJcbiAgICAgICAgZXhwZWN0KGFuYWx5c2lzKS50b0hhdmVQcm9wZXJ0eSgnbWV0YWRhdGEnKTtcclxuICAgICAgICBleHBlY3QoYW5hbHlzaXMubWV0YWRhdGEubW9kZWwpLnRvQmUoJ3NvbmFyLW1lZGl1bS1vbmxpbmUnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIEFQSSBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAvLyBNb2NrIEFQSSBlcnJvclxyXG4gICAgICAgIG1vY2tBeGlvcy5vblBvc3QocHJvY2Vzcy5lbnYuUEVSUExFWElUWV9BUElfVVJMKS5yZXBseSg0MDAsIHtcclxuICAgICAgICAgICAgZXJyb3I6ICdCYWQgUmVxdWVzdCdcclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICBhd2FpdCBleHBlY3QoXHJcbiAgICAgICAgICAgIHBlcnBsZXhpdHlTZXJ2aWNlLmFuYWx5emVUcmFuc2FjdGlvbnMobW9ja1RyYW5zYWN0aW9ucylcclxuICAgICAgICApLnJlamVjdHMudG9UaHJvdygnQW5hbHlzaXMgZmFpbGVkJyk7XHJcbiAgICB9KTtcclxufSk7Il0sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU1BLGlCQUFpQixHQUFHQyxPQUFPLENBQUMsc0NBQXNDLENBQUM7QUFDekUsTUFBTUMsZ0JBQWdCLEdBQUdELE9BQU8sQ0FBQyw4QkFBOEIsQ0FBQztBQUNoRSxNQUFNRSxLQUFLLEdBQUdGLE9BQU8sQ0FBQyxPQUFPLENBQUM7QUFDOUIsTUFBTUcsV0FBVyxHQUFHSCxPQUFPLENBQUMsb0JBQW9CLENBQUM7QUFFakRJLFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxNQUFNO0VBQ2hDLElBQUlDLGlCQUFpQjtFQUNyQixJQUFJQyxTQUFTO0VBRWJDLFVBQVUsQ0FBQyxNQUFNO0lBQ2JGLGlCQUFpQixHQUFHLElBQUlOLGlCQUFpQixDQUFDLENBQUM7SUFDM0NPLFNBQVMsR0FBRyxJQUFJSCxXQUFXLENBQUNELEtBQUssQ0FBQztFQUN0QyxDQUFDLENBQUM7RUFFRk0sU0FBUyxDQUFDLE1BQU07SUFDWkYsU0FBUyxDQUFDRyxPQUFPLENBQUMsQ0FBQztFQUN2QixDQUFDLENBQUM7RUFFRkMsRUFBRSxDQUFDLHdDQUF3QyxFQUFFLFlBQVk7SUFDckQ7SUFDQUosU0FBUyxDQUFDSyxNQUFNLENBQUNDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxrQkFBa0IsQ0FBQyxDQUFDQyxLQUFLLENBQUMsR0FBRyxFQUFFO01BQ3hEQyxPQUFPLEVBQUUsQ0FBQztRQUNOQyxPQUFPLEVBQUU7VUFDTEMsT0FBTyxFQUFFO1FBQ2IsQ0FBQztRQUNEQyxhQUFhLEVBQUU7TUFDbkIsQ0FBQztJQUNMLENBQUMsQ0FBQztJQUVGLE1BQU1DLFFBQVEsR0FBRyxNQUFNZixpQkFBaUIsQ0FBQ2dCLG1CQUFtQixDQUFDcEIsZ0JBQWdCLENBQUM7SUFFOUVxQixNQUFNLENBQUNGLFFBQVEsQ0FBQyxDQUFDRyxjQUFjLENBQUMsWUFBWSxDQUFDO0lBQzdDRCxNQUFNLENBQUNGLFFBQVEsQ0FBQyxDQUFDRyxjQUFjLENBQUMsVUFBVSxDQUFDO0lBQzNDRCxNQUFNLENBQUNGLFFBQVEsQ0FBQ0ksUUFBUSxDQUFDQyxLQUFLLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLHFCQUFxQixDQUFDO0VBQy9ELENBQUMsQ0FBQztFQUVGaEIsRUFBRSxDQUFDLHFDQUFxQyxFQUFFLFlBQVk7SUFDbEQ7SUFDQUosU0FBUyxDQUFDSyxNQUFNLENBQUNDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxrQkFBa0IsQ0FBQyxDQUFDQyxLQUFLLENBQUMsR0FBRyxFQUFFO01BQ3hEWSxLQUFLLEVBQUU7SUFDWCxDQUFDLENBQUM7SUFFRixNQUFNTCxNQUFNLENBQ1JqQixpQkFBaUIsQ0FBQ2dCLG1CQUFtQixDQUFDcEIsZ0JBQWdCLENBQzFELENBQUMsQ0FBQzJCLE9BQU8sQ0FBQ0MsT0FBTyxDQUFDLGlCQUFpQixDQUFDO0VBQ3hDLENBQUMsQ0FBQztBQUNOLENBQUMsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==