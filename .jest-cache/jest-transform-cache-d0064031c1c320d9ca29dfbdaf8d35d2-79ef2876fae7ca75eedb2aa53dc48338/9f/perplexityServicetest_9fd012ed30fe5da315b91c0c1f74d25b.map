{"version":3,"names":["PerplexityService","require","mockTransactions","axios","MockAdapter","describe","perplexityService","mockAxios","beforeEach","afterEach","restore","it","onPost","process","env","PERPLEXITY_API_URL","reply","choices","message","content","finish_reason","analysis","analyzeTransactions","expect","toHaveProperty","metadata","model","toBe","error","rejects","toThrow"],"sources":["perplexityService.test.js"],"sourcesContent":["const PerplexityService = require('../../src/services/perplexityService');\r\nconst mockTransactions = require('../fixtures/mockTransactions');\r\nconst axios = require('axios');\r\nconst MockAdapter = require('axios-mock-adapter');\r\n\r\ndescribe('PerplexityService', () => {\r\n    let perplexityService;\r\n    let mockAxios;\r\n\r\n    beforeEach(() => {\r\n        perplexityService = new PerplexityService();\r\n        mockAxios = new MockAdapter(axios);\r\n    });\r\n\r\n    afterEach(() => {\r\n        mockAxios.restore();\r\n    });\r\n\r\n    it('should perform deep financial analysis', async () => {\r\n        // Mock successful API response\r\n        mockAxios.onPost(process.env.PERPLEXITY_API_URL).reply(200, {\r\n            choices: [{\r\n                message: {\r\n                    content: 'Analysis results here...'\r\n                },\r\n                finish_reason: 'stop'\r\n            }]\r\n        });\r\n\r\n        const analysis = await perplexityService.analyzeTransactions(mockTransactions);\r\n        \r\n        expect(analysis).toHaveProperty('structured');\r\n        expect(analysis).toHaveProperty('metadata');\r\n        expect(analysis.metadata.model).toBe('sonar-medium-online');\r\n    });\r\n\r\n    it('should handle API errors gracefully', async () => {\r\n        // Mock API error\r\n        mockAxios.onPost(process.env.PERPLEXITY_API_URL).reply(400, {\r\n            error: 'Bad Request'\r\n        });\r\n        \r\n        await expect(\r\n            perplexityService.analyzeTransactions(mockTransactions)\r\n        ).rejects.toThrow('Analysis failed');\r\n    });\r\n});"],"mappings":";;AAAA,MAAMA,iBAAiB,GAAGC,OAAO,CAAC,sCAAsC,CAAC;AACzE,MAAMC,gBAAgB,GAAGD,OAAO,CAAC,8BAA8B,CAAC;AAChE,MAAME,KAAK,GAAGF,OAAO,CAAC,OAAO,CAAC;AAC9B,MAAMG,WAAW,GAAGH,OAAO,CAAC,oBAAoB,CAAC;AAEjDI,QAAQ,CAAC,mBAAmB,EAAE,MAAM;EAChC,IAAIC,iBAAiB;EACrB,IAAIC,SAAS;EAEbC,UAAU,CAAC,MAAM;IACbF,iBAAiB,GAAG,IAAIN,iBAAiB,CAAC,CAAC;IAC3CO,SAAS,GAAG,IAAIH,WAAW,CAACD,KAAK,CAAC;EACtC,CAAC,CAAC;EAEFM,SAAS,CAAC,MAAM;IACZF,SAAS,CAACG,OAAO,CAAC,CAAC;EACvB,CAAC,CAAC;EAEFC,EAAE,CAAC,wCAAwC,EAAE,YAAY;IACrD;IACAJ,SAAS,CAACK,MAAM,CAACC,OAAO,CAACC,GAAG,CAACC,kBAAkB,CAAC,CAACC,KAAK,CAAC,GAAG,EAAE;MACxDC,OAAO,EAAE,CAAC;QACNC,OAAO,EAAE;UACLC,OAAO,EAAE;QACb,CAAC;QACDC,aAAa,EAAE;MACnB,CAAC;IACL,CAAC,CAAC;IAEF,MAAMC,QAAQ,GAAG,MAAMf,iBAAiB,CAACgB,mBAAmB,CAACpB,gBAAgB,CAAC;IAE9EqB,MAAM,CAACF,QAAQ,CAAC,CAACG,cAAc,CAAC,YAAY,CAAC;IAC7CD,MAAM,CAACF,QAAQ,CAAC,CAACG,cAAc,CAAC,UAAU,CAAC;IAC3CD,MAAM,CAACF,QAAQ,CAACI,QAAQ,CAACC,KAAK,CAAC,CAACC,IAAI,CAAC,qBAAqB,CAAC;EAC/D,CAAC,CAAC;EAEFhB,EAAE,CAAC,qCAAqC,EAAE,YAAY;IAClD;IACAJ,SAAS,CAACK,MAAM,CAACC,OAAO,CAACC,GAAG,CAACC,kBAAkB,CAAC,CAACC,KAAK,CAAC,GAAG,EAAE;MACxDY,KAAK,EAAE;IACX,CAAC,CAAC;IAEF,MAAML,MAAM,CACRjB,iBAAiB,CAACgB,mBAAmB,CAACpB,gBAAgB,CAC1D,CAAC,CAAC2B,OAAO,CAACC,OAAO,CAAC,iBAAiB,CAAC;EACxC,CAAC,CAAC;AACN,CAAC,CAAC","ignoreList":[]}