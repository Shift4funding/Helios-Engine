4b7e53be5e3f03664b5f16bb1992d6fa
"use strict";

const mongoose = require('mongoose');
const Transaction = require('../../src/models/Transaction');
const {
  setupTestDatabase,
  cleanupTestDatabase
} = require('../helpers/testDb');
describe('Transaction Model', () => {
  beforeAll(async () => {
    await setupTestDatabase();
  });
  afterAll(async () => {
    await cleanupTestDatabase();
    // Ensure mongoose connection is closed
    await mongoose.disconnect();
  });
  afterEach(async () => {
    await Transaction.deleteMany({});
  });
  it('should create a transaction with required fields', async () => {
    const transaction = new Transaction({
      date: new Date(),
      description: 'Salary deposit',
      amount: 5000,
      category: 'income'
    });
    const saved = await transaction.save();
    expect(saved._id).toBeDefined();
    expect(saved.category).toBe('income');
    expect(saved.type).toBe('uncategorized');
  });
  it('should fail validation without required fields', async () => {
    const transaction = new Transaction({});
    await expect(transaction.save()).rejects.toThrow(mongoose.Error.ValidationError);
  });
  it('should validate amount is a number', async () => {
    const transaction = new Transaction({
      date: new Date(),
      description: 'Invalid amount',
      amount: 'not-a-number'
    });
    await expect(transaction.save()).rejects.toThrow(mongoose.Error.ValidationError);
  });
  it('should enforce category enum values', async () => {
    const transaction = new Transaction({
      date: new Date(),
      description: 'Test transaction',
      amount: 100,
      category: 'invalid-category'
    });
    await expect(transaction.save()).rejects.toThrow(mongoose.Error.ValidationError);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJUcmFuc2FjdGlvbiIsInNldHVwVGVzdERhdGFiYXNlIiwiY2xlYW51cFRlc3REYXRhYmFzZSIsImRlc2NyaWJlIiwiYmVmb3JlQWxsIiwiYWZ0ZXJBbGwiLCJkaXNjb25uZWN0IiwiYWZ0ZXJFYWNoIiwiZGVsZXRlTWFueSIsIml0IiwidHJhbnNhY3Rpb24iLCJkYXRlIiwiRGF0ZSIsImRlc2NyaXB0aW9uIiwiYW1vdW50IiwiY2F0ZWdvcnkiLCJzYXZlZCIsInNhdmUiLCJleHBlY3QiLCJfaWQiLCJ0b0JlRGVmaW5lZCIsInRvQmUiLCJ0eXBlIiwicmVqZWN0cyIsInRvVGhyb3ciLCJFcnJvciIsIlZhbGlkYXRpb25FcnJvciJdLCJzb3VyY2VzIjpbIlRyYW5zYWN0aW9uLnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpO1xyXG5jb25zdCBUcmFuc2FjdGlvbiA9IHJlcXVpcmUoJy4uLy4uL3NyYy9tb2RlbHMvVHJhbnNhY3Rpb24nKTtcclxuY29uc3QgeyBzZXR1cFRlc3REYXRhYmFzZSwgY2xlYW51cFRlc3REYXRhYmFzZSB9ID0gcmVxdWlyZSgnLi4vaGVscGVycy90ZXN0RGInKTtcclxuXHJcbmRlc2NyaWJlKCdUcmFuc2FjdGlvbiBNb2RlbCcsICgpID0+IHtcclxuICAgIGJlZm9yZUFsbChhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgYXdhaXQgc2V0dXBUZXN0RGF0YWJhc2UoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGFmdGVyQWxsKGFzeW5jICgpID0+IHtcclxuICAgICAgICBhd2FpdCBjbGVhbnVwVGVzdERhdGFiYXNlKCk7XHJcbiAgICAgICAgLy8gRW5zdXJlIG1vbmdvb3NlIGNvbm5lY3Rpb24gaXMgY2xvc2VkXHJcbiAgICAgICAgYXdhaXQgbW9uZ29vc2UuZGlzY29ubmVjdCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcclxuICAgICAgICBhd2FpdCBUcmFuc2FjdGlvbi5kZWxldGVNYW55KHt9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgY3JlYXRlIGEgdHJhbnNhY3Rpb24gd2l0aCByZXF1aXJlZCBmaWVsZHMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBuZXcgVHJhbnNhY3Rpb24oe1xyXG4gICAgICAgICAgICBkYXRlOiBuZXcgRGF0ZSgpLFxyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1NhbGFyeSBkZXBvc2l0JyxcclxuICAgICAgICAgICAgYW1vdW50OiA1MDAwLFxyXG4gICAgICAgICAgICBjYXRlZ29yeTogJ2luY29tZSdcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc3Qgc2F2ZWQgPSBhd2FpdCB0cmFuc2FjdGlvbi5zYXZlKCk7XHJcbiAgICAgICAgZXhwZWN0KHNhdmVkLl9pZCkudG9CZURlZmluZWQoKTtcclxuICAgICAgICBleHBlY3Qoc2F2ZWQuY2F0ZWdvcnkpLnRvQmUoJ2luY29tZScpO1xyXG4gICAgICAgIGV4cGVjdChzYXZlZC50eXBlKS50b0JlKCd1bmNhdGVnb3JpemVkJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGZhaWwgdmFsaWRhdGlvbiB3aXRob3V0IHJlcXVpcmVkIGZpZWxkcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgICBjb25zdCB0cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbih7fSk7XHJcbiAgICAgICAgYXdhaXQgZXhwZWN0KHRyYW5zYWN0aW9uLnNhdmUoKSkucmVqZWN0cy50b1Rocm93KG1vbmdvb3NlLkVycm9yLlZhbGlkYXRpb25FcnJvcik7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGFtb3VudCBpcyBhIG51bWJlcicsIGFzeW5jICgpID0+IHtcclxuICAgICAgICBjb25zdCB0cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbih7XHJcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnSW52YWxpZCBhbW91bnQnLFxyXG4gICAgICAgICAgICBhbW91bnQ6ICdub3QtYS1udW1iZXInXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGF3YWl0IGV4cGVjdCh0cmFuc2FjdGlvbi5zYXZlKCkpLnJlamVjdHMudG9UaHJvdyhtb25nb29zZS5FcnJvci5WYWxpZGF0aW9uRXJyb3IpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBlbmZvcmNlIGNhdGVnb3J5IGVudW0gdmFsdWVzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gbmV3IFRyYW5zYWN0aW9uKHtcclxuICAgICAgICAgICAgZGF0ZTogbmV3IERhdGUoKSxcclxuICAgICAgICAgICAgZGVzY3JpcHRpb246ICdUZXN0IHRyYW5zYWN0aW9uJyxcclxuICAgICAgICAgICAgYW1vdW50OiAxMDAsXHJcbiAgICAgICAgICAgIGNhdGVnb3J5OiAnaW52YWxpZC1jYXRlZ29yeSdcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgYXdhaXQgZXhwZWN0KHRyYW5zYWN0aW9uLnNhdmUoKSkucmVqZWN0cy50b1Rocm93KG1vbmdvb3NlLkVycm9yLlZhbGlkYXRpb25FcnJvcik7XHJcbiAgICB9KTtcclxufSk7Il0sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU1BLFFBQVEsR0FBR0MsT0FBTyxDQUFDLFVBQVUsQ0FBQztBQUNwQyxNQUFNQyxXQUFXLEdBQUdELE9BQU8sQ0FBQyw4QkFBOEIsQ0FBQztBQUMzRCxNQUFNO0VBQUVFLGlCQUFpQjtFQUFFQztBQUFvQixDQUFDLEdBQUdILE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztBQUUvRUksUUFBUSxDQUFDLG1CQUFtQixFQUFFLE1BQU07RUFDaENDLFNBQVMsQ0FBQyxZQUFZO0lBQ2xCLE1BQU1I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