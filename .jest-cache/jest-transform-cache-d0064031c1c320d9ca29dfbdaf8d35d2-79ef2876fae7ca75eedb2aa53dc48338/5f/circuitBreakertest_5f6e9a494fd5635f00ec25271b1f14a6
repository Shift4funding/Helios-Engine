91b079bbcf1a5dc16fea17c233df83cd
"use strict";

const circuitBreaker = require('../../src/services/circuitBreakerService');
describe('Circuit Breaker Service', () => {
  const mockService = jest.fn();
  const serviceName = 'test-service';
  beforeEach(() => {
    mockService.mockReset();
  });
  it('should handle successful calls', async () => {
    mockService.mockResolvedValue({
      data: 'success'
    });
    const result = await circuitBreaker.execute(serviceName, mockService, 'test');
    expect(result).toEqual({
      data: 'success'
    });
  });
  it('should handle service failures', async () => {
    mockService.mockRejectedValue(new Error('Service failed'));
    const result = await circuitBreaker.execute(serviceName, mockService, 'test');
    expect(result).toEqual({
      success: false,
      error: 'test-service is temporarily unavailable'
    });
  });
  it('should track circuit breaker stats', async () => {
    mockService.mockResolvedValue({
      data: 'success'
    });
    await circuitBreaker.execute(serviceName, mockService);
    const stats = circuitBreaker.getStats(serviceName);
    expect(stats.state).toBe('closed');
    expect(stats.stats.successful).toBeGreaterThan(0);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjaXJjdWl0QnJlYWtlciIsInJlcXVpcmUiLCJkZXNjcmliZSIsIm1vY2tTZXJ2aWNlIiwiamVzdCIsImZuIiwic2VydmljZU5hbWUiLCJiZWZvcmVFYWNoIiwibW9ja1Jlc2V0IiwiaXQiLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsImRhdGEiLCJyZXN1bHQiLCJleGVjdXRlIiwiZXhwZWN0IiwidG9FcXVhbCIsIm1vY2tSZWplY3RlZFZhbHVlIiwiRXJyb3IiLCJzdWNjZXNzIiwiZXJyb3IiLCJzdGF0cyIsImdldFN0YXRzIiwic3RhdGUiLCJ0b0JlIiwic3VjY2Vzc2Z1bCIsInRvQmVHcmVhdGVyVGhhbiJdLCJzb3VyY2VzIjpbImNpcmN1aXRCcmVha2VyLnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgY2lyY3VpdEJyZWFrZXIgPSByZXF1aXJlKCcuLi8uLi9zcmMvc2VydmljZXMvY2lyY3VpdEJyZWFrZXJTZXJ2aWNlJyk7XHJcblxyXG5kZXNjcmliZSgnQ2lyY3VpdCBCcmVha2VyIFNlcnZpY2UnLCAoKSA9PiB7XHJcbiAgICBjb25zdCBtb2NrU2VydmljZSA9IGplc3QuZm4oKTtcclxuICAgIGNvbnN0IHNlcnZpY2VOYW1lID0gJ3Rlc3Qtc2VydmljZSc7XHJcblxyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgbW9ja1NlcnZpY2UubW9ja1Jlc2V0KCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzdWNjZXNzZnVsIGNhbGxzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIG1vY2tTZXJ2aWNlLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogJ3N1Y2Nlc3MnIH0pO1xyXG5cclxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjaXJjdWl0QnJlYWtlci5leGVjdXRlKHNlcnZpY2VOYW1lLCBtb2NrU2VydmljZSwgJ3Rlc3QnKTtcclxuICAgICAgICBcclxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHsgZGF0YTogJ3N1Y2Nlc3MnIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmljZSBmYWlsdXJlcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgICBtb2NrU2VydmljZS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1NlcnZpY2UgZmFpbGVkJykpO1xyXG5cclxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjaXJjdWl0QnJlYWtlci5leGVjdXRlKHNlcnZpY2VOYW1lLCBtb2NrU2VydmljZSwgJ3Rlc3QnKTtcclxuICAgICAgICBcclxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIGVycm9yOiAndGVzdC1zZXJ2aWNlIGlzIHRlbXBvcmFyaWx5IHVuYXZhaWxhYmxlJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB0cmFjayBjaXJjdWl0IGJyZWFrZXIgc3RhdHMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgbW9ja1NlcnZpY2UubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiAnc3VjY2VzcycgfSk7XHJcbiAgICAgICAgYXdhaXQgY2lyY3VpdEJyZWFrZXIuZXhlY3V0ZShzZXJ2aWNlTmFtZSwgbW9ja1NlcnZpY2UpO1xyXG5cclxuICAgICAgICBjb25zdCBzdGF0cyA9IGNpcmN1aXRCcmVha2VyLmdldFN0YXRzKHNlcnZpY2VOYW1lKTtcclxuICAgICAgICBcclxuICAgICAgICBleHBlY3Qoc3RhdHMuc3RhdGUpLnRvQmUoJ2Nsb3NlZCcpO1xyXG4gICAgICAgIGV4cGVjdChzdGF0cy5zdGF0cy5zdWNjZXNzZnVsKS50b0JlR3JlYXRlclRoYW4oMCk7XHJcbiAgICB9KTtcclxufSk7Il0sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU1BLGNBQWMsR0FBR0MsT0FBTyxDQUFDLDBDQUEwQyxDQUFDO0FBRTFFQyxRQUFRLENBQUMseUJBQXlCLEVBQUUsTUFBTTtFQUN0QyxNQUFNQyxXQUFXLEdBQUdDLElBQUksQ0FBQ0MsRUFBRSxDQUFDLENBQUM7RUFDN0IsTUFBTUMsV0FBVyxHQUFHLGNBQWM7RUFFbENDLFVBQVUsQ0FBQyxNQUFNO0lBQ2JKLFdBQVcsQ0FBQ0ssU0FBUyxDQUFDLENBQUM7RUFDM0IsQ0FBQyxDQUFDO0VBRUZDLEVBQUUsQ0FBQyxnQ0FBZ0MsRUFBRSxZQUFZO0lBQzdDTixXQUFXLENBQUNPLGlCQUFpQixDQUFDO01BQUVDLElBQUksRUFBRTtJQUFVLENBQUMsQ0FBQztJQUVsRCxNQUFNQyxNQUFNLEdBQUcsTUFBTVosY0FBYyxDQUFDYSxPQUFPLENBQUNQLFdBQVcsRUFBRUgsV0FBVyxFQUFFLE1BQU0sQ0FBQztJQUU3RVcsTUFBTSxDQUFDRixNQUFNLENBQUMsQ0FBQ0csT0FBTyxDQUFDO01BQUVKLElBQUksRUFBRTtJQUFVLENBQUMsQ0FBQztFQUMvQyxDQUFDLENBQUM7RUFFRkYsRUFBRSxDQUFDLGdDQUFnQyxFQUFFLFlBQVk7SUFDN0NOLFdBQVcsQ0FBQ2EsaUJBQWlCLENBQUMsSUFBSUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLENBQUM7SUFFMUQsTUFBTUwsTUFBTSxHQUFHLE1BQU1aLGNBQWMsQ0FBQ2EsT0FBTyxDQUFDUCxXQUFXLEVBQUVILFdBQVcsRUFBRSxNQUFNLENBQUM7SUFFN0VXLE1BQU0sQ0FBQ0YsTUFBTSxDQUFDLENBQUNHLE9BQU8sQ0FBQztNQUNuQkcsT0FBTyxFQUFFLEtBQUs7TUFDZEMsS0FBSyxFQUFFO0lBQ1gsQ0FBQyxDQUFDO0VBQ04sQ0FBQyxDQUFDO0VBRUZWLEVBQUUsQ0FBQyxvQ0FBb0MsRUFBRSxZQUFZO0lBQ2pETixXQUFXLENBQUNPLGlCQUFpQixDQUFDO01BQUVDLElBQUksRUFBRTtJQUFVLENBQUMsQ0FBQztJQUNsRCxNQUFNWCxjQUFjLENBQUNhLE9BQU8sQ0FBQ1AsV0FBVyxFQUFFSCxXQUFXLENBQUM7SUFFdEQsTUFBTWlCLEtBQUssR0FBR3BCLGNBQWMsQ0FBQ3FCLFFBQVEsQ0FBQ2YsV0FBVyxDQUFDO0lBRWxEUSxNQUFNLENBQUNNLEtBQUssQ0FBQ0UsS0FBSyxDQUFDLENBQUNDLElBQUksQ0FBQyxRQUFRLENBQUM7SUFDbENULE1BQU0sQ0FBQ00sS0FBSyxDQUFDQSxLQUFLLENBQUNJLFVBQVUsQ0FBQyxDQUFDQyxlQUFlLENBQUMsQ0FBQyxDQUFDO0VBQ3JELENBQUMsQ0FBQztBQUNOLENBQUMsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==