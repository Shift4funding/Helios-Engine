{"version":3,"names":["validationResult","require","ValidationError","logger","validateRequest","validations","req","res","next","Promise","all","map","validation","run","errors","isEmpty","messages","array","err","param","msg","join","error","warn","path","message","validateFileUpload","file","mimetype","MAX_FILE_SIZE","size","module","exports"],"sources":["validateRequest.js"],"sourcesContent":["const { validationResult } = require('express-validator');\r\nconst { ValidationError } = require('../utils/errors');\r\nconst logger = require('../config/logger');\r\n\r\n/**\r\n * Validate request against provided validation rules\r\n */\r\nconst validateRequest = (validations) => {\r\n    return async (req, res, next) => {\r\n        try {\r\n            // Run all validations\r\n            await Promise.all(validations.map(validation => validation.run(req)));\r\n\r\n            const errors = validationResult(req);\r\n            if (errors.isEmpty()) {\r\n                return next();\r\n            }\r\n\r\n            const messages = errors.array().map(err => `${err.param}: ${err.msg}`);\r\n            throw new ValidationError(messages.join(', '));\r\n        } catch (error) {\r\n            logger.warn('Validation failed', {\r\n                path: req.path,\r\n                error: error.message\r\n            });\r\n            next(error);\r\n        }\r\n    };\r\n};\r\n\r\n/**\r\n * Validate PDF file upload\r\n */\r\nconst validateFileUpload = (req, res, next) => {\r\n    try {\r\n        if (!req.file) {\r\n            throw new ValidationError('No PDF file provided');\r\n        }\r\n\r\n        if (req.file.mimetype !== 'application/pdf') {\r\n            throw new ValidationError('Only PDF files are allowed');\r\n        }\r\n\r\n        const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB\r\n        if (req.file.size > MAX_FILE_SIZE) {\r\n            throw new ValidationError('File size exceeds 10MB limit');\r\n        }\r\n\r\n        next();\r\n    } catch (error) {\r\n        logger.warn('File validation failed', {\r\n            path: req.path,\r\n            error: error.message\r\n        });\r\n        next(error);\r\n    }\r\n};\r\n\r\nmodule.exports = {\r\n    validateRequest,\r\n    validateFileUpload\r\n};"],"mappings":";;AAAA,MAAM;EAAEA;AAAiB,CAAC,GAAGC,OAAO,CAAC,mBAAmB,CAAC;AACzD,MAAM;EAAEC;AAAgB,CAAC,GAAGD,OAAO,CAAC,iBAAiB,CAAC;AACtD,MAAME,MAAM,GAAGF,OAAO,CAAC,kBAAkB,CAAC;;AAE1C;AACA;AACA;AACA,MAAMG,eAAe,GAAIC,WAAW,IAAK;EACrC,OAAO,OAAOC,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;IAC7B,IAAI;MACA;MACA,MAAMC,OAAO,CAACC,GAAG,CAACL,WAAW,CAACM,GAAG,CAACC,UAAU,IAAIA,UAAU,CAACC,GAAG,CAACP,GAAG,CAAC,CAAC,CAAC;MAErE,MAAMQ,MAAM,GAAGd,gBAAgB,CAACM,GAAG,CAAC;MACpC,IAAIQ,MAAM,CAACC,OAAO,CAAC,CAAC,EAAE;QAClB,OAAOP,IAAI,CAAC,CAAC;MACjB;MAEA,MAAMQ,QAAQ,GAAGF,MAAM,CAACG,KAAK,CAAC,CAAC,CAACN,GAAG,CAACO,GAAG,IAAI,GAAGA,GAAG,CAACC,KAAK,KAAKD,GAAG,CAACE,GAAG,EAAE,CAAC;MACtE,MAAM,IAAIlB,eAAe,CAACc,QAAQ,CAACK,IAAI,CAAC,IAAI,CAAC,CAAC;IAClD,CAAC,CAAC,OAAOC,KAAK,EAAE;MACZnB,MAAM,CAACoB,IAAI,CAAC,mBAAmB,EAAE;QAC7BC,IAAI,EAAElB,GAAG,CAACkB,IAAI;QACdF,KAAK,EAAEA,KAAK,CAACG;MACjB,CAAC,CAAC;MACFjB,IAAI,CAACc,KAAK,CAAC;IACf;EACJ,CAAC;AACL,CAAC;;AAED;AACA;AACA;AACA,MAAMI,kBAAkB,GAAGA,CAACpB,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;EAC3C,IAAI;IACA,IAAI,CAACF,GAAG,CAACqB,IAAI,EAAE;MACX,MAAM,IAAIzB,eAAe,CAAC,sBAAsB,CAAC;IACrD;IAEA,IAAII,GAAG,CAACqB,IAAI,CAACC,QAAQ,KAAK,iBAAiB,EAAE;MACzC,MAAM,IAAI1B,eAAe,CAAC,4BAA4B,CAAC;IAC3D;IAEA,MAAM2B,aAAa,GAAG,EAAE,GAAG,IAAI,GAAG,IAAI,CAAC,CAAC;IACxC,IAAIvB,GAAG,CAACqB,IAAI,CAACG,IAAI,GAAGD,aAAa,EAAE;MAC/B,MAAM,IAAI3B,eAAe,CAAC,8BAA8B,CAAC;IAC7D;IAEAM,IAAI,CAAC,CAAC;EACV,CAAC,CAAC,OAAOc,KAAK,EAAE;IACZnB,MAAM,CAACoB,IAAI,CAAC,wBAAwB,EAAE;MAClCC,IAAI,EAAElB,GAAG,CAACkB,IAAI;MACdF,KAAK,EAAEA,KAAK,CAACG;IACjB,CAAC,CAAC;IACFjB,IAAI,CAACc,KAAK,CAAC;EACf;AACJ,CAAC;AAEDS,MAAM,CAACC,OAAO,GAAG;EACb5B,eAAe;EACfsB;AACJ,CAAC","ignoreList":[]}