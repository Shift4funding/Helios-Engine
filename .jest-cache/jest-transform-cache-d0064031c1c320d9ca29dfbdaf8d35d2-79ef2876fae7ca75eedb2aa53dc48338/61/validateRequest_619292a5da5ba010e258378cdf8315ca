0aab4e56d18ce0e34bc1ccd383b989ec
"use strict";

const {
  validationResult
} = require('express-validator');
const {
  ValidationError
} = require('../utils/errors');
const logger = require('../config/logger');

/**
 * Validate request against provided validation rules
 */
const validateRequest = validations => {
  return async (req, res, next) => {
    try {
      // Run all validations
      await Promise.all(validations.map(validation => validation.run(req)));
      const errors = validationResult(req);
      if (errors.isEmpty()) {
        return next();
      }
      const messages = errors.array().map(err => `${err.param}: ${err.msg}`);
      throw new ValidationError(messages.join(', '));
    } catch (error) {
      logger.warn('Validation failed', {
        path: req.path,
        error: error.message
      });
      next(error);
    }
  };
};

/**
 * Validate PDF file upload
 */
const validateFileUpload = (req, res, next) => {
  try {
    if (!req.file) {
      throw new ValidationError('No PDF file provided');
    }
    if (req.file.mimetype !== 'application/pdf') {
      throw new ValidationError('Only PDF files are allowed');
    }
    const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB
    if (req.file.size > MAX_FILE_SIZE) {
      throw new ValidationError('File size exceeds 10MB limit');
    }
    next();
  } catch (error) {
    logger.warn('File validation failed', {
      path: req.path,
      error: error.message
    });
    next(error);
  }
};
module.exports = {
  validateRequest,
  validateFileUpload
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ2YWxpZGF0aW9uUmVzdWx0IiwicmVxdWlyZSIsIlZhbGlkYXRpb25FcnJvciIsImxvZ2dlciIsInZhbGlkYXRlUmVxdWVzdCIsInZhbGlkYXRpb25zIiwicmVxIiwicmVzIiwibmV4dCIsIlByb21pc2UiLCJhbGwiLCJtYXAiLCJ2YWxpZGF0aW9uIiwicnVuIiwiZXJyb3JzIiwiaXNFbXB0eSIsIm1lc3NhZ2VzIiwiYXJyYXkiLCJlcnIiLCJwYXJhbSIsIm1zZyIsImpvaW4iLCJlcnJvciIsIndhcm4iLCJwYXRoIiwibWVzc2FnZSIsInZhbGlkYXRlRmlsZVVwbG9hZCIsImZpbGUiLCJtaW1ldHlwZSIsIk1BWF9GSUxFX1NJWkUiLCJzaXplIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInZhbGlkYXRlUmVxdWVzdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IHZhbGlkYXRpb25SZXN1bHQgfSA9IHJlcXVpcmUoJ2V4cHJlc3MtdmFsaWRhdG9yJyk7XHJcbmNvbnN0IHsgVmFsaWRhdGlvbkVycm9yIH0gPSByZXF1aXJlKCcuLi91dGlscy9lcnJvcnMnKTtcclxuY29uc3QgbG9nZ2VyID0gcmVxdWlyZSgnLi4vY29uZmlnL2xvZ2dlcicpO1xyXG5cclxuLyoqXHJcbiAqIFZhbGlkYXRlIHJlcXVlc3QgYWdhaW5zdCBwcm92aWRlZCB2YWxpZGF0aW9uIHJ1bGVzXHJcbiAqL1xyXG5jb25zdCB2YWxpZGF0ZVJlcXVlc3QgPSAodmFsaWRhdGlvbnMpID0+IHtcclxuICAgIHJldHVybiBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAvLyBSdW4gYWxsIHZhbGlkYXRpb25zXHJcbiAgICAgICAgICAgIGF3YWl0IFByb21pc2UuYWxsKHZhbGlkYXRpb25zLm1hcCh2YWxpZGF0aW9uID0+IHZhbGlkYXRpb24ucnVuKHJlcSkpKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGVycm9ycyA9IHZhbGlkYXRpb25SZXN1bHQocmVxKTtcclxuICAgICAgICAgICAgaWYgKGVycm9ycy5pc0VtcHR5KCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXh0KCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gZXJyb3JzLmFycmF5KCkubWFwKGVyciA9PiBgJHtlcnIucGFyYW19OiAke2Vyci5tc2d9YCk7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IobWVzc2FnZXMuam9pbignLCAnKSk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLndhcm4oJ1ZhbGlkYXRpb24gZmFpbGVkJywge1xyXG4gICAgICAgICAgICAgICAgcGF0aDogcmVxLnBhdGgsXHJcbiAgICAgICAgICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgbmV4dChlcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBWYWxpZGF0ZSBQREYgZmlsZSB1cGxvYWRcclxuICovXHJcbmNvbnN0IHZhbGlkYXRlRmlsZVVwbG9hZCA9IChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBpZiAoIXJlcS5maWxlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoJ05vIFBERiBmaWxlIHByb3ZpZGVkJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAocmVxLmZpbGUubWltZXR5cGUgIT09ICdhcHBsaWNhdGlvbi9wZGYnKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoJ09ubHkgUERGIGZpbGVzIGFyZSBhbGxvd2VkJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBNQVhfRklMRV9TSVpFID0gMTAgKiAxMDI0ICogMTAyNDsgLy8gMTBNQlxyXG4gICAgICAgIGlmIChyZXEuZmlsZS5zaXplID4gTUFYX0ZJTEVfU0laRSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKCdGaWxlIHNpemUgZXhjZWVkcyAxME1CIGxpbWl0Jyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBuZXh0KCk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGxvZ2dlci53YXJuKCdGaWxlIHZhbGlkYXRpb24gZmFpbGVkJywge1xyXG4gICAgICAgICAgICBwYXRoOiByZXEucGF0aCxcclxuICAgICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2VcclxuICAgICAgICB9KTtcclxuICAgICAgICBuZXh0KGVycm9yKTtcclxuICAgIH1cclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gICAgdmFsaWRhdGVSZXF1ZXN0LFxyXG4gICAgdmFsaWRhdGVGaWxlVXBsb2FkXHJcbn07Il0sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU07RUFBRUE7QUFBaUIsQ0FBQyxHQUFHQyxPQUFPLENBQUMsbUJBQW1CLENBQUM7QUFDekQsTUFBTTtFQUFFQztBQUFnQixDQUFDLEdBQUdELE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQztBQUN0RCxNQUFNRSxNQUFNLEdBQUdGLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQzs7QUFFMUM7QUFDQTtBQUNBO0FBQ0EsTUFBTUcsZUFBZSxHQUFJQyxXQUFXLElBQUs7RUFDckMsT0FBTyxPQUFPQyxHQUFHLEVBQUVDLEdBQUcsRUFBRUMsSUFBSSxLQUFLO0lBQzdCLElBQUk7TUFDQTtNQUNBLE1BQU1DLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDTCxXQUFXLENBQUNNLEdBQUcsQ0FBQ0MsVUFBVSxJQUFJQSxVQUFVLENBQUNDLEdBQUcsQ0FBQ1AsR0FBRyxDQUFDLENBQUMsQ0FBQztNQUVyRSxNQUFNUSxNQUFNLEdBQUdkLGdCQUFnQixDQUFDTSxHQUFHLENBQUM7TUFDcEMsSUFBSVEsTUFBTSxDQUFDQyxPQUFPLENBQUMsQ0FBQyxFQUFFO1FBQ2xCLE9BQU9QLElBQUksQ0FBQyxDQUFDO01BQ2pCO01BRUEsTUFBTVEsUUFBUSxHQUFHRixNQUFNLENBQUNHLEtBQUssQ0FBQyxDQUFDLENBQUNOLEdBQUcsQ0FBQ08sR0FBRyxJQUFJLEdBQUdBLEdBQUcsQ0FBQ0MsS0FBSyxLQUFLRCxHQUFHLENBQUNFLEdBQUcsRUFBRSxDQUFDO01BQ3RFLE1BQU0sSUFBSWxCLGVBQWUsQ0FBQ2MsUUFBUSxDQUFDSyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbEQsQ0FBQyxDQUFDLE9BQU9DLEtBQUssRUFBRTtNQUNabkIsTUFBTSxDQUFDb0IsSUFBSSxDQUFDLG1CQUFtQixFQUFFO1FBQzdCQyxJQUFJLEVBQUVsQixHQUFHLENBQUNrQixJQUFJO1FBQ2RGLEtBQUssRUFBRUEsS0FBSyxDQUFDRztNQUNqQixDQUFDLENBQUM7TUFDRmpCLElBQUksQ0FBQ2MsS0FBSyxDQUFDO0lBQ2Y7RUFDSixDQUFDO0FBQ0wsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQSxNQUFNSSxrQkFBa0IsR0FBR0EsQ0FBQ3BCLEdBQUcsRUFBRUMsR0FBRyxFQUFFQyxJQUFJLEtBQUs7RUFDM0MsSUFBSTtJQUNBLElBQUksQ0FBQ0YsR0FBRyxDQUFDcUIsSUFBSSxFQUFFO01BQ1gsTUFBTSxJQUFJekIsZUFBZSxDQUFDLHNCQUFzQixDQUFDO0lBQ3JEO0lBRUEsSUFBSUksR0FBRyxDQUFDcUIsSUFBSSxDQUFDQyxRQUFRLEtBQUssaUJBQWlCLEVBQUU7TUFDekMsTUFBTSxJQUFJMUIsZUFBZSxDQUFDLDRCQUE0QixDQUFDO0lBQzNEO0lBRUEsTUFBTTJCLGFBQWEsR0FBRyxFQUFFLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFDO0lBQ3hDLElBQUl2QixHQUFHLENBQUNxQixJQUFJLENBQUNHLElBQUksR0FBR0QsYUFBYSxFQUFFO01BQy9CLE1BQU0sSUFBSTNCLGVBQWUsQ0FBQyw4QkFBOEIsQ0FBQztJQUM3RDtJQUVBTSxJQUFJLENBQUMsQ0FBQztFQUNWLENBQUMsQ0FBQyxPQUFPYyxLQUFLLEVBQUU7SUFDWm5CLE1BQU0sQ0FBQ29CLElBQUksQ0FBQyx3QkFBd0IsRUFBRTtNQUNsQ0MsSUFBSSxFQUFFbEIsR0FBRyxDQUFDa0IsSUFBSTtNQUNkRixLQUFLLEVBQUVBLEtBQUssQ0FBQ0c7SUFDakIsQ0FBQyxDQUFDO0lBQ0ZqQixJQUFJLENBQUNjLEtBQUssQ0FBQztFQUNmO0FBQ0osQ0FBQztBQUVEUyxNQUFNLENBQUNDLE9BQU8sR0FBRztFQUNiNUIsZUFBZTtFQUNmc0I7QUFDSixDQUFDIiwiaWdub3JlTGlzdCI6W119