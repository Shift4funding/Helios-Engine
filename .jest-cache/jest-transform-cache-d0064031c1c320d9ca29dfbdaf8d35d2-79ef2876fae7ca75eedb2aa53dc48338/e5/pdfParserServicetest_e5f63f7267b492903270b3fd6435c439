7878dcb1be3538079ee86943f1fd3e8b
"use strict";

_getJestObj().mock('pdf-parse', () => ({
  __esModule: true,
  default: jest.fn()
}));
function _getJestObj() {
  const {
    jest
  } = require("@jest/globals");
  _getJestObj = () => jest;
  return jest;
}
const {
  PDFParseError
} = require('../../src/utils/errors');
const pdfParserService = require('../../src/services/pdfParserService');
const fs = require('fs').promises;
const path = require('path');
describe('PDF Parser Service', () => {
  const mockPdfData = `
        Statement Period: 05/01/2025 to 05/31/2025
        Account Holder: John Doe
        Account Number: ****1234
        
        Transaction History:
        05/15/2025 GROCERY STORE -$50.00
        05/16/2025 SALARY DEPOSIT +$2000.00
    `;
  beforeEach(() => {
    require('pdf-parse').default.mockReset();
  });
  it('should successfully parse PDF content', async () => {
    require('pdf-parse').default.mockResolvedValue({
      text: mockPdfData
    });
    const buffer = Buffer.from('mock pdf content');
    const result = await pdfParserService.parsePDF(buffer);
    expect(result).toMatchObject({
      accountInfo: {
        accountHolder: 'John Doe',
        accountNumber: '****1234',
        statementPeriod: {
          start: '05/01/2025',
          end: '05/31/2025'
        }
      },
      transactions: [{
        date: '05/15/2025',
        description: 'GROCERY STORE',
        debit: 50.00,
        credit: null
      }, {
        date: '05/16/2025',
        description: 'SALARY DEPOSIT',
        debit: null,
        credit: 2000.00
      }]
    });
  });
  it('should handle invalid PDF content', async () => {
    require('pdf-parse').default.mockRejectedValue(new Error('Failed to parse PDF'));
    const buffer = Buffer.from('invalid pdf');
    await expect(pdfParserService.parsePDF(buffer)).rejects.toThrow(PDFParseError);
  });
  it('should handle missing transaction data', async () => {
    require('pdf-parse').default.mockResolvedValue({
      text: 'Statement Period: 05/01/2025 to 05/31/2025\nNo transactions found'
    });
    const buffer = Buffer.from('pdf with no transactions');
    const result = await pdfParserService.parsePDF(buffer);
    expect(result.transactions).toHaveLength(0);
  });
  it('should extract account information correctly', async () => {
    require('pdf-parse').default.mockResolvedValue({
      text: `
                Statement Period: 06/01/2025 to 06/30/2025
                Account Holder: Jane Smith
                Account Number: ****5678
            `
    });
    const buffer = Buffer.from('mock pdf content');
    const result = await pdfParserService.parsePDF(buffer);
    expect(result.accountInfo).toEqual({
      accountHolder: 'Jane Smith',
      accountNumber: '****5678',
      statementPeriod: {
        start: '06/01/2025',
        end: '06/30/2025'
      }
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2V0SmVzdE9iaiIsIm1vY2siLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsImplc3QiLCJmbiIsInJlcXVpcmUiLCJQREZQYXJzZUVycm9yIiwicGRmUGFyc2VyU2VydmljZSIsImZzIiwicHJvbWlzZXMiLCJwYXRoIiwiZGVzY3JpYmUiLCJtb2NrUGRmRGF0YSIsImJlZm9yZUVhY2giLCJtb2NrUmVzZXQiLCJpdCIsIm1vY2tSZXNvbHZlZFZhbHVlIiwidGV4dCIsImJ1ZmZlciIsIkJ1ZmZlciIsImZyb20iLCJyZXN1bHQiLCJwYXJzZVBERiIsImV4cGVjdCIsInRvTWF0Y2hPYmplY3QiLCJhY2NvdW50SW5mbyIsImFjY291bnRIb2xkZXIiLCJhY2NvdW50TnVtYmVyIiwic3RhdGVtZW50UGVyaW9kIiwic3RhcnQiLCJlbmQiLCJ0cmFuc2FjdGlvbnMiLCJkYXRlIiwiZGVzY3JpcHRpb24iLCJkZWJpdCIsImNyZWRpdCIsIm1vY2tSZWplY3RlZFZhbHVlIiwiRXJyb3IiLCJyZWplY3RzIiwidG9UaHJvdyIsInRvSGF2ZUxlbmd0aCIsInRvRXF1YWwiXSwic291cmNlcyI6WyJwZGZQYXJzZXJTZXJ2aWNlLnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyBQREZQYXJzZUVycm9yIH0gPSByZXF1aXJlKCcuLi8uLi9zcmMvdXRpbHMvZXJyb3JzJyk7XHJcbmNvbnN0IHBkZlBhcnNlclNlcnZpY2UgPSByZXF1aXJlKCcuLi8uLi9zcmMvc2VydmljZXMvcGRmUGFyc2VyU2VydmljZScpO1xyXG5jb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJykucHJvbWlzZXM7XHJcbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XHJcblxyXG5qZXN0Lm1vY2soJ3BkZi1wYXJzZScsICgpID0+ICh7XHJcbiAgICBfX2VzTW9kdWxlOiB0cnVlLFxyXG4gICAgZGVmYXVsdDogamVzdC5mbigpXHJcbn0pKTtcclxuXHJcbmRlc2NyaWJlKCdQREYgUGFyc2VyIFNlcnZpY2UnLCAoKSA9PiB7XHJcbiAgICBjb25zdCBtb2NrUGRmRGF0YSA9IGBcclxuICAgICAgICBTdGF0ZW1lbnQgUGVyaW9kOiAwNS8wMS8yMDI1IHRvIDA1LzMxLzIwMjVcclxuICAgICAgICBBY2NvdW50IEhvbGRlcjogSm9obiBEb2VcclxuICAgICAgICBBY2NvdW50IE51bWJlcjogKioqKjEyMzRcclxuICAgICAgICBcclxuICAgICAgICBUcmFuc2FjdGlvbiBIaXN0b3J5OlxyXG4gICAgICAgIDA1LzE1LzIwMjUgR1JPQ0VSWSBTVE9SRSAtJDUwLjAwXHJcbiAgICAgICAgMDUvMTYvMjAyNSBTQUxBUlkgREVQT1NJVCArJDIwMDAuMDBcclxuICAgIGA7XHJcblxyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgcmVxdWlyZSgncGRmLXBhcnNlJykuZGVmYXVsdC5tb2NrUmVzZXQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgc3VjY2Vzc2Z1bGx5IHBhcnNlIFBERiBjb250ZW50JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIHJlcXVpcmUoJ3BkZi1wYXJzZScpLmRlZmF1bHQubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgICAgICB0ZXh0OiBtb2NrUGRmRGF0YVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBidWZmZXIgPSBCdWZmZXIuZnJvbSgnbW9jayBwZGYgY29udGVudCcpO1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBkZlBhcnNlclNlcnZpY2UucGFyc2VQREYoYnVmZmVyKTtcclxuXHJcbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9NYXRjaE9iamVjdCh7XHJcbiAgICAgICAgICAgIGFjY291bnRJbmZvOiB7XHJcbiAgICAgICAgICAgICAgICBhY2NvdW50SG9sZGVyOiAnSm9obiBEb2UnLFxyXG4gICAgICAgICAgICAgICAgYWNjb3VudE51bWJlcjogJyoqKioxMjM0JyxcclxuICAgICAgICAgICAgICAgIHN0YXRlbWVudFBlcmlvZDoge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0OiAnMDUvMDEvMjAyNScsXHJcbiAgICAgICAgICAgICAgICAgICAgZW5kOiAnMDUvMzEvMjAyNSdcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdHJhbnNhY3Rpb25zOiBbXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0ZTogJzA1LzE1LzIwMjUnLFxyXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnR1JPQ0VSWSBTVE9SRScsXHJcbiAgICAgICAgICAgICAgICAgICAgZGViaXQ6IDUwLjAwLFxyXG4gICAgICAgICAgICAgICAgICAgIGNyZWRpdDogbnVsbFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRlOiAnMDUvMTYvMjAyNScsXHJcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdTQUxBUlkgREVQT1NJVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgZGViaXQ6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgY3JlZGl0OiAyMDAwLjAwXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgUERGIGNvbnRlbnQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgcmVxdWlyZSgncGRmLXBhcnNlJykuZGVmYXVsdC5tb2NrUmVqZWN0ZWRWYWx1ZShcclxuICAgICAgICAgICAgbmV3IEVycm9yKCdGYWlsZWQgdG8gcGFyc2UgUERGJylcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBjb25zdCBidWZmZXIgPSBCdWZmZXIuZnJvbSgnaW52YWxpZCBwZGYnKTtcclxuICAgICAgICBhd2FpdCBleHBlY3QocGRmUGFyc2VyU2VydmljZS5wYXJzZVBERihidWZmZXIpKVxyXG4gICAgICAgICAgICAucmVqZWN0c1xyXG4gICAgICAgICAgICAudG9UaHJvdyhQREZQYXJzZUVycm9yKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1pc3NpbmcgdHJhbnNhY3Rpb24gZGF0YScsIGFzeW5jICgpID0+IHtcclxuICAgICAgICByZXF1aXJlKCdwZGYtcGFyc2UnKS5kZWZhdWx0Lm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICAgICAgdGV4dDogJ1N0YXRlbWVudCBQZXJpb2Q6IDA1LzAxLzIwMjUgdG8gMDUvMzEvMjAyNVxcbk5vIHRyYW5zYWN0aW9ucyBmb3VuZCdcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgYnVmZmVyID0gQnVmZmVyLmZyb20oJ3BkZiB3aXRoIG5vIHRyYW5zYWN0aW9ucycpO1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBkZlBhcnNlclNlcnZpY2UucGFyc2VQREYoYnVmZmVyKTtcclxuXHJcbiAgICAgICAgZXhwZWN0KHJlc3VsdC50cmFuc2FjdGlvbnMpLnRvSGF2ZUxlbmd0aCgwKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgZXh0cmFjdCBhY2NvdW50IGluZm9ybWF0aW9uIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcclxuICAgICAgICByZXF1aXJlKCdwZGYtcGFyc2UnKS5kZWZhdWx0Lm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICAgICAgdGV4dDogYFxyXG4gICAgICAgICAgICAgICAgU3RhdGVtZW50IFBlcmlvZDogMDYvMDEvMjAyNSB0byAwNi8zMC8yMDI1XHJcbiAgICAgICAgICAgICAgICBBY2NvdW50IEhvbGRlcjogSmFuZSBTbWl0aFxyXG4gICAgICAgICAgICAgICAgQWNjb3VudCBOdW1iZXI6ICoqKio1Njc4XHJcbiAgICAgICAgICAgIGBcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgYnVmZmVyID0gQnVmZmVyLmZyb20oJ21vY2sgcGRmIGNvbnRlbnQnKTtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwZGZQYXJzZXJTZXJ2aWNlLnBhcnNlUERGKGJ1ZmZlcik7XHJcblxyXG4gICAgICAgIGV4cGVjdChyZXN1bHQuYWNjb3VudEluZm8pLnRvRXF1YWwoe1xyXG4gICAgICAgICAgICBhY2NvdW50SG9sZGVyOiAnSmFuZSBTbWl0aCcsXHJcbiAgICAgICAgICAgIGFjY291bnROdW1iZXI6ICcqKioqNTY3OCcsXHJcbiAgICAgICAgICAgIHN0YXRlbWVudFBlcmlvZDoge1xyXG4gICAgICAgICAgICAgICAgc3RhcnQ6ICcwNi8wMS8yMDI1JyxcclxuICAgICAgICAgICAgICAgIGVuZDogJzA2LzMwLzIwMjUnXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59KTsiXSwibWFwcGluZ3MiOiI7O0FBS0FBLFdBQUEsR0FBS0MsSUFBSSxDQUFDLFdBQVcsRUFBRSxPQUFPO0VBQzFCQyxVQUFVLEVBQUUsSUFBSTtFQUNoQkMsT0FBTyxFQUFFQyxJQUFJLENBQUNDLEVBQUUsQ0FBQztBQUNyQixDQUFDLENBQUMsQ0FBQztBQUFDLFNBQUFMLFlBQUE7RUFBQTtJQUFBSTtFQUFBLElBQUFFLE9BQUE7RUFBQU4sV0FBQSxHQUFBQSxDQUFBLEtBQUFJLElBQUE7RUFBQSxPQUFBQSxJQUFBO0FBQUE7QUFSSixNQUFNO0VBQUVHO0FBQWMsQ0FBQyxHQUFHRCxPQUFPLENBQUMsd0JBQXdCLENBQUM7QUFDM0QsTUFBTUUsZ0JBQWdCLEdBQUdGLE9BQU8sQ0FBQyxxQ0FBcUMsQ0FBQztBQUN2RSxNQUFNRyxFQUFFLEdBQUdILE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQ0ksUUFBUTtBQUNqQyxNQUFNQyxJQUFJLEdBQUdMLE9BQU8sQ0FBQyxNQUFNLENBQUM7QUFPNUJNLFFBQVEsQ0FBQyxvQkFBb0IsRUFB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