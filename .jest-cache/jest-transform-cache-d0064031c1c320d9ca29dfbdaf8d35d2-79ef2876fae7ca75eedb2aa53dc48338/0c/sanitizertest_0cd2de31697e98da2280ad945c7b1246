f93092ee24c1f29c305f9c05e225a714
"use strict";

const {
  sanitizeRequest,
  sanitizeValue,
  sanitizeObject
} = require('../../src/middleware/sanitizer');
describe('Sanitization Middleware', () => {
  let mockReq;
  let mockRes;
  let mockNext;
  beforeEach(() => {
    mockReq = {
      body: {},
      query: {},
      params: {}
    };
    mockRes = {};
    mockNext = jest.fn();
  });
  it('should sanitize HTML in request body', () => {
    mockReq.body = {
      text: '<script>alert("xss")</script>Hello',
      nested: {
        html: '<img src="x" onerror="alert(1)">'
      }
    };
    sanitizeRequest(mockReq, mockRes, mockNext);
    expect(mockReq.body.text).toBe('Hello');
    expect(mockReq.body.nested.html).toBe('');
  });
  it('should handle arrays in request body', () => {
    mockReq.body = {
      items: ['<b>test</b>', '<script>alert(1)</script>']
    };
    sanitizeRequest(mockReq, mockRes, mockNext);
    expect(mockReq.body.items[0]).toBe('test');
    expect(mockReq.body.items[1]).toBe('');
  });
  it('should preserve non-string values', () => {
    mockReq.body = {
      number: 123,
      boolean: true,
      null: null
    };
    sanitizeRequest(mockReq, mockRes, mockNext);
    expect(mockReq.body).toEqual({
      number: 123,
      boolean: true,
      null: null
    });
  });
  it('should skip file uploads', () => {
    const file = {
      buffer: Buffer.from('test')
    };
    mockReq.file = file;
    mockReq.body = {
      text: 'test'
    };
    sanitizeRequest(mockReq, mockRes, mockNext);
    expect(mockReq.file).toBe(file);
    expect(mockReq.body.text).toBe('test');
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJzYW5pdGl6ZVJlcXVlc3QiLCJzYW5pdGl6ZVZhbHVlIiwic2FuaXRpemVPYmplY3QiLCJyZXF1aXJlIiwiZGVzY3JpYmUiLCJtb2NrUmVxIiwibW9ja1JlcyIsIm1vY2tOZXh0IiwiYmVmb3JlRWFjaCIsImJvZHkiLCJxdWVyeSIsInBhcmFtcyIsImplc3QiLCJmbiIsIml0IiwidGV4dCIsIm5lc3RlZCIsImh0bWwiLCJleHBlY3QiLCJ0b0JlIiwiaXRlbXMiLCJudW1iZXIiLCJib29sZWFuIiwibnVsbCIsInRvRXF1YWwiLCJmaWxlIiwiYnVmZmVyIiwiQnVmZmVyIiwiZnJvbSJdLCJzb3VyY2VzIjpbInNhbml0aXplci50ZXN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgc2FuaXRpemVSZXF1ZXN0LCBzYW5pdGl6ZVZhbHVlLCBzYW5pdGl6ZU9iamVjdCB9ID0gcmVxdWlyZSgnLi4vLi4vc3JjL21pZGRsZXdhcmUvc2FuaXRpemVyJyk7XHJcblxyXG5kZXNjcmliZSgnU2FuaXRpemF0aW9uIE1pZGRsZXdhcmUnLCAoKSA9PiB7XHJcbiAgICBsZXQgbW9ja1JlcTtcclxuICAgIGxldCBtb2NrUmVzO1xyXG4gICAgbGV0IG1vY2tOZXh0O1xyXG5cclxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgIG1vY2tSZXEgPSB7XHJcbiAgICAgICAgICAgIGJvZHk6IHt9LFxyXG4gICAgICAgICAgICBxdWVyeToge30sXHJcbiAgICAgICAgICAgIHBhcmFtczoge31cclxuICAgICAgICB9O1xyXG4gICAgICAgIG1vY2tSZXMgPSB7fTtcclxuICAgICAgICBtb2NrTmV4dCA9IGplc3QuZm4oKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgc2FuaXRpemUgSFRNTCBpbiByZXF1ZXN0IGJvZHknLCAoKSA9PiB7XHJcbiAgICAgICAgbW9ja1JlcS5ib2R5ID0ge1xyXG4gICAgICAgICAgICB0ZXh0OiAnPHNjcmlwdD5hbGVydChcInhzc1wiKTwvc2NyaXB0PkhlbGxvJyxcclxuICAgICAgICAgICAgbmVzdGVkOiB7XHJcbiAgICAgICAgICAgICAgICBodG1sOiAnPGltZyBzcmM9XCJ4XCIgb25lcnJvcj1cImFsZXJ0KDEpXCI+J1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgc2FuaXRpemVSZXF1ZXN0KG1vY2tSZXEsIG1vY2tSZXMsIG1vY2tOZXh0KTtcclxuXHJcbiAgICAgICAgZXhwZWN0KG1vY2tSZXEuYm9keS50ZXh0KS50b0JlKCdIZWxsbycpO1xyXG4gICAgICAgIGV4cGVjdChtb2NrUmVxLmJvZHkubmVzdGVkLmh0bWwpLnRvQmUoJycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgYXJyYXlzIGluIHJlcXVlc3QgYm9keScsICgpID0+IHtcclxuICAgICAgICBtb2NrUmVxLmJvZHkgPSB7XHJcbiAgICAgICAgICAgIGl0ZW1zOiBbJzxiPnRlc3Q8L2I+JywgJzxzY3JpcHQ+YWxlcnQoMSk8L3NjcmlwdD4nXVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHNhbml0aXplUmVxdWVzdChtb2NrUmVxLCBtb2NrUmVzLCBtb2NrTmV4dCk7XHJcblxyXG4gICAgICAgIGV4cGVjdChtb2NrUmVxLmJvZHkuaXRlbXNbMF0pLnRvQmUoJ3Rlc3QnKTtcclxuICAgICAgICBleHBlY3QobW9ja1JlcS5ib2R5Lml0ZW1zWzFdKS50b0JlKCcnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcHJlc2VydmUgbm9uLXN0cmluZyB2YWx1ZXMnLCAoKSA9PiB7XHJcbiAgICAgICAgbW9ja1JlcS5ib2R5ID0ge1xyXG4gICAgICAgICAgICBudW1iZXI6IDEyMyxcclxuICAgICAgICAgICAgYm9vbGVhbjogdHJ1ZSxcclxuICAgICAgICAgICAgbnVsbDogbnVsbFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHNhbml0aXplUmVxdWVzdChtb2NrUmVxLCBtb2NrUmVzLCBtb2NrTmV4dCk7XHJcblxyXG4gICAgICAgIGV4cGVjdChtb2NrUmVxLmJvZHkpLnRvRXF1YWwoe1xyXG4gICAgICAgICAgICBudW1iZXI6IDEyMyxcclxuICAgICAgICAgICAgYm9vbGVhbjogdHJ1ZSxcclxuICAgICAgICAgICAgbnVsbDogbnVsbFxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBza2lwIGZpbGUgdXBsb2FkcycsICgpID0+IHtcclxuICAgICAgICBjb25zdCBmaWxlID0geyBidWZmZXI6IEJ1ZmZlci5mcm9tKCd0ZXN0JykgfTtcclxuICAgICAgICBtb2NrUmVxLmZpbGUgPSBmaWxlO1xyXG4gICAgICAgIG1vY2tSZXEuYm9keSA9IHsgdGV4dDogJ3Rlc3QnIH07XHJcblxyXG4gICAgICAgIHNhbml0aXplUmVxdWVzdChtb2NrUmVxLCBtb2NrUmVzLCBtb2NrTmV4dCk7XHJcblxyXG4gICAgICAgIGV4cGVjdChtb2NrUmVxLmZpbGUpLnRvQmUoZmlsZSk7XHJcbiAgICAgICAgZXhwZWN0KG1vY2tSZXEuYm9keS50ZXh0KS50b0JlKCd0ZXN0Jyk7XHJcbiAgICB9KTtcclxufSk7Il0sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU07RUFBRUEsZUFBZTtFQUFFQyxhQUFhO0VBQUVDO0FBQWUsQ0FBQyxHQUFHQyxPQUFPLENBQUMsZ0NBQWdDLENBQUM7QUFFcEdDLFFBQVEsQ0FBQyx5QkFBeUIsRUFBRSxNQUFNO0VBQ3RDLElBQUlDLE9BQU87RUFDWCxJQUFJQyxPQUFPO0VBQ1gsSUFBSUMsUUFBUTtFQUVaQyxVQUFVLENBQUMsTUFBTTtJQUNiSCxPQUFPLEdBQUc7TUFDTkksSUFBSSxFQUFFLENBQUMsQ0FBQztNQUNSQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO01BQ1RDLE1BQU0sRUFBRSxDQUFDO0lBQ2IsQ0FBQztJQUNETCxPQUFPLEdBQUcsQ0FBQyxDQUFDO0lBQ1pDLFFBQVEsR0FBR0ssSUFBSSxDQUFDQyxFQUFFLENBQUMsQ0FBQztFQUN4QixDQUFDLENBQUM7RUFFRkMsRUFBRSxDQUFDLHNDQUFzQyxFQUFFLE1BQU07SUFDN0NULE9BQU8sQ0FBQ0ksSUFBSSxHQUFHO01BQ1hNLElBQUksRUFBRSxvQ0FBb0M7TUFDMUNDLE1BQU0sRUFBRTtRQUNKQyxJQUFJLEVBQUU7TUFDVjtJQUNKLENBQUM7SUFFRGpCLGVBQWUsQ0FBQ0ssT0FBTyxFQUFFQyxPQUFPLEVBQUVDLFFBQVEsQ0FBQztJQUUzQ1csTUFBTSxDQUFDYixPQUFPLENBQUNJLElBQUksQ0FBQ00sSUFBSSxDQUFDLENBQUNJLElBQUksQ0FBQyxPQUFPLENBQUM7SUFDdkNELE1BQU0sQ0FBQ2IsT0FBTyxDQUFDSSxJQUFJLENBQUNPLE1BQU0sQ0FBQ0MsSUFBSSxDQUFDLENBQUNFLElBQUksQ0FBQyxFQUFFLENBQUM7RUFDN0MsQ0FBQyxDQUFDO0VBRUZMLEVBQUUsQ0FBQyxzQ0FBc0MsRUFBRSxNQUFNO0lBQzdDVCxPQUFPLENBQUNJLElBQUksR0FBRztNQUNYVyxLQUFLLEVBQUUsQ0FBQyxhQUFhLEVBQUUsMkJBQTJCO0lBQ3RELENBQUM7SUFFRHBCLGVBQWUsQ0FBQ0ssT0FBTyxFQUFFQyxPQUFPLEVBQUVDLFFBQVEsQ0FBQztJQUUzQ1csTUFBTSxDQUFDYixPQUFPLENBQUNJLElBQUksQ0FBQ1csS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUNELElBQUksQ0FBQyxNQUFNLENBQUM7SUFDMUNELE1BQU0sQ0FBQ2IsT0FBTyxDQUFDSSxJQUFJLENBQUNXLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDRCxJQUFJLENBQUMsRUFBRSxDQUFDO0VBQzFDLENBQUMsQ0FBQztFQUVGTCxFQUFFLENBQUMsbUNBQW1DLEVBQUUsTUFBTTtJQUMxQ1QsT0FBTyxDQUFDSSxJQUFJLEdBQUc7TUFDWFksTUFBTSxFQUFFLEdBQUc7TUFDWEMsT0FBTyxFQUFFLElBQUk7TUFDYkMsSUFBSSxFQUFFO0lBQ1YsQ0FBQztJQUVEdkIsZUFBZSxDQUFDSyxPQUFPLEVBQUVDLE9BQU8sRUFBRUMsUUFBUSxDQUFDO0lBRTNDVyxNQUFNLENBQUNiLE9BQU8sQ0FBQ0ksSUFBSSxDQUFDLENBQUNlLE9BQU8sQ0FBQztNQUN6QkgsTUFBTSxFQUFFLEdBQUc7TUFDWEMsT0FBTyxFQUFFLElBQUk7TUFDYkMsSUFBSSxFQUFFO0lBQ1YsQ0FBQyxDQUFDO0VBQ04sQ0FBQyxDQUFDO0VBRUZULEVBQUUsQ0FBQywwQkFBMEIsRUFBRSxNQUFNO0lBQ2pDLE1BQU1XLElBQUksR0FBRztNQUFFQyxNQUFNLEVBQUVDLE1BQU0sQ0FBQ0MsSUFBSSxDQUFDLE1BQU07SUFBRSxDQUFDO0lBQzVDdkIsT0FBTyxDQUFDb0IsSUFBSSxHQUFHQSxJQUFJO0lBQ25CcEIsT0FBTyxDQUFDSSxJQUFJLEdBQUc7TUFBRU0sSUFBSSxFQUFFO0lBQU8sQ0FBQztJQUUvQmYsZUFBZSxDQUFDSyxPQUFPLEVBQUVDLE9BQU8sRUFBRUMsUUFBUSxDQUFDO0lBRTNDVyxNQUFNLENBQUNiLE9BQU8sQ0FBQ29CLElBQUksQ0FBQyxDQUFDTixJQUFJLENBQUNNLElBQUksQ0FBQztJQUMvQlAsTUFBTSxDQUFDYixPQUFPLENBQUNJLElBQUksQ0FBQ00sSUFBSSxDQUFDLENBQUNJLElBQUksQ0FBQyxNQUFNLENBQUM7RUFDMUMsQ0FBQyxDQUFDO0FBQ04sQ0FBQyxDQUFDIiwiaWdub3JlTGlzdCI6W119