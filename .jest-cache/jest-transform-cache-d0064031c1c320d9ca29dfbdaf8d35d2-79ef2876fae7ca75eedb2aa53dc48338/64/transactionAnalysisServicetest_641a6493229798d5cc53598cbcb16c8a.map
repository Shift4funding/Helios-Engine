{"version":3,"names":["setupTestDatabase","cleanupTestDatabase","require","TransactionAnalysisService","Transaction","describe","service","mockData","beforeAll","sampleTransactions","date","Date","description","amount","category","afterEach","jest","clearAllMocks","mocks","beforeEach","hrtime","spyOn","process","mockImplementation","time","memoryUsage","mockReturnValue","heapUsed","countDocuments","mockResolvedValue","Object","values","forEach","mock","mockRestore","it","metrics","calculatePerformanceMetrics","expect","toMatchObject","processingTime","any","Number","transactionsProcessed","toEqual","toHaveBeenCalledTimes","mockRejectedValueOnce","Error","rejects","toThrow","mockResolvedValueOnce","toBe"],"sources":["transactionAnalysisService.test.js"],"sourcesContent":["const { setupTestDatabase, cleanupTestDatabase } = require('../helpers/testDb');\r\nconst TransactionAnalysisService = require('../../src/services/transactionAnalysisService');\r\nconst Transaction = require('../../src/models/Transaction');\r\n\r\ndescribe('Transaction Analysis Service', () => {\r\n    let service;\r\n    let mockData;\r\n\r\n    // Initialize test data and service\r\n    beforeAll(() => {\r\n        service = new TransactionAnalysisService();\r\n        mockData = {\r\n            sampleTransactions: [\r\n                {\r\n                    date: new Date('2025-01-01'),\r\n                    description: 'SALARY DEPOSIT',\r\n                    amount: 5000,\r\n                    category: 'income'\r\n                },\r\n                {\r\n                    date: new Date('2025-01-15'),\r\n                    description: 'RENT',\r\n                    amount: -2000,\r\n                    category: 'expense'\r\n                }\r\n            ]\r\n        };\r\n    });\r\n\r\n    // Clean up after each test\r\n    afterEach(() => {\r\n        jest.clearAllMocks();\r\n    });\r\n\r\n    // Performance metrics tests with proper isolation\r\n    describe('performance metrics', () => {\r\n        let mocks;\r\n\r\n        beforeEach(() => {\r\n            // Setup all mocks in a controlled way\r\n            mocks = {\r\n                hrtime: jest.spyOn(process, 'hrtime')\r\n                    .mockImplementation((time) => time ? [1, 0] : [0, 0]),\r\n                \r\n                memoryUsage: jest.spyOn(process, 'memoryUsage')\r\n                    .mockReturnValue({ heapUsed: 1024 * 1024 }),\r\n                \r\n                countDocuments: jest.spyOn(Transaction, 'countDocuments')\r\n                    .mockResolvedValue(2)\r\n            };\r\n        });\r\n\r\n        afterEach(() => {\r\n            // Restore each mock individually\r\n            Object.values(mocks).forEach(mock => mock.mockRestore());\r\n        });\r\n\r\n        it('should calculate performance metrics correctly', async () => {\r\n            // Act\r\n            const metrics = await service.calculatePerformanceMetrics();\r\n\r\n            // Assert structure\r\n            expect(metrics).toMatchObject({\r\n                processingTime: expect.any(Number),\r\n                memoryUsage: expect.any(Number),\r\n                transactionsProcessed: expect.any(Number)\r\n            });\r\n\r\n            // Assert specific values\r\n            expect(metrics).toEqual({\r\n                processingTime: 1,\r\n                memoryUsage: 1024 * 1024,\r\n                transactionsProcessed: 2\r\n            });\r\n\r\n            // Verify mock calls\r\n            expect(mocks.hrtime).toHaveBeenCalledTimes(2);\r\n            expect(mocks.memoryUsage).toHaveBeenCalledTimes(1);\r\n            expect(mocks.countDocuments).toHaveBeenCalledTimes(1);\r\n        });\r\n\r\n        it('should handle database errors', async () => {\r\n            // Arrange\r\n            mocks.countDocuments.mockRejectedValueOnce(new Error('Database error'));\r\n\r\n            // Act & Assert\r\n            await expect(service.calculatePerformanceMetrics())\r\n                .rejects.toThrow('Failed to calculate performance metrics');\r\n        });\r\n\r\n        it('should handle empty database', async () => {\r\n            // Arrange\r\n            mocks.countDocuments.mockResolvedValueOnce(0);\r\n\r\n            // Act\r\n            const metrics = await service.calculatePerformanceMetrics();\r\n\r\n            // Assert\r\n            expect(metrics.transactionsProcessed).toBe(0);\r\n        });\r\n    });\r\n});"],"mappings":"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","ignoreList":[]}