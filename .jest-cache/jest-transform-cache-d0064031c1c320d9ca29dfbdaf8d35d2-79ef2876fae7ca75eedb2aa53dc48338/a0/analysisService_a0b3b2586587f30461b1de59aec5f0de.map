{"version":3,"names":["PDFParserService","require","cacheService","AnalysisService","analyzeStatement","filePath","bankType","analysisId","Date","now","parsedData","parsePDF","analysis","id","summary","generateSummary","transactions","categories","categorizeTransactions","trends","analyzeTrends","timestamp","toISOString","set","error","Error","message","totalIncome","filter","t","amount","reduce","sum","totalExpenses","Math","abs","transactionCount","length","dateRange","start","min","map","date","end","max","monthly","acc","trans","monthKey","getFullYear","getMonth","income","expenses","averageMonthlyIncome","Object","values","m","keys","averageMonthlyExpenses","generateZohoReport","financialMetrics","calculateTotalIncome","calculateTotalExpenses","netCashFlow","calculateNetCashFlow","categoryBreakdown","getCategoryBreakdown","getMonthlyTrends","recurring","findRecurringTransactions","insights","generateInsights","module","exports"],"sources":["analysisService.js"],"sourcesContent":["const PDFParserService = require('./pdfParserService');\r\nconst cacheService = require('./cacheService');\r\n\r\nclass AnalysisService {\r\n    async analyzeStatement(filePath, bankType) {\r\n        try {\r\n            // Generate unique analysis ID\r\n            const analysisId = `analysis_${Date.now()}`;\r\n            \r\n            // Parse PDF and extract transactions\r\n            const parsedData = await PDFParserService.parsePDF(filePath, bankType);\r\n            \r\n            // Perform analysis\r\n            const analysis = {\r\n                id: analysisId,\r\n                summary: this.generateSummary(parsedData.transactions),\r\n                categories: await PDFParserService.categorizeTransactions(parsedData.transactions),\r\n                trends: this.analyzeTrends(parsedData.transactions),\r\n                timestamp: new Date().toISOString()\r\n            };\r\n\r\n            // Cache results\r\n            await cacheService.set(`analysis:${analysisId}`, analysis);\r\n            \r\n            return analysis;\r\n        } catch (error) {\r\n            throw new Error(`Analysis failed: ${error.message}`);\r\n        }\r\n    }\r\n\r\n    generateSummary(transactions) {\r\n        return {\r\n            totalIncome: transactions.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0),\r\n            totalExpenses: Math.abs(transactions.filter(t => t.amount < 0).reduce((sum, t) => sum + t.amount, 0)),\r\n            transactionCount: transactions.length,\r\n            dateRange: {\r\n                start: new Date(Math.min(...transactions.map(t => new Date(t.date)))),\r\n                end: new Date(Math.max(...transactions.map(t => new Date(t.date))))\r\n            }\r\n        };\r\n    }\r\n\r\n    analyzeTrends(transactions) {\r\n        // Group by month\r\n        const monthly = transactions.reduce((acc, trans) => {\r\n            const date = new Date(trans.date);\r\n            const monthKey = `${date.getFullYear()}-${date.getMonth() + 1}`;\r\n            \r\n            acc[monthKey] = acc[monthKey] || { income: 0, expenses: 0 };\r\n            if (trans.amount > 0) {\r\n                acc[monthKey].income += trans.amount;\r\n            } else {\r\n                acc[monthKey].expenses += Math.abs(trans.amount);\r\n            }\r\n            \r\n            return acc;\r\n        }, {});\r\n\r\n        return {\r\n            monthly,\r\n            averageMonthlyIncome: Object.values(monthly).reduce((sum, m) => sum + m.income, 0) / Object.keys(monthly).length,\r\n            averageMonthlyExpenses: Object.values(monthly).reduce((sum, m) => sum + m.expenses, 0) / Object.keys(monthly).length\r\n        };\r\n    }\r\n\r\n    async generateZohoReport(transactions) {\r\n        return {\r\n            financialMetrics: {\r\n                totalIncome: this.calculateTotalIncome(transactions),\r\n                totalExpenses: this.calculateTotalExpenses(transactions),\r\n                netCashFlow: this.calculateNetCashFlow(transactions),\r\n                categoryBreakdown: this.getCategoryBreakdown(transactions)\r\n            },\r\n            trends: {\r\n                monthly: this.getMonthlyTrends(transactions),\r\n                recurring: this.findRecurringTransactions(transactions)\r\n            },\r\n            insights: await this.generateInsights(transactions)\r\n        };\r\n    }\r\n\r\n    findRecurringTransactions(transactions) {\r\n        // Identify monthly patterns\r\n        // Group similar amounts\r\n        // Match descriptions\r\n    }\r\n}\r\n\r\nmodule.exports = new AnalysisService();"],"mappings":"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","ignoreList":[]}