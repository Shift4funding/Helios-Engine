e1f197f42b03ba968deab0ff8c05f13d
"use strict";

const Redis = require('ioredis');
const logger = require('../config/logger');
class HealthCheck {
  constructor() {
    this.redisClient = new Redis({
      host: process.env.REDIS_HOST,
      port: process.env.REDIS_PORT,
      password: process.env.REDIS_PASSWORD
    });
  }
  async check() {
    try {
      const startTime = Date.now();
      await this.redisClient.ping();
      const latency = Date.now() - startTime;
      return {
        status: 'healthy',
        redis: {
          status: 'up',
          latency: `${latency}ms`
        }
      };
    } catch (error) {
      logger.error('Redis health check failed:', error);
      return {
        status: 'unhealthy',
        redis: {
          status: 'down',
          error: error.message
        }
      };
    }
  }
  middleware() {
    return async (req, res) => {
      const health = await this.check();
      const statusCode = health.status === 'healthy' ? 200 : 503;
      res.status(statusCode).json(health);
    };
  }
}
module.exports = new HealthCheck();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSZWRpcyIsInJlcXVpcmUiLCJsb2dnZXIiLCJIZWFsdGhDaGVjayIsImNvbnN0cnVjdG9yIiwicmVkaXNDbGllbnQiLCJob3N0IiwicHJvY2VzcyIsImVudiIsIlJFRElTX0hPU1QiLCJwb3J0IiwiUkVESVNfUE9SVCIsInBhc3N3b3JkIiwiUkVESVNfUEFTU1dPUkQiLCJjaGVjayIsInN0YXJ0VGltZSIsIkRhdGUiLCJub3ciLCJwaW5nIiwibGF0ZW5jeSIsInN0YXR1cyIsInJlZGlzIiwiZXJyb3IiLCJtZXNzYWdlIiwibWlkZGxld2FyZSIsInJlcSIsInJlcyIsImhlYWx0aCIsInN0YXR1c0NvZGUiLCJqc29uIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbImhlYWx0aENoZWNrLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFJlZGlzID0gcmVxdWlyZSgnaW9yZWRpcycpO1xyXG5jb25zdCBsb2dnZXIgPSByZXF1aXJlKCcuLi9jb25maWcvbG9nZ2VyJyk7XHJcblxyXG5jbGFzcyBIZWFsdGhDaGVjayB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLnJlZGlzQ2xpZW50ID0gbmV3IFJlZGlzKHtcclxuICAgICAgICAgICAgaG9zdDogcHJvY2Vzcy5lbnYuUkVESVNfSE9TVCxcclxuICAgICAgICAgICAgcG9ydDogcHJvY2Vzcy5lbnYuUkVESVNfUE9SVCxcclxuICAgICAgICAgICAgcGFzc3dvcmQ6IHByb2Nlc3MuZW52LlJFRElTX1BBU1NXT1JEXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgY2hlY2soKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5yZWRpc0NsaWVudC5waW5nKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGxhdGVuY3kgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHN0YXR1czogJ2hlYWx0aHknLFxyXG4gICAgICAgICAgICAgICAgcmVkaXM6IHtcclxuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICd1cCcsXHJcbiAgICAgICAgICAgICAgICAgICAgbGF0ZW5jeTogYCR7bGF0ZW5jeX1tc2BcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoJ1JlZGlzIGhlYWx0aCBjaGVjayBmYWlsZWQ6JywgZXJyb3IpO1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgc3RhdHVzOiAndW5oZWFsdGh5JyxcclxuICAgICAgICAgICAgICAgIHJlZGlzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAnZG93bicsXHJcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2VcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbWlkZGxld2FyZSgpIHtcclxuICAgICAgICByZXR1cm4gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGhlYWx0aCA9IGF3YWl0IHRoaXMuY2hlY2soKTtcclxuICAgICAgICAgICAgY29uc3Qgc3RhdHVzQ29kZSA9IGhlYWx0aC5zdGF0dXMgPT09ICdoZWFsdGh5JyA/IDIwMCA6IDUwMztcclxuICAgICAgICAgICAgcmVzLnN0YXR1cyhzdGF0dXNDb2RlKS5qc29uKGhlYWx0aCk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBuZXcgSGVhbHRoQ2hlY2soKTsiXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTUEsS0FBSyxHQUFHQyxPQUFPLENBQUMsU0FBUyxDQUFDO0FBQ2hDLE1BQU1DLE1BQU0sR0FBR0QsT0FBTyxDQUFDLGtCQUFrQixDQUFDO0FBRTFDLE1BQU1FLFdBQVcsQ0FBQztFQUNkQyxXQUFXQSxDQUFBLEVBQUc7SUFDVixJQUFJLENBQUNDLFdBQVcsR0FBRyxJQUFJTCxLQUFLLENBQUM7TUFDekJNLElBQUksRUFBRUMsT0FBTyxDQUFDQyxHQUFHLENBQUNDLFVBQVU7TUFDNUJDLElBQUksRUFBRUgsT0FBTyxDQUFDQyxHQUFHLENBQUNHLFVBQVU7TUFDNUJDLFFBQVEsRUFBRUwsT0FBTyxDQUFDQyxHQUFHLENBQUNLO0lBQzFCLENBQUMsQ0FBQztFQUNOO0VBRUEsTUFBTUMsS0FBS0EsQ0FBQSxFQUFHO0lBQ1YsSUFBSTtNQUNBLE1BQU1DLFNBQVMsR0FBR0MsSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQztNQUM1QixNQUFNLElBQUksQ0FBQ1osV0FBVyxDQUFDYSxJQUFJLENBQUMsQ0FBQztNQUM3QixNQUFNQyxPQUFPLEdBQUdILElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUMsR0FBR0YsU0FBUztNQUV0QyxPQUFPO1FBQ0hLLE1BQU0sRUFBRSxTQUFTO1FBQ2pCQyxLQUFLLEVBQUU7VUFDSEQsTUFBTSxFQUFFLElBQUk7VUFDWkQsT0FBTyxFQUFFLEdBQUdBLE9BQU87UUFDdkI7TUFDSixDQUFDO0lBQ0wsQ0FBQyxDQUFDLE9BQU9HLEtBQUssRUFBRTtNQUNacEIsTUFBTSxDQUFDb0IsS0FBSyxDQUFDLDRCQUE0QixFQUFFQSxLQUFLLENBQUM7TUFDakQsT0FBTztRQUNIRixNQUFNLEVBQUUsV0FBVztRQUNuQkMsS0FBSyxFQUFFO1VBQ0hELE1BQU0sRUFBRSxNQUFNO1VBQ2RFLEtBQUssRUFBRUEsS0FBSyxDQUFDQztRQUNqQjtNQUNKLENBQUM7SUFDTDtFQUNKO0VBRUFDLFVBQVVBLENBQUEsRUFBRztJQUNULE9BQU8sT0FBT0MsR0FBRyxFQUFFQyxHQUFHLEtBQUs7TUFDdkIsTUFBTUMsTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDYixLQUFLLENBQUMsQ0FBQztNQUNqQyxNQUFNYyxVQUFVLEdBQUdELE1BQU0sQ0FBQ1AsTUFBTSxLQUFLLFNBQVMsR0FBRyxHQUFHLEdBQUcsR0FBRztNQUMxRE0sR0FBRyxDQUFDTixNQUFNLENBQUNRLFVBQVUsQ0FBQyxDQUFDQyxJQUFJLENBQUNGLE1BQU0sQ0FBQztJQUN2QyxDQUFDO0VBQ0w7QUFDSjtBQUVBRyxNQUFNLENBQUNDLE9BQU8sR0FBRyxJQUFJNUIsV0FBVyxDQUFDLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=