{"version":3,"names":["_getJestObj","mock","jest","require","analyzeBankStatement","pdfParserService","llmService","logger","describe","mockReq","mockRes","mockNext","beforeEach","file","buffer","Buffer","from","originalname","size","status","fn","mockReturnThis","json","clearAllMocks","it","mockParsedStatement","accountInfo","accountHolder","accountNumber","transactions","mockAnalysis","success","data","summary","patterns","parsePDF","mockResolvedValue","analyzeStatement","expect","toHaveBeenCalledWith","parsedStatement","analysis","undefined","objectContaining","statusCode","message","mockRejectedValue","Error","stringContaining"],"sources":["analysisController.test.js"],"sourcesContent":["const { analyzeBankStatement } = require('../../src/controllers/analysisController');\r\nconst pdfParserService = require('../../src/services/pdfParserService');\r\nconst llmService = require('../../src/services/llmService');\r\nconst logger = require('../../src/config/logger');\r\n\r\njest.mock('../../src/services/pdfParserService');\r\njest.mock('../../src/services/llmService');\r\njest.mock('../../src/config/logger');\r\n\r\ndescribe('Analysis Controller', () => {\r\n    let mockReq;\r\n    let mockRes;\r\n    let mockNext;\r\n\r\n    beforeEach(() => {\r\n        mockReq = {\r\n            file: {\r\n                buffer: Buffer.from('test pdf content'),\r\n                originalname: 'statement.pdf',\r\n                size: 1024\r\n            }\r\n        };\r\n        mockRes = {\r\n            status: jest.fn().mockReturnThis(),\r\n            json: jest.fn()\r\n        };\r\n        mockNext = jest.fn();\r\n        \r\n        // Clear all mocks\r\n        jest.clearAllMocks();\r\n    });\r\n\r\n    it('should successfully analyze a bank statement', async () => {\r\n        const mockParsedStatement = {\r\n            accountInfo: {\r\n                accountHolder: 'John Doe',\r\n                accountNumber: '****1234'\r\n            },\r\n            transactions: []\r\n        };\r\n\r\n        const mockAnalysis = {\r\n            success: true,\r\n            data: {\r\n                summary: 'Test summary',\r\n                patterns: 'Test patterns'\r\n            }\r\n        };\r\n\r\n        pdfParserService.parsePDF.mockResolvedValue(mockParsedStatement);\r\n        llmService.analyzeStatement.mockResolvedValue(mockAnalysis);\r\n\r\n        await analyzeBankStatement(mockReq, mockRes, mockNext);\r\n\r\n        expect(pdfParserService.parsePDF).toHaveBeenCalledWith(mockReq.file.buffer);\r\n        expect(llmService.analyzeStatement).toHaveBeenCalledWith(mockParsedStatement);\r\n        expect(mockRes.status).toHaveBeenCalledWith(200);\r\n        expect(mockRes.json).toHaveBeenCalledWith({\r\n            success: true,\r\n            data: {\r\n                parsedStatement: mockParsedStatement,\r\n                analysis: mockAnalysis.data\r\n            }\r\n        });\r\n    });\r\n\r\n    it('should handle missing PDF file', async () => {\r\n        mockReq.file = undefined;\r\n        \r\n        await analyzeBankStatement(mockReq, mockRes, mockNext);\r\n        \r\n        expect(mockNext).toHaveBeenCalledWith(\r\n            expect.objectContaining({\r\n                statusCode: 400,\r\n                message: 'No PDF file provided'\r\n            })\r\n        );\r\n    });\r\n\r\n    it('should handle PDF parsing errors', async () => {\r\n        pdfParserService.parsePDF.mockRejectedValue(new Error('PDF parsing failed'));\r\n        \r\n        await analyzeBankStatement(mockReq, mockRes, mockNext);\r\n        \r\n        expect(mockNext).toHaveBeenCalledWith(\r\n            expect.objectContaining({\r\n                message: expect.stringContaining('PDF parsing failed')\r\n            })\r\n        );\r\n    });\r\n\r\n    it('should handle LLM analysis errors', async () => {\r\n        const mockParsedStatement = { accountInfo: {}, transactions: [] };\r\n        \r\n        pdfParserService.parsePDF.mockResolvedValue(mockParsedStatement);\r\n        llmService.analyzeStatement.mockRejectedValue(new Error('Analysis failed'));\r\n        \r\n        await analyzeBankStatement(mockReq, mockRes, mockNext);\r\n        \r\n        expect(mockNext).toHaveBeenCalledWith(\r\n            expect.objectContaining({\r\n                message: expect.stringContaining('Analysis failed')\r\n            })\r\n        );\r\n    });\r\n});"],"mappings":"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","ignoreList":[]}