ad9e02255c52e7c469f929646e326b88
"use strict";

const CircuitBreaker = require('opossum');
const logger = require('../config/logger');
const defaultOptions = {
  timeout: 3000,
  errorThresholdPercentage: 50,
  resetTimeout: 30000
};
class CircuitBreakerService {
  create(fn, options = {}) {
    const breaker = new CircuitBreaker(fn, {
      ...defaultOptions,
      ...options
    });
    breaker.fallback(() => ({
      success: false,
      error: 'Service temporarily unavailable'
    }));
    breaker.on('success', () => {
      logger.info('Circuit Breaker: Success');
    });
    breaker.on('failure', () => {
      logger.warn('Circuit Breaker: Failure');
    });
    return breaker;
  }
}
module.exports = new CircuitBreakerService();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJDaXJjdWl0QnJlYWtlciIsInJlcXVpcmUiLCJsb2dnZXIiLCJkZWZhdWx0T3B0aW9ucyIsInRpbWVvdXQiLCJlcnJvclRocmVzaG9sZFBlcmNlbnRhZ2UiLCJyZXNldFRpbWVvdXQiLCJDaXJjdWl0QnJlYWtlclNlcnZpY2UiLCJjcmVhdGUiLCJmbiIsIm9wdGlvbnMiLCJicmVha2VyIiwiZmFsbGJhY2siLCJzdWNjZXNzIiwiZXJyb3IiLCJvbiIsImluZm8iLCJ3YXJuIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbImNpcmN1aXRCcmVha2VyU2VydmljZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBDaXJjdWl0QnJlYWtlciA9IHJlcXVpcmUoJ29wb3NzdW0nKTtcclxuY29uc3QgbG9nZ2VyID0gcmVxdWlyZSgnLi4vY29uZmlnL2xvZ2dlcicpO1xyXG5cclxuY29uc3QgZGVmYXVsdE9wdGlvbnMgPSB7XHJcbiAgICB0aW1lb3V0OiAzMDAwLFxyXG4gICAgZXJyb3JUaHJlc2hvbGRQZXJjZW50YWdlOiA1MCxcclxuICAgIHJlc2V0VGltZW91dDogMzAwMDBcclxufTtcclxuXHJcbmNsYXNzIENpcmN1aXRCcmVha2VyU2VydmljZSB7XHJcbiAgICBjcmVhdGUoZm4sIG9wdGlvbnMgPSB7fSkge1xyXG4gICAgICAgIGNvbnN0IGJyZWFrZXIgPSBuZXcgQ2lyY3VpdEJyZWFrZXIoZm4sIHtcclxuICAgICAgICAgICAgLi4uZGVmYXVsdE9wdGlvbnMsXHJcbiAgICAgICAgICAgIC4uLm9wdGlvbnNcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgYnJlYWtlci5mYWxsYmFjaygoKSA9PiAoe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgZXJyb3I6ICdTZXJ2aWNlIHRlbXBvcmFyaWx5IHVuYXZhaWxhYmxlJ1xyXG4gICAgICAgIH0pKTtcclxuXHJcbiAgICAgICAgYnJlYWtlci5vbignc3VjY2VzcycsICgpID0+IHtcclxuICAgICAgICAgICAgbG9nZ2VyLmluZm8oJ0NpcmN1aXQgQnJlYWtlcjogU3VjY2VzcycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBicmVha2VyLm9uKCdmYWlsdXJlJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBsb2dnZXIud2FybignQ2lyY3VpdCBCcmVha2VyOiBGYWlsdXJlJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBicmVha2VyO1xyXG4gICAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBDaXJjdWl0QnJlYWtlclNlcnZpY2UoKTsiXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTUEsY0FBYyxHQUFHQyxPQUFPLENBQUMsU0FBUyxDQUFDO0FBQ3pDLE1BQU1DLE1BQU0sR0FBR0QsT0FBTyxDQUFDLGtCQUFrQixDQUFDO0FBRTFDLE1BQU1FLGNBQWMsR0FBRztFQUNuQkMsT0FBTyxFQUFFLElBQUk7RUFDYkMsd0JBQXdCLEVBQUUsRUFBRTtFQUM1QkMsWUFBWSxFQUFFO0FBQ2xCLENBQUM7QUFFRCxNQUFNQyxxQkFBcUIsQ0FBQztFQUN4QkMsTUFBTUEsQ0FBQ0MsRUFBRSxFQUFFQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLEVBQUU7SUFDckIsTUFBTUMsT0FBTyxHQUFHLElBQUlYLGNBQWMsQ0FBQ1MsRUFBRSxFQUFFO01BQ25DLEdBQUdOLGNBQWM7TUFDakIsR0FBR087SUFDUCxDQUFDLENBQUM7SUFFRkMsT0FBTyxDQUFDQyxRQUFRLENBQUMsT0FBTztNQUNwQkMsT0FBTyxFQUFFLEtBQUs7TUFDZEMsS0FBSyxFQUFFO0lBQ1gsQ0FBQyxDQUFDLENBQUM7SUFFSEgsT0FBTyxDQUFDSSxFQUFFLENBQUMsU0FBUyxFQUFFLE1BQU07TUFDeEJiLE1BQU0sQ0FBQ2MsSUFBSSxDQUFDLDBCQUEwQixDQUFDO0lBQzNDLENBQUMsQ0FBQztJQUVGTCxPQUFPLENBQUNJLEVBQUUsQ0FBQyxTQUFTLEVBQUUsTUFBTTtNQUN4QmIsTUFBTSxDQUFDZSxJQUFJLENBQUMsMEJBQTBCLENBQUM7SUFDM0MsQ0FBQyxDQUFDO0lBRUYsT0FBT04sT0FBTztFQUNsQjtBQUNKO0FBRUFPLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHLElBQUlaLHFCQUFxQixDQUFDLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=