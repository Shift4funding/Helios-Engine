ad2027fbc0f450b67c6653ca56e59a0a
"use strict";

const request = require('supertest');
const path = require('path');
const app = require('../../src/app');
describe('Analysis Routes', () => {
  const FIXTURES_PATH = path.join(__dirname, '../fixtures');
  test('should reject requests without API key', async () => {
    const response = await request(app).post('/api/analysis/statement').attach('bankStatement', path.join(FIXTURES_PATH, 'sample-statement.pdf'));
    expect(response.status).toBe(401);
    expect(response.body).toHaveProperty('status', 'error');
    expect(response.body).toHaveProperty('message', 'Invalid or missing API key');
  });
  test('should handle PDF upload and analysis', async () => {
    const response = await request(app).post('/api/analysis/statement').set('X-API-Key', process.env.API_KEY).attach('bankStatement', path.join(FIXTURES_PATH, 'sample-statement.pdf'));
    expect(response.status).toBe(200);
    expect(response.body).toHaveProperty('success', true);
    expect(response.body.data).toHaveProperty('parsedStatement');
    expect(response.body.data).toHaveProperty('analysis');
  });
  test('should reject non-PDF files', async () => {
    const response = await request(app).post('/api/analysis/statement').set('X-API-Key', process.env.API_KEY).attach('bankStatement', path.join(FIXTURES_PATH, 'not-a-pdf.txt'));
    expect(response.status).toBe(400);
    expect(response.body).toHaveProperty('status', 'error');
    expect(response.body).toHaveProperty('message', 'Only PDF files are allowed');
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXF1ZXN0IiwicmVxdWlyZSIsInBhdGgiLCJhcHAiLCJkZXNjcmliZSIsIkZJWFRVUkVTX1BBVEgiLCJqb2luIiwiX19kaXJuYW1lIiwidGVzdCIsInJlc3BvbnNlIiwicG9zdCIsImF0dGFjaCIsImV4cGVjdCIsInN0YXR1cyIsInRvQmUiLCJib2R5IiwidG9IYXZlUHJvcGVydHkiLCJzZXQiLCJwcm9jZXNzIiwiZW52IiwiQVBJX0tFWSIsImRhdGEiXSwic291cmNlcyI6WyJhbmFseXNpc1JvdXRlcy50ZXN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHJlcXVlc3QgPSByZXF1aXJlKCdzdXBlcnRlc3QnKTtcclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcclxuY29uc3QgYXBwID0gcmVxdWlyZSgnLi4vLi4vc3JjL2FwcCcpO1xyXG5cclxuZGVzY3JpYmUoJ0FuYWx5c2lzIFJvdXRlcycsICgpID0+IHtcclxuICAgIGNvbnN0IEZJWFRVUkVTX1BBVEggPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vZml4dHVyZXMnKTtcclxuXHJcbiAgICB0ZXN0KCdzaG91bGQgcmVqZWN0IHJlcXVlc3RzIHdpdGhvdXQgQVBJIGtleScsIGFzeW5jICgpID0+IHtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxyXG4gICAgICAgICAgICAucG9zdCgnL2FwaS9hbmFseXNpcy9zdGF0ZW1lbnQnKVxyXG4gICAgICAgICAgICAuYXR0YWNoKCdiYW5rU3RhdGVtZW50JywgcGF0aC5qb2luKEZJWFRVUkVTX1BBVEgsICdzYW1wbGUtc3RhdGVtZW50LnBkZicpKTtcclxuXHJcbiAgICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSg0MDEpO1xyXG4gICAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0hhdmVQcm9wZXJ0eSgnc3RhdHVzJywgJ2Vycm9yJyk7XHJcbiAgICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvSGF2ZVByb3BlcnR5KCdtZXNzYWdlJywgJ0ludmFsaWQgb3IgbWlzc2luZyBBUEkga2V5Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIFBERiB1cGxvYWQgYW5kIGFuYWx5c2lzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXHJcbiAgICAgICAgICAgIC5wb3N0KCcvYXBpL2FuYWx5c2lzL3N0YXRlbWVudCcpXHJcbiAgICAgICAgICAgIC5zZXQoJ1gtQVBJLUtleScsIHByb2Nlc3MuZW52LkFQSV9LRVkpXHJcbiAgICAgICAgICAgIC5hdHRhY2goJ2JhbmtTdGF0ZW1lbnQnLCBwYXRoLmpvaW4oRklYVFVSRVNfUEFUSCwgJ3NhbXBsZS1zdGF0ZW1lbnQucGRmJykpO1xyXG5cclxuICAgICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XHJcbiAgICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvSGF2ZVByb3BlcnR5KCdzdWNjZXNzJywgdHJ1ZSk7XHJcbiAgICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuZGF0YSkudG9IYXZlUHJvcGVydHkoJ3BhcnNlZFN0YXRlbWVudCcpO1xyXG4gICAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmRhdGEpLnRvSGF2ZVByb3BlcnR5KCdhbmFseXNpcycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdCgnc2hvdWxkIHJlamVjdCBub24tUERGIGZpbGVzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXHJcbiAgICAgICAgICAgIC5wb3N0KCcvYXBpL2FuYWx5c2lzL3N0YXRlbWVudCcpXHJcbiAgICAgICAgICAgIC5zZXQoJ1gtQVBJLUtleScsIHByb2Nlc3MuZW52LkFQSV9LRVkpXHJcbiAgICAgICAgICAgIC5hdHRhY2goJ2JhbmtTdGF0ZW1lbnQnLCBwYXRoLmpvaW4oRklYVFVSRVNfUEFUSCwgJ25vdC1hLXBkZi50eHQnKSk7XHJcblxyXG4gICAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoNDAwKTtcclxuICAgICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9IYXZlUHJvcGVydHkoJ3N0YXR1cycsICdlcnJvcicpO1xyXG4gICAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0hhdmVQcm9wZXJ0eSgnbWVzc2FnZScsICdPbmx5IFBERiBmaWxlcyBhcmUgYWxsb3dlZCcpO1xyXG4gICAgfSk7XHJcbn0pOyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxXQUFXLENBQUM7QUFDcEMsTUFBTUMsSUFBSSxHQUFHRCxPQUFPLENBQUMsTUFBTSxDQUFDO0FBQzVCLE1BQU1FLEdBQUcsR0FBR0YsT0FBTyxDQUFDLGVBQWUsQ0FBQztBQUVwQ0csUUFBUSxDQUFDLGlCQUFpQixFQUFFLE1BQU07RUFDOUIsTUFBTUMsYUFBYSxHQUFHSCxJQUFJLENBQUNJLElBQUksQ0FBQ0MsU0FBUyxFQUFFLGFBQWEsQ0FBQztFQUV6REMsSUFBSSxDQUFDLHdDQUF3QyxFQUFFLFlBQVk7SUFDdkQsTUFBTUMsUUFBUSxHQUFHLE1BQU1ULE9BQU8sQ0FBQ0csR0FBRyxDQUFDLENBQzlCTyxJQUFJLENBQUMseUJBQXlCLENBQUMsQ0FDL0JDLE1BQU0sQ0FBQyxlQUFlLEVBQUVULElBQUksQ0FBQ0ksSUFBSSxDQUFDRCxhQUFhLEVBQUUsc0JBQXNCLENBQUMsQ0FBQztJQUU5RU8sTUFBTSxDQUFDSCxRQUFRLENBQUNJLE1BQU0sQ0FBQyxDQUFDQyxJQUFJLENBQUMsR0FBRyxDQUFDO0lBQ2pDRixNQUFNLENBQUNILFFBQVEsQ0FBQ00sSUFBSSxDQUFDLENBQUNDLGNBQWMsQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDO0lBQ3ZESixNQUFNLENBQUNILFFBQVEsQ0FBQ00sSUFBSSxDQUFDLENBQUNDLGNBQWMsQ0FBQyxTQUFTLEVBQUUsNEJBQTRCLENBQUM7RUFDakYsQ0FBQyxDQUFDO0VBRUZSLElBQUksQ0FBQyx1Q0FBdUMsRUFBRSxZQUFZO0lBQ3RELE1BQU1DLFFBQVEsR0FBRyxNQUFNVCxPQUFPLENBQUNHLEdBQUcsQ0FBQyxDQUM5Qk8sSUFBSSxDQUFDLHlCQUF5QixDQUFDLENBQy9CTyxHQUFHLENBQUMsV0FBVyxFQUFFQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsT0FBTyxDQUFDLENBQ3JDVCxNQUFNLENBQUMsZUFBZSxFQUFFVCxJQUFJLENBQUNJLElBQUksQ0FBQ0QsYUFBYSxFQUFFLHNCQUFzQixDQUFDLENBQUM7SUFFOUVPLE1BQU0sQ0FBQ0gsUUFBUSxDQUFDSSxNQUFNLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLEdBQUcsQ0FBQztJQUNqQ0YsTUFBTSxDQUFDSCxRQUFRLENBQUNNLElBQUksQ0FBQyxDQUFDQyxjQUFjLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQztJQUNyREosTUFBTSxDQUFDSCxRQUFRLENBQUNNLElBQUksQ0FBQ00sSUFBSSxDQUFDLENBQUNMLGNBQWMsQ0FBQyxpQkFBaUIsQ0FBQztJQUM1REosTUFBTSxDQUFDSCxRQUFRLENBQUNNLElBQUksQ0FBQ00sSUFBSSxDQUFDLENBQUNMLGNBQWMsQ0FBQyxVQUFVLENBQUM7RUFDekQsQ0FBQyxDQUFDO0VBRUZSLElBQUksQ0FBQyw2QkFBNkIsRUFBRSxZQUFZO0lBQzVDLE1BQU1DLFFBQVEsR0FBRyxNQUFNVCxPQUFPLENBQUNHLEdBQUcsQ0FBQyxDQUM5Qk8sSUFBSSxDQUFDLHlCQUF5QixDQUFDLENBQy9CTyxHQUFHLENBQUMsV0FBVyxFQUFFQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsT0FBTyxDQUFDLENBQ3JDVCxNQUFNLENBQUMsZUFBZSxFQUFFVCxJQUFJLENBQUNJLElBQUksQ0FBQ0QsYUFBYSxFQUFFLGVBQWUsQ0FBQyxDQUFDO0lBRXZFTyxNQUFNLENBQUNILFFBQVEsQ0FBQ0ksTUFBTSxDQUFDLENBQUNDLElBQUksQ0FBQyxHQUFHLENBQUM7SUFDakNGLE1BQU0sQ0FBQ0gsUUFBUSxDQUFDTSxJQUFJLENBQUMsQ0FBQ0MsY0FBYyxDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUM7SUFDdkRKLE1BQU0sQ0FBQ0gsUUFBUSxDQUFDTSxJQUFJLENBQUMsQ0FBQ0MsY0FBYyxDQUFDLFNBQVMsRUFBRSw0QkFBNEIsQ0FBQztFQUNqRixDQUFDLENBQUM7QUFDTixDQUFDLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=