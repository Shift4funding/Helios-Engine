52473f02189633cee0a9bd10dc148486
"use strict";

const pdfParse = require('pdf-parse');
const logger = require('../config/logger');
const BankFormatFactory = require('../utils/bankFormatFactory');
const ChaseParser = require('../parsers/chaseParser');
const BOAParser = require('../parsers/boaParser');
const WellsFargoParser = require('../parsers/wellsFargoParser');
class PDFParserService {
  constructor() {
    this.parsers = {
      CHASE: new ChaseParser(),
      BANK_OF_AMERICA: new BOAParser(),
      WELLS_FARGO: new WellsFargoParser()
    };
  }
  async parseStatement(buffer, bankType = 'CHASE') {
    try {
      const parser = this.parsers[bankType];
      if (!parser) {
        throw new Error(`Unsupported bank type: ${bankType}`);
      }
      const data = await parser.parse(buffer);
      return this.validateTransactions(data);
    } catch (error) {
      logger.error('PDF parsing failed:', error);
      throw error;
    }
  }
  validateTransactions(data) {
    const formatter = BankFormatFactory.getFormatter(data.metadata.bankType);
    const transactions = formatter.parseTransactions(data.text);
    return {
      transactions,
      metadata: {
        pageCount: data.metadata.pageCount,
        bankType: data.metadata.bankType,
        parsed: new Date().toISOString()
      }
    };
  }
}
module.exports = new PDFParserService();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJwZGZQYXJzZSIsInJlcXVpcmUiLCJsb2dnZXIiLCJCYW5rRm9ybWF0RmFjdG9yeSIsIkNoYXNlUGFyc2VyIiwiQk9BUGFyc2VyIiwiV2VsbHNGYXJnb1BhcnNlciIsIlBERlBhcnNlclNlcnZpY2UiLCJjb25zdHJ1Y3RvciIsInBhcnNlcnMiLCJDSEFTRSIsIkJBTktfT0ZfQU1FUklDQSIsIldFTExTX0ZBUkdPIiwicGFyc2VTdGF0ZW1lbnQiLCJidWZmZXIiLCJiYW5rVHlwZSIsInBhcnNlciIsIkVycm9yIiwiZGF0YSIsInBhcnNlIiwidmFsaWRhdGVUcmFuc2FjdGlvbnMiLCJlcnJvciIsImZvcm1hdHRlciIsImdldEZvcm1hdHRlciIsIm1ldGFkYXRhIiwidHJhbnNhY3Rpb25zIiwicGFyc2VUcmFuc2FjdGlvbnMiLCJ0ZXh0IiwicGFnZUNvdW50IiwicGFyc2VkIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInBkZlBhcnNlclNlcnZpY2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcGRmUGFyc2UgPSByZXF1aXJlKCdwZGYtcGFyc2UnKTtcclxuY29uc3QgbG9nZ2VyID0gcmVxdWlyZSgnLi4vY29uZmlnL2xvZ2dlcicpO1xyXG5jb25zdCBCYW5rRm9ybWF0RmFjdG9yeSA9IHJlcXVpcmUoJy4uL3V0aWxzL2JhbmtGb3JtYXRGYWN0b3J5Jyk7XHJcbmNvbnN0IENoYXNlUGFyc2VyID0gcmVxdWlyZSgnLi4vcGFyc2Vycy9jaGFzZVBhcnNlcicpO1xyXG5jb25zdCBCT0FQYXJzZXIgPSByZXF1aXJlKCcuLi9wYXJzZXJzL2JvYVBhcnNlcicpO1xyXG5jb25zdCBXZWxsc0ZhcmdvUGFyc2VyID0gcmVxdWlyZSgnLi4vcGFyc2Vycy93ZWxsc0ZhcmdvUGFyc2VyJyk7XHJcblxyXG5jbGFzcyBQREZQYXJzZXJTZXJ2aWNlIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMucGFyc2VycyA9IHtcclxuICAgICAgICAgICAgQ0hBU0U6IG5ldyBDaGFzZVBhcnNlcigpLFxyXG4gICAgICAgICAgICBCQU5LX09GX0FNRVJJQ0E6IG5ldyBCT0FQYXJzZXIoKSxcclxuICAgICAgICAgICAgV0VMTFNfRkFSR086IG5ldyBXZWxsc0ZhcmdvUGFyc2VyKClcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIHBhcnNlU3RhdGVtZW50KGJ1ZmZlciwgYmFua1R5cGUgPSAnQ0hBU0UnKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgcGFyc2VyID0gdGhpcy5wYXJzZXJzW2JhbmtUeXBlXTtcclxuICAgICAgICAgICAgaWYgKCFwYXJzZXIpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgYmFuayB0eXBlOiAke2JhbmtUeXBlfWApO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcGFyc2VyLnBhcnNlKGJ1ZmZlcik7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbGlkYXRlVHJhbnNhY3Rpb25zKGRhdGEpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcignUERGIHBhcnNpbmcgZmFpbGVkOicsIGVycm9yKTtcclxuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHZhbGlkYXRlVHJhbnNhY3Rpb25zKGRhdGEpIHtcclxuICAgICAgICBjb25zdCBmb3JtYXR0ZXIgPSBCYW5rRm9ybWF0RmFjdG9yeS5nZXRGb3JtYXR0ZXIoZGF0YS5tZXRhZGF0YS5iYW5rVHlwZSk7XHJcbiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb25zID0gZm9ybWF0dGVyLnBhcnNlVHJhbnNhY3Rpb25zKGRhdGEudGV4dCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdHJhbnNhY3Rpb25zLFxyXG4gICAgICAgICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgICAgICAgICAgcGFnZUNvdW50OiBkYXRhLm1ldGFkYXRhLnBhZ2VDb3VudCxcclxuICAgICAgICAgICAgICAgIGJhbmtUeXBlOiBkYXRhLm1ldGFkYXRhLmJhbmtUeXBlLFxyXG4gICAgICAgICAgICAgICAgcGFyc2VkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gbmV3IFBERlBhcnNlclNlcnZpY2UoKTsiXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTUEsUUFBUSxHQUFHQyxPQUFPLENBQUMsV0FBVyxDQUFDO0FBQ3JDLE1BQU1DLE1BQU0sR0FBR0QsT0FBTyxDQUFDLGtCQUFrQixDQUFDO0FBQzFDLE1BQU1FLGlCQUFpQixHQUFHRixPQUFPLENBQUMsNEJBQTRCLENBQUM7QUFDL0QsTUFBTUcsV0FBVyxHQUFHSCxPQUFPLENBQUMsd0JBQXdCLENBQUM7QUFDckQsTUFBTUksU0FBUyxHQUFHSixPQUFPLENBQUMsc0JBQXNCLENBQUM7QUFDakQsTUFBTUssZ0JBQWdCLEdBQUdMLE9BQU8sQ0FBQyw2QkFBNkIsQ0FBQztBQUUvRCxNQUFNTSxnQkFBZ0IsQ0FBQztFQUNuQkMsV0FBV0EsQ0FBQSxFQUFHO0lBQ1YsSUFBSSxDQUFDQyxPQUFPLEdBQUc7TUFDWEMsS0FBSyxFQUFFLElBQUlOLFdBQVcsQ0FBQyxDQUFDO01BQ3hCTyxlQUFlLEVBQUUsSUFBSU4sU0FBUyxDQUFDLENBQUM7TUFDaENPLFdBQVcsRUFBRSxJQUFJTixnQkFBZ0IsQ0FBQztJQUN0QyxDQUFDO0VBQ0w7RUFFQSxNQUFNTyxjQUFjQSxDQUFDQyxNQUFNLEVBQUVDLFFBQVEsR0FBRyxPQUFPLEVBQUU7SUFDN0MsSUFBSTtNQUNBLE1BQU1DLE1BQU0sR0FBRyxJQUFJLENBQUNQLE9BQU8sQ0FBQ00sUUFBUSxDQUFDO01BQ3JDLElBQUksQ0FBQ0MsTUFBTSxFQUFFO1FBQ1QsTUFBTSxJQUFJQyxLQUFLLENBQUMsMEJBQTBCRixRQUFRLEVBQUUsQ0FBQztNQUN6RDtNQUVBLE1BQU1HLElBQUksR0FBRyxNQUFNRixNQUFNLENBQUNHLEtBQUssQ0FBQ0wsTUFBTSxDQUFDO01BQ3ZDLE9BQU8sSUFBSSxDQUFDTSxvQkFBb0IsQ0FBQ0YsSUFBSSxDQUFDO0lBQzFDLENBQUMsQ0FBQyxPQUFPRyxLQUFLLEVBQUU7TUFDWm5CLE1BQU0sQ0FBQ21CLEtBQUssQ0FBQyxxQkFBcUIsRUFBRUEsS0FBSyxDQUFDO01BQzFDLE1BQU1BLEtBQUs7SUFDZjtFQUNKO0VBRUFELG9CQUFvQkEsQ0FBQ0YsSUFBSSxFQUFFO0lBQ3ZCLE1BQU1JLFNBQVMsR0FBR25CLGlCQUFpQixDQUFDb0IsWUFBWSxDQUFDTCxJQUFJLENBQUNNLFFBQVEsQ0FBQ1QsUUFBUSxDQUFDO0lBQ3hFLE1BQU1VLFlBQVksR0FBR0gsU0FBUyxDQUFDSSxpQkFBaUIsQ0FBQ1IsSUFBSSxDQUFDUyxJQUFJLENBQUM7SUFFM0QsT0FBTztNQUNIRixZQUFZO01BQ1pELFFBQVEsRUFBRTtRQUNOSSxTQUFTLEVBQUVWLElBQUksQ0FBQ00sUUFBUSxDQUFDSSxTQUFTO1FBQ2xDYixRQUFRLEVBQUVHLElBQUksQ0FBQ00sUUFBUSxDQUFDVCxRQUFRO1FBQ2hDYyxNQUFNLEVBQUUsSUFBSUMsSUFBSSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDO01BQ25DO0lBQ0osQ0FBQztFQUNMO0FBQ0o7QUFFQUMsTUFBTSxDQUFDQyxPQUFPLEdBQUcsSUFBSTFCLGdCQUFnQixDQUFDLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=