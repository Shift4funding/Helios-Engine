{"version":3,"names":["RedisRateLimiterMock","constructor","options","windowMs","max","requests","Map","timestamps","middleware","req","res","next","ip","now","Date","cleanupOldRequests","current","incrementRequests","setHeader","Math","status","json","error","retryAfter","ceil","get","validTimestamps","filter","ts","set","length","push","module","exports"],"sources":["redisRateLimiterMock.js"],"sourcesContent":["class RedisRateLimiterMock {\r\n    constructor(options) {\r\n        this.windowMs = options.windowMs || 15 * 60 * 1000;\r\n        this.max = options.max || 100;\r\n        this.requests = new Map();\r\n        this.timestamps = new Map();\r\n    }\r\n\r\n    middleware() {\r\n        return async (req, res, next) => {\r\n            const ip = req.ip;\r\n            const now = Date.now();\r\n            \r\n            // Clean up old requests\r\n            this.cleanupOldRequests(ip, now);\r\n            \r\n            // Get current request count\r\n            const current = this.incrementRequests(ip);\r\n            \r\n            // Set rate limit headers\r\n            res.setHeader('X-RateLimit-Limit', this.max);\r\n            res.setHeader('X-RateLimit-Remaining', Math.max(0, this.max - current));\r\n            \r\n            if (current > this.max) {\r\n                return res.status(429).json({\r\n                    error: 'Too many requests',\r\n                    retryAfter: Math.ceil((this.windowMs) / 1000)\r\n                });\r\n            }\r\n\r\n            next();\r\n        };\r\n    }\r\n\r\n    cleanupOldRequests(ip, now) {\r\n        const timestamps = this.timestamps.get(ip) || [];\r\n        const validTimestamps = timestamps.filter(ts => now - ts < this.windowMs);\r\n        this.timestamps.set(ip, validTimestamps);\r\n        this.requests.set(ip, validTimestamps.length);\r\n    }\r\n\r\n    incrementRequests(ip) {\r\n        const timestamps = this.timestamps.get(ip) || [];\r\n        timestamps.push(Date.now());\r\n        this.timestamps.set(ip, timestamps);\r\n        const current = timestamps.length;\r\n        this.requests.set(ip, current);\r\n        return current;\r\n    }\r\n}\r\n\r\nmodule.exports = RedisRateLimiterMock;"],"mappings":";;AAAA,MAAMA,oBAAoB,CAAC;EACvBC,WAAWA,CAACC,OAAO,EAAE;IACjB,IAAI,CAACC,QAAQ,GAAGD,OAAO,CAACC,QAAQ,IAAI,EAAE,GAAG,EAAE,GAAG,IAAI;IAClD,IAAI,CAACC,GAAG,GAAGF,OAAO,CAACE,GAAG,IAAI,GAAG;IAC7B,IAAI,CAACC,QAAQ,GAAG,IAAIC,GAAG,CAAC,CAAC;IACzB,IAAI,CAACC,UAAU,GAAG,IAAID,GAAG,CAAC,CAAC;EAC/B;EAEAE,UAAUA,CAAA,EAAG;IACT,OAAO,OAAOC,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;MAC7B,MAAMC,EAAE,GAAGH,GAAG,CAACG,EAAE;MACjB,MAAMC,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;;MAEtB;MACA,IAAI,CAACE,kBAAkB,CAACH,EAAE,EAAEC,GAAG,CAAC;;MAEhC;MACA,MAAMG,OAAO,GAAG,IAAI,CAACC,iBAAiB,CAACL,EAAE,CAAC;;MAE1C;MACAF,GAAG,CAACQ,SAAS,CAAC,mBAAmB,EAAE,IAAI,CAACd,GAAG,CAAC;MAC5CM,GAAG,CAACQ,SAAS,CAAC,uBAAuB,EAAEC,IAAI,CAACf,GAAG,CAAC,CAAC,EAAE,IAAI,CAACA,GAAG,GAAGY,OAAO,CAAC,CAAC;MAEvE,IAAIA,OAAO,GAAG,IAAI,CAACZ,GAAG,EAAE;QACpB,OAAOM,GAAG,CAACU,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UACxBC,KAAK,EAAE,mBAAmB;UAC1BC,UAAU,EAAEJ,IAAI,CAACK,IAAI,CAAE,IAAI,CAACrB,QAAQ,GAAI,IAAI;QAChD,CAAC,CAAC;MACN;MAEAQ,IAAI,CAAC,CAAC;IACV,CAAC;EACL;EAEAI,kBAAkBA,CAACH,EAAE,EAAEC,GAAG,EAAE;IACxB,MAAMN,UAAU,GAAG,IAAI,CAACA,UAAU,CAACkB,GAAG,CAACb,EAAE,CAAC,IAAI,EAAE;IAChD,MAAMc,eAAe,GAAGnB,UAAU,CAACoB,MAAM,CAACC,EAAE,IAAIf,GAAG,GAAGe,EAAE,GAAG,IAAI,CAACzB,QAAQ,CAAC;IACzE,IAAI,CAACI,UAAU,CAACsB,GAAG,CAACjB,EAAE,EAAEc,eAAe,CAAC;IACxC,IAAI,CAACrB,QAAQ,CAACwB,GAAG,CAACjB,EAAE,EAAEc,eAAe,CAACI,MAAM,CAAC;EACjD;EAEAb,iBAAiBA,CAACL,EAAE,EAAE;IAClB,MAAML,UAAU,GAAG,IAAI,CAACA,UAAU,CAACkB,GAAG,CAACb,EAAE,CAAC,IAAI,EAAE;IAChDL,UAAU,CAACwB,IAAI,CAACjB,IAAI,CAACD,GAAG,CAAC,CAAC,CAAC;IAC3B,IAAI,CAACN,UAAU,CAACsB,GAAG,CAACjB,EAAE,EAAEL,UAAU,CAAC;IACnC,MAAMS,OAAO,GAAGT,UAAU,CAACuB,MAAM;IACjC,IAAI,CAACzB,QAAQ,CAACwB,GAAG,CAACjB,EAAE,EAAEI,OAAO,CAAC;IAC9B,OAAOA,OAAO;EAClB;AACJ;AAEAgB,MAAM,CAACC,OAAO,GAAGjC,oBAAoB","ignoreList":[]}