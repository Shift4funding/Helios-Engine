{"version":3,"names":["mockAxios","require","default","LLMError","llmService","process","env","PERPLEXITY_API_KEY","PERPLEXITY_API_URL","describe","beforeEach","afterEach","reset","jest","clearAllMocks","mockStatementData","accountInfo","accountHolder","accountNumber","statementPeriod","start","end","transactions","date","description","debit","credit","balance","it","mockLLMResponse","data","choices","message","content","post","mockResolvedValueOnce","result","analyzeStatement","expect","success","toBe","toHaveProperty","mockRejectedValueOnce","response","status","error","rejects","toThrow","service"],"sources":["llmService.test.js"],"sourcesContent":["const mockAxios = require('jest-mock-axios').default;\r\nconst { LLMError } = require('../../src/utils/errors');\r\nconst llmService = require('../../src/services/llmService');\r\n\r\n// Mock environment variables\r\nprocess.env.PERPLEXITY_API_KEY = 'test-api-key';\r\nprocess.env.PERPLEXITY_API_URL = 'https://api.perplexity.ai/chat/completions';\r\n\r\ndescribe('LLM Service', () => {\r\n    beforeEach(() => {\r\n        process.env.PERPLEXITY_API_KEY = 'test-api-key';\r\n    });\r\n\r\n    afterEach(() => {\r\n        mockAxios.reset();\r\n        jest.clearAllMocks();\r\n    });\r\n\r\n    describe('analyzeStatement', () => {\r\n        const mockStatementData = {\r\n            accountInfo: {\r\n                accountHolder: 'John Doe',\r\n                accountNumber: '****1234',\r\n                statementPeriod: {\r\n                    start: '05/01/2025',\r\n                    end: '05/31/2025'\r\n                }\r\n            },\r\n            transactions: [\r\n                {\r\n                    date: '05/28/2025',\r\n                    description: 'PAYMENT TO XYZ',\r\n                    debit: 50.00,\r\n                    credit: null,\r\n                    balance: 950.00\r\n                },\r\n                {\r\n                    date: '05/29/2025',\r\n                    description: 'DEPOSIT',\r\n                    debit: null,\r\n                    credit: 100.00,\r\n                    balance: 1050.00\r\n                }\r\n            ]\r\n        };\r\n\r\n        it('should successfully analyze statement data', async () => {\r\n            const mockLLMResponse = {\r\n                data: {\r\n                    choices: [{\r\n                        message: {\r\n                            content: `\r\n                                SUMMARY: Test summary\r\n                                PATTERNS: Test patterns\r\n                                FLAGS: No issues found\r\n                                RECOMMENDATIONS: Save more\r\n                            `\r\n                        }\r\n                    }]\r\n                }\r\n            };\r\n\r\n            mockAxios.post.mockResolvedValueOnce(mockLLMResponse);\r\n\r\n            const result = await llmService.analyzeStatement(mockStatementData);\r\n\r\n            expect(result.success).toBe(true);\r\n            expect(result.data).toHaveProperty('summary');\r\n            expect(result.data).toHaveProperty('patterns');\r\n        });\r\n\r\n        it('should handle API errors gracefully', async () => {\r\n            mockAxios.post.mockRejectedValueOnce({\r\n                response: {\r\n                    status: 429,\r\n                    data: { error: 'Rate limit exceeded' }\r\n                }\r\n            });\r\n\r\n            await expect(llmService.analyzeStatement(mockStatementData))\r\n                .rejects\r\n                .toThrow(LLMError);\r\n        });\r\n\r\n        it('should handle missing API key', async () => {\r\n            delete process.env.PERPLEXITY_API_KEY;\r\n            const service = require('../../src/services/llmService');\r\n            \r\n            await expect(service.analyzeStatement(mockStatementData))\r\n                .rejects\r\n                .toThrow('Perplexity API key not configured');\r\n        });\r\n    });\r\n});"],"mappings":";;AAAA,MAAMA,SAAS,GAAGC,OAAO,CAAC,iBAAiB,CAAC,CAACC,OAAO;AACpD,MAAM;EAAEC;AAAS,CAAC,GAAGF,OAAO,CAAC,wBAAwB,CAAC;AACtD,MAAMG,UAAU,GAAGH,OAAO,CAAC,+BAA+B,CAAC;;AAE3D;AACAI,OAAO,CAACC,GAAG,CAACC,kBAAkB,GAAG,cAAc;AAC/CF,OAAO,CAACC,GAAG,CAACE,kBAAkB,GAAG,4CAA4C;AAE7EC,QAAQ,CAAC,aAAa,EAAE,MAAM;EAC1BC,UAAU,CAAC,MAAM;IACbL,OAAO,CAACC,GAAG,CAACC,kBAAkB,GAAG,cAAc;EACnD,CAAC,CAAC;EAEFI,SAAS,CAAC,MAAM;IACZX,SAAS,CAACY,KAAK,CAAC,CAAC;IACjBC,IAAI,CAACC,aAAa,CAAC,CAAC;EACxB,CAAC,CAAC;EAEFL,QAAQ,CAAC,kBAAkB,EAAE,MAAM;IAC/B,MAAMM,iBAAiB,GAAG;MACtBC,WAAW,EAAE;QACTC,aAAa,EAAE,UAAU;QACzBC,aAAa,EAAE,UAAU;QACzBC,eAAe,EAAE;UACbC,KAAK,EAAE,YAAY;UACnBC,GAAG,EAAE;QACT;MACJ,CAAC;MACDC,YAAY,EAAE,CACV;QACIC,IAAI,EAAE,YAAY;QAClBC,WAAW,EAAE,gBAAgB;QAC7BC,KAAK,EAAE,KAAK;QACZC,MAAM,EAAE,IAAI;QACZC,OAAO,EAAE;MACb,CAAC,EACD;QACIJ,IAAI,EAAE,YAAY;QAClBC,WAAW,EAAE,SAAS;QACtBC,KAAK,EAAE,IAAI;QACXC,MAAM,EAAE,MAAM;QACdC,OAAO,EAAE;MACb,CAAC;IAET,CAAC;IAEDC,EAAE,CAAC,4CAA4C,EAAE,YAAY;MACzD,MAAMC,eAAe,GAAG;QACpBC,IAAI,EAAE;UACFC,OAAO,EAAE,CAAC;YACNC,OAAO,EAAE;cACLC,OAAO,EAAE;AACrC;AACA;AACA;AACA;AACA;YACwB;UACJ,CAAC;QACL;MACJ,CAAC;MAEDjC,SAAS,CAACkC,IAAI,CAACC,qBAAqB,CAACN,eAAe,CAAC;MAErD,MAAMO,MAAM,GAAG,MAAMhC,UAAU,CAACiC,gBAAgB,CAACtB,iBAAiB,CAAC;MAEnEuB,MAAM,CAACF,MAAM,CAACG,OAAO,CAAC,CAACC,IAAI,CAAC,IAAI,CAAC;MACjCF,MAAM,CAACF,MAAM,CAACN,IAAI,CAAC,CAACW,cAAc,CAAC,SAAS,CAAC;MAC7CH,MAAM,CAACF,MAAM,CAACN,IAAI,CAAC,CAACW,cAAc,CAAC,UAAU,CAAC;IAClD,CAAC,CAAC;IAEFb,EAAE,CAAC,qCAAqC,EAAE,YAAY;MAClD5B,SAAS,CAACkC,IAAI,CAACQ,qBAAqB,CAAC;QACjCC,QAAQ,EAAE;UACNC,MAAM,EAAE,GAAG;UACXd,IAAI,EAAE;YAAEe,KAAK,EAAE;UAAsB;QACzC;MACJ,CAAC,CAAC;MAEF,MAAMP,MAAM,CAAClC,UAAU,CAACiC,gBAAgB,CAACtB,iBAAiB,CAAC,CAAC,CACvD+B,OAAO,CACPC,OAAO,CAAC5C,QAAQ,CAAC;IAC1B,CAAC,CAAC;IAEFyB,EAAE,CAAC,+BAA+B,EAAE,YAAY;MAC5C,OAAOvB,OAAO,CAACC,GAAG,CAACC,kBAAkB;MACrC,MAAMyC,OAAO,GAAG/C,OAAO,CAAC,+BAA+B,CAAC;MAExD,MAAMqC,MAAM,CAACU,OAAO,CAACX,gBAAgB,CAACtB,iBAAiB,CAAC,CAAC,CACpD+B,OAAO,CACPC,OAAO,CAAC,mCAAmC,CAAC;IACrD,CAAC,CAAC;EACN,CAAC,CAAC;AACN,CAAC,CAAC","ignoreList":[]}