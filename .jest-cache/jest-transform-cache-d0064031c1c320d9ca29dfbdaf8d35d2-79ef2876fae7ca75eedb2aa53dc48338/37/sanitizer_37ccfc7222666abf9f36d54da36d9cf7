815bb27adac22d430bb127594bf481eb
"use strict";

const sanitizeHtml = require('sanitize-html');
const xss = require('xss');
const logger = require('../config/logger');
const sanitizeOptions = {
  allowedTags: [],
  // No HTML tags allowed
  allowedAttributes: {},
  // No attributes allowed
  disallowedTagsMode: 'recursiveEscape'
};
const sanitizeValue = value => {
  if (typeof value === 'string') {
    // HTML sanitization
    const htmlSanitized = sanitizeHtml(value, sanitizeOptions);
    // XSS prevention
    return xss(htmlSanitized);
  }
  return value;
};
const sanitizeObject = obj => {
  if (Array.isArray(obj)) {
    return obj.map(item => sanitizeObject(item));
  }
  if (obj !== null && typeof obj === 'object') {
    const sanitized = {};
    for (const [key, value] of Object.entries(obj)) {
      sanitized[key] = sanitizeObject(value);
    }
    return sanitized;
  }
  return sanitizeValue(obj);
};

// Mock sanitizer for testing
const sanitizeRequest = (req, res, next) => {
  if (process.env.NODE_ENV === 'test') {
    return next();
  }
  try {
    // Simple sanitization for now
    if (req.body) {
      Object.keys(req.body).forEach(key => {
        if (typeof req.body[key] === 'string') {
          req.body[key] = req.body[key].trim();
        }
      });
    }

    // Sanitize query parameters
    if (req.query) {
      req.query = sanitizeObject(req.query);
    }

    // Sanitize URL parameters
    if (req.params) {
      req.params = sanitizeObject(req.params);
    }

    // Don't sanitize file uploads
    if (req.file || req.files) {
      logger.debug('Skipping sanitization for file upload');
    }
    next();
  } catch (error) {
    logger.error('Sanitization error:', error);
    next(error);
  }
};
module.exports = {
  sanitizeRequest,
  sanitizeValue,
  // Export for use in other parts of the application
  sanitizeObject
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJzYW5pdGl6ZUh0bWwiLCJyZXF1aXJlIiwieHNzIiwibG9nZ2VyIiwic2FuaXRpemVPcHRpb25zIiwiYWxsb3dlZFRhZ3MiLCJhbGxvd2VkQXR0cmlidXRlcyIsImRpc2FsbG93ZWRUYWdzTW9kZSIsInNhbml0aXplVmFsdWUiLCJ2YWx1ZSIsImh0bWxTYW5pdGl6ZWQiLCJzYW5pdGl6ZU9iamVjdCIsIm9iaiIsIkFycmF5IiwiaXNBcnJheSIsIm1hcCIsIml0ZW0iLCJzYW5pdGl6ZWQiLCJrZXkiLCJPYmplY3QiLCJlbnRyaWVzIiwic2FuaXRpemVSZXF1ZXN0IiwicmVxIiwicmVzIiwibmV4dCIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsImJvZHkiLCJrZXlzIiwiZm9yRWFjaCIsInRyaW0iLCJxdWVyeSIsInBhcmFtcyIsImZpbGUiLCJmaWxlcyIsImRlYnVnIiwiZXJyb3IiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsic2FuaXRpemVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHNhbml0aXplSHRtbCA9IHJlcXVpcmUoJ3Nhbml0aXplLWh0bWwnKTtcclxuY29uc3QgeHNzID0gcmVxdWlyZSgneHNzJyk7XHJcbmNvbnN0IGxvZ2dlciA9IHJlcXVpcmUoJy4uL2NvbmZpZy9sb2dnZXInKTtcclxuXHJcbmNvbnN0IHNhbml0aXplT3B0aW9ucyA9IHtcclxuICAgIGFsbG93ZWRUYWdzOiBbXSwgLy8gTm8gSFRNTCB0YWdzIGFsbG93ZWRcclxuICAgIGFsbG93ZWRBdHRyaWJ1dGVzOiB7fSwgLy8gTm8gYXR0cmlidXRlcyBhbGxvd2VkXHJcbiAgICBkaXNhbGxvd2VkVGFnc01vZGU6ICdyZWN1cnNpdmVFc2NhcGUnXHJcbn07XHJcblxyXG5jb25zdCBzYW5pdGl6ZVZhbHVlID0gKHZhbHVlKSA9PiB7XHJcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgIC8vIEhUTUwgc2FuaXRpemF0aW9uXHJcbiAgICAgICAgY29uc3QgaHRtbFNhbml0aXplZCA9IHNhbml0aXplSHRtbCh2YWx1ZSwgc2FuaXRpemVPcHRpb25zKTtcclxuICAgICAgICAvLyBYU1MgcHJldmVudGlvblxyXG4gICAgICAgIHJldHVybiB4c3MoaHRtbFNhbml0aXplZCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdmFsdWU7XHJcbn07XHJcblxyXG5jb25zdCBzYW5pdGl6ZU9iamVjdCA9IChvYmopID0+IHtcclxuICAgIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcclxuICAgICAgICByZXR1cm4gb2JqLm1hcChpdGVtID0+IHNhbml0aXplT2JqZWN0KGl0ZW0pKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKG9iaiAhPT0gbnVsbCAmJiB0eXBlb2Ygb2JqID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgIGNvbnN0IHNhbml0aXplZCA9IHt9O1xyXG4gICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKG9iaikpIHtcclxuICAgICAgICAgICAgc2FuaXRpemVkW2tleV0gPSBzYW5pdGl6ZU9iamVjdCh2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzYW5pdGl6ZWQ7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiBzYW5pdGl6ZVZhbHVlKG9iaik7XHJcbn07XHJcblxyXG4vLyBNb2NrIHNhbml0aXplciBmb3IgdGVzdGluZ1xyXG5jb25zdCBzYW5pdGl6ZVJlcXVlc3QgPSAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Rlc3QnKSB7XHJcbiAgICAgICAgcmV0dXJuIG5leHQoKTtcclxuICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAgIC8vIFNpbXBsZSBzYW5pdGl6YXRpb24gZm9yIG5vd1xyXG4gICAgICAgIGlmIChyZXEuYm9keSkge1xyXG4gICAgICAgICAgICBPYmplY3Qua2V5cyhyZXEuYm9keSkuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiByZXEuYm9keVtrZXldID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcS5ib2R5W2tleV0gPSByZXEuYm9keVtrZXldLnRyaW0oKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBTYW5pdGl6ZSBxdWVyeSBwYXJhbWV0ZXJzXHJcbiAgICAgICAgaWYgKHJlcS5xdWVyeSkge1xyXG4gICAgICAgICAgICByZXEucXVlcnkgPSBzYW5pdGl6ZU9iamVjdChyZXEucXVlcnkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gU2FuaXRpemUgVVJMIHBhcmFtZXRlcnNcclxuICAgICAgICBpZiAocmVxLnBhcmFtcykge1xyXG4gICAgICAgICAgICByZXEucGFyYW1zID0gc2FuaXRpemVPYmplY3QocmVxLnBhcmFtcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBEb24ndCBzYW5pdGl6ZSBmaWxlIHVwbG9hZHNcclxuICAgICAgICBpZiAocmVxLmZpbGUgfHwgcmVxLmZpbGVzKSB7XHJcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnU2tpcHBpbmcgc2FuaXRpemF0aW9uIGZvciBmaWxlIHVwbG9hZCcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbmV4dCgpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBsb2dnZXIuZXJyb3IoJ1Nhbml0aXphdGlvbiBlcnJvcjonLCBlcnJvcik7XHJcbiAgICAgICAgbmV4dChlcnJvcik7XHJcbiAgICB9XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICAgIHNhbml0aXplUmVxdWVzdCxcclxuICAgIHNhbml0aXplVmFsdWUsIC8vIEV4cG9ydCBmb3IgdXNlIGluIG90aGVyIHBhcnRzIG9mIHRoZSBhcHBsaWNhdGlvblxyXG4gICAgc2FuaXRpemVPYmplY3RcclxufTsiXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTUEsWUFBWSxHQUFHQyxPQUFPLENBQUMsZUFBZSxDQUFDO0FBQzdDLE1BQU1DLEdBQUcsR0FBR0QsT0FBTyxDQUFDLEtBQUssQ0FBQztBQUMxQixNQUFNRSxNQUFNLEdBQUdGLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQztBQUUxQyxNQUFNRyxlQUFlLEdBQUc7RUFDcEJDLFdBQVcsRUFBRSxFQUFFO0VBQUU7RUFDakJDLGlCQUFpQixFQUFFLENBQUMsQ0FBQztFQUFFO0VBQ3ZCQyxrQkFBa0IsRUFBRTtBQUN4QixDQUFDO0FBRUQsTUFBTUMsYUFBYSxHQUFJQyxLQUFLLElBQUs7RUFDN0IsSUFBSSxPQUFPQSxLQUFLLEtBQUssUUFBUSxFQUFFO0lBQzNCO0lBQ0EsTUFBTUMsYUFBYSxHQUFHVixZQUFZLENBQUNTLEtBQUssRUFBRUwsZUFBZSxDQUFDO0lBQzFEO0lBQ0EsT0FBT0YsR0FBRyxDQUFDUSxhQUFhLENBQUM7RUFDN0I7RUFDQSxPQUFPRCxLQUFLO0FBQ2hCLENBQUM7QUFFRCxNQUFNRSxjQUFjLEdBQUlDLEdBQUcsSUFBSztFQUM1QixJQUFJQyxLQUFLLENBQUNDLE9BQU8sQ0FBQ0YsR0FBRyxDQUFDLEVBQUU7SUFDcEIsT0FBT0EsR0FBRyxDQUFDRyxHQUFHLENBQUNDLElBQUksSUFBSUwsY0FBYyxDQUFDSyxJQUFJLENBQUMsQ0FBQztFQUNoRDtFQUVBLElBQUlKLEdBQUcsS0FBSyxJQUFJLElBQUksT0FBT0EsR0FBRyxLQUFLLFFBQVEsRUFBRTtJQUN6QyxNQUFNSyxTQUFTLEdBQUcsQ0FBQyxDQUFDO0lBQ3BCLEtBQUssTUFBTSxDQUFDQyxHQUFHLEVBQUVULEtBQUssQ0FBQyxJQUFJVSxNQUFNLENBQUNDLE9BQU8sQ0FBQ1IsR0FBRyxDQUFDLEVBQUU7TUFDNUNLLFNBQVMsQ0FBQ0MsR0FBRyxDQUFDLEdBQUdQLGNBQWMsQ0FBQ0YsS0FBSyxDQUFDO0lBQzFDO0lBQ0EsT0FBT1EsU0FBUztFQUNwQjtFQUVBLE9BQU9ULGFBQWEsQ0FBQ0ksR0FBRyxDQUFDO0FBQzdCLENBQUM7O0FBRUQ7QUFDQSxNQUFNUyxlQUFlLEdBQUdBLENBQUNDLEdBQUcsRUFBRUMsR0FBRyxFQUFFQyxJQUFJLEtBQUs7RUFDeEMsSUFBSUMsT0FBTyxDQUFDQyxHQUFHLENBQUNDLFFBQVEsS0FBSyxNQUFNLEVBQUU7SUFDakMsT0FBT0gsSUFBSSxDQUFDLENBQUM7RUFDakI7RUFFQSxJQUFJO0lBQ0E7SUFDQSxJQUFJRixHQUFHLENBQUNNLElBQUksRUFBRTtNQUNWVCxNQUFNLENBQUNVLElBQUksQ0FBQ1AsR0FBRyxDQUFDTSxJQUFJLENBQUMsQ0FBQ0UsT0FBTyxDQUFDWixHQUFHLElBQUk7UUFDakMsSUFBSSxPQUFPSSxHQUFHLENBQUNNLElBQUksQ0FBQ1YsR0FBRyxDQUFDLEtBQUssUUFBUSxFQUFFO1VBQ25DSSxHQUFHLENBQUNNLElBQUksQ0FBQ1YsR0FBRyxDQUFDLEdBQUdJLEdBQUcsQ0FBQ00sSUFBSSxDQUFDVixHQUFHLENBQUMsQ0FBQ2EsSUFBSSxDQUFDLENBQUM7UUFDeEM7TUFDSixDQUFDLENBQUM7SUFDTjs7SUFFQTtJQUNBLElBQUlULEdBQUcsQ0FBQ1UsS0FBSyxFQUFFO01BQ1hWLEdBQUcsQ0FBQ1UsS0FBSyxHQUFHckIsY0FBYyxDQUFDVyxHQUFHLENBQUNVLEtBQUssQ0FBQztJQUN6Qzs7SUFFQTtJQUNBLElBQUlWLEdBQUcsQ0FBQ1csTUFBTSxFQUFFO01BQ1pYLEdBQUcsQ0FBQ1csTUFBTSxHQUFHdEIsY0FBYyxDQUFDVyxHQUFHLENBQUNXLE1BQU0sQ0FBQztJQUMzQzs7SUFFQTtJQUNBLElBQUlYLEdBQUcsQ0FBQ1ksSUFBSSxJQUFJWixHQUFHLENBQUNhLEtBQUssRUFBRTtNQUN2QmhDLE1BQU0sQ0FBQ2lDLEtBQUssQ0FBQyx1Q0FBdUMsQ0FBQztJQUN6RDtJQUVBWixJQUFJLENBQUMsQ0FBQztFQUNWLENBQUMsQ0FBQyxPQUFPYSxLQUFLLEVBQUU7SUFDWmxDLE1BQU0sQ0FBQ2tDLEtBQUssQ0FBQyxxQkFBcUIsRUFBRUEsS0FBSyxDQUFDO0lBQzFDYixJQUFJLENBQUNhLEtBQUssQ0FBQztFQUNmO0FBQ0osQ0FBQztBQUVEQyxNQUFNLENBQUNDLE9BQU8sR0FBRztFQUNibEIsZUFBZTtFQUNmYixhQUFhO0VBQUU7RUFDZkc7QUFDSixDQUFDIiwiaWdub3JlTGlzdCI6W119