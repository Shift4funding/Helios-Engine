{"version":3,"names":["sanitizeHtml","require","xss","logger","sanitizeOptions","allowedTags","allowedAttributes","disallowedTagsMode","sanitizeValue","value","htmlSanitized","sanitizeObject","obj","Array","isArray","map","item","sanitized","key","Object","entries","sanitizeRequest","req","res","next","process","env","NODE_ENV","body","keys","forEach","trim","query","params","file","files","debug","error","module","exports"],"sources":["sanitizer.js"],"sourcesContent":["const sanitizeHtml = require('sanitize-html');\r\nconst xss = require('xss');\r\nconst logger = require('../config/logger');\r\n\r\nconst sanitizeOptions = {\r\n    allowedTags: [], // No HTML tags allowed\r\n    allowedAttributes: {}, // No attributes allowed\r\n    disallowedTagsMode: 'recursiveEscape'\r\n};\r\n\r\nconst sanitizeValue = (value) => {\r\n    if (typeof value === 'string') {\r\n        // HTML sanitization\r\n        const htmlSanitized = sanitizeHtml(value, sanitizeOptions);\r\n        // XSS prevention\r\n        return xss(htmlSanitized);\r\n    }\r\n    return value;\r\n};\r\n\r\nconst sanitizeObject = (obj) => {\r\n    if (Array.isArray(obj)) {\r\n        return obj.map(item => sanitizeObject(item));\r\n    }\r\n    \r\n    if (obj !== null && typeof obj === 'object') {\r\n        const sanitized = {};\r\n        for (const [key, value] of Object.entries(obj)) {\r\n            sanitized[key] = sanitizeObject(value);\r\n        }\r\n        return sanitized;\r\n    }\r\n    \r\n    return sanitizeValue(obj);\r\n};\r\n\r\n// Mock sanitizer for testing\r\nconst sanitizeRequest = (req, res, next) => {\r\n    if (process.env.NODE_ENV === 'test') {\r\n        return next();\r\n    }\r\n\r\n    try {\r\n        // Simple sanitization for now\r\n        if (req.body) {\r\n            Object.keys(req.body).forEach(key => {\r\n                if (typeof req.body[key] === 'string') {\r\n                    req.body[key] = req.body[key].trim();\r\n                }\r\n            });\r\n        }\r\n\r\n        // Sanitize query parameters\r\n        if (req.query) {\r\n            req.query = sanitizeObject(req.query);\r\n        }\r\n\r\n        // Sanitize URL parameters\r\n        if (req.params) {\r\n            req.params = sanitizeObject(req.params);\r\n        }\r\n\r\n        // Don't sanitize file uploads\r\n        if (req.file || req.files) {\r\n            logger.debug('Skipping sanitization for file upload');\r\n        }\r\n\r\n        next();\r\n    } catch (error) {\r\n        logger.error('Sanitization error:', error);\r\n        next(error);\r\n    }\r\n};\r\n\r\nmodule.exports = {\r\n    sanitizeRequest,\r\n    sanitizeValue, // Export for use in other parts of the application\r\n    sanitizeObject\r\n};"],"mappings":";;AAAA,MAAMA,YAAY,GAAGC,OAAO,CAAC,eAAe,CAAC;AAC7C,MAAMC,GAAG,GAAGD,OAAO,CAAC,KAAK,CAAC;AAC1B,MAAME,MAAM,GAAGF,OAAO,CAAC,kBAAkB,CAAC;AAE1C,MAAMG,eAAe,GAAG;EACpBC,WAAW,EAAE,EAAE;EAAE;EACjBC,iBAAiB,EAAE,CAAC,CAAC;EAAE;EACvBC,kBAAkB,EAAE;AACxB,CAAC;AAED,MAAMC,aAAa,GAAIC,KAAK,IAAK;EAC7B,IAAI,OAAOA,KAAK,KAAK,QAAQ,EAAE;IAC3B;IACA,MAAMC,aAAa,GAAGV,YAAY,CAACS,KAAK,EAAEL,eAAe,CAAC;IAC1D;IACA,OAAOF,GAAG,CAACQ,aAAa,CAAC;EAC7B;EACA,OAAOD,KAAK;AAChB,CAAC;AAED,MAAME,cAAc,GAAIC,GAAG,IAAK;EAC5B,IAAIC,KAAK,CAACC,OAAO,CAACF,GAAG,CAAC,EAAE;IACpB,OAAOA,GAAG,CAACG,GAAG,CAACC,IAAI,IAAIL,cAAc,CAACK,IAAI,CAAC,CAAC;EAChD;EAEA,IAAIJ,GAAG,KAAK,IAAI,IAAI,OAAOA,GAAG,KAAK,QAAQ,EAAE;IACzC,MAAMK,SAAS,GAAG,CAAC,CAAC;IACpB,KAAK,MAAM,CAACC,GAAG,EAAET,KAAK,CAAC,IAAIU,MAAM,CAACC,OAAO,CAACR,GAAG,CAAC,EAAE;MAC5CK,SAAS,CAACC,GAAG,CAAC,GAAGP,cAAc,CAACF,KAAK,CAAC;IAC1C;IACA,OAAOQ,SAAS;EACpB;EAEA,OAAOT,aAAa,CAACI,GAAG,CAAC;AAC7B,CAAC;;AAED;AACA,MAAMS,eAAe,GAAGA,CAACC,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;EACxC,IAAIC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,MAAM,EAAE;IACjC,OAAOH,IAAI,CAAC,CAAC;EACjB;EAEA,IAAI;IACA;IACA,IAAIF,GAAG,CAACM,IAAI,EAAE;MACVT,MAAM,CAACU,IAAI,CAACP,GAAG,CAACM,IAAI,CAAC,CAACE,OAAO,CAACZ,GAAG,IAAI;QACjC,IAAI,OAAOI,GAAG,CAACM,IAAI,CAACV,GAAG,CAAC,KAAK,QAAQ,EAAE;UACnCI,GAAG,CAACM,IAAI,CAACV,GAAG,CAAC,GAAGI,GAAG,CAACM,IAAI,CAACV,GAAG,CAAC,CAACa,IAAI,CAAC,CAAC;QACxC;MACJ,CAAC,CAAC;IACN;;IAEA;IACA,IAAIT,GAAG,CAACU,KAAK,EAAE;MACXV,GAAG,CAACU,KAAK,GAAGrB,cAAc,CAACW,GAAG,CAACU,KAAK,CAAC;IACzC;;IAEA;IACA,IAAIV,GAAG,CAACW,MAAM,EAAE;MACZX,GAAG,CAACW,MAAM,GAAGtB,cAAc,CAACW,GAAG,CAACW,MAAM,CAAC;IAC3C;;IAEA;IACA,IAAIX,GAAG,CAACY,IAAI,IAAIZ,GAAG,CAACa,KAAK,EAAE;MACvBhC,MAAM,CAACiC,KAAK,CAAC,uCAAuC,CAAC;IACzD;IAEAZ,IAAI,CAAC,CAAC;EACV,CAAC,CAAC,OAAOa,KAAK,EAAE;IACZlC,MAAM,CAACkC,KAAK,CAAC,qBAAqB,EAAEA,KAAK,CAAC;IAC1Cb,IAAI,CAACa,KAAK,CAAC;EACf;AACJ,CAAC;AAEDC,MAAM,CAACC,OAAO,GAAG;EACblB,eAAe;EACfb,aAAa;EAAE;EACfG;AACJ,CAAC","ignoreList":[]}