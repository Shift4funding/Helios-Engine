{"version":3,"names":["pdfParserService","require","llmService","cacheService","analysisService","auditService","logger","AnalysisController","analyzeBankStatement","req","res","logAnalysisRequest","file","status","json","success","error","result","buffer","getAnalysisResult","id","params","process","env","NODE_ENV","data","summary","timestamp","Date","module","exports"],"sources":["analysisController.js"],"sourcesContent":["// This file contains the logic for handling requests to analyze bank statements, including parsing the PDF and calling external LLM APIs.\n\nconst pdfParserService = require('../services/pdfParserService');\nconst llmService = require('../services/llmService');\nconst cacheService = require('../services/cacheService');\nconst analysisService = require('../services/analysisService');\nconst auditService = require('../services/auditService');\nconst logger = require('../config/logger');\n\nclass AnalysisController {\n    async analyzeBankStatement(req, res) {\n        try {\n            await auditService.logAnalysisRequest(req);\n            \n            if (!req.file) {\n                return res.status(400).json({\n                    success: false,\n                    error: 'No file uploaded'\n                });\n            }\n\n            const result = await analysisService.analyzeBankStatement(req.file.buffer);\n            res.json(result);\n        } catch (error) {\n            logger.error('Analysis failed:', error);\n            res.status(500).json({\n                success: false,\n                error: 'Failed to analyze bank statement'\n            });\n        }\n    }\n\n    async getAnalysisResult(req, res) {\n        try {\n            const { id } = req.params;\n            \n            // For testing purposes\n            if (process.env.NODE_ENV === 'test') {\n                return res.json({\n                    success: true,\n                    data: {\n                        id,\n                        summary: 'Test analysis result',\n                        timestamp: new Date()\n                    }\n                });\n            }\n\n            // TODO: Implement actual result retrieval\n            res.status(501).json({\n                success: false,\n                error: 'Not implemented'\n            });\n        } catch (error) {\n            logger.error('Failed to get analysis result:', error);\n            res.status(500).json({\n                success: false,\n                error: 'Internal server error'\n            });\n        }\n    }\n}\n\nmodule.exports = new AnalysisController();"],"mappings":";;AAAA;;AAEA,MAAMA,gBAAgB,GAAGC,OAAO,CAAC,8BAA8B,CAAC;AAChE,MAAMC,UAAU,GAAGD,OAAO,CAAC,wBAAwB,CAAC;AACpD,MAAME,YAAY,GAAGF,OAAO,CAAC,0BAA0B,CAAC;AACxD,MAAMG,eAAe,GAAGH,OAAO,CAAC,6BAA6B,CAAC;AAC9D,MAAMI,YAAY,GAAGJ,OAAO,CAAC,0BAA0B,CAAC;AACxD,MAAMK,MAAM,GAAGL,OAAO,CAAC,kBAAkB,CAAC;AAE1C,MAAMM,kBAAkB,CAAC;EACrB,MAAMC,oBAAoBA,CAACC,GAAG,EAAEC,GAAG,EAAE;IACjC,IAAI;MACA,MAAML,YAAY,CAACM,kBAAkB,CAACF,GAAG,CAAC;MAE1C,IAAI,CAACA,GAAG,CAACG,IAAI,EAAE;QACX,OAAOF,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UACxBC,OAAO,EAAE,KAAK;UACdC,KAAK,EAAE;QACX,CAAC,CAAC;MACN;MAEA,MAAMC,MAAM,GAAG,MAAMb,eAAe,CAACI,oBAAoB,CAACC,GAAG,CAACG,IAAI,CAACM,MAAM,CAAC;MAC1ER,GAAG,CAACI,IAAI,CAACG,MAAM,CAAC;IACpB,CAAC,CAAC,OAAOD,KAAK,EAAE;MACZV,MAAM,CAACU,KAAK,CAAC,kBAAkB,EAAEA,KAAK,CAAC;MACvCN,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACjBC,OAAO,EAAE,KAAK;QACdC,KAAK,EAAE;MACX,CAAC,CAAC;IACN;EACJ;EAEA,MAAMG,iBAAiBA,CAACV,GAAG,EAAEC,GAAG,EAAE;IAC9B,IAAI;MACA,MAAM;QAAEU;MAAG,CAAC,GAAGX,GAAG,CAACY,MAAM;;MAEzB;MACA,IAAIC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,MAAM,EAAE;QACjC,OAAOd,GAAG,CAACI,IAAI,CAAC;UACZC,OAAO,EAAE,IAAI;UACbU,IAAI,EAAE;YACFL,EAAE;YACFM,OAAO,EAAE,sBAAsB;YAC/BC,SAAS,EAAE,IAAIC,IAAI,CAAC;UACxB;QACJ,CAAC,CAAC;MACN;;MAEA;MACAlB,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACjBC,OAAO,EAAE,KAAK;QACdC,KAAK,EAAE;MACX,CAAC,CAAC;IACN,CAAC,CAAC,OAAOA,KAAK,EAAE;MACZV,MAAM,CAACU,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAAC;MACrDN,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACjBC,OAAO,EAAE,KAAK;QACdC,KAAK,EAAE;MACX,CAAC,CAAC;IACN;EACJ;AACJ;AAEAa,MAAM,CAACC,OAAO,GAAG,IAAIvB,kBAAkB,CAAC,CAAC","ignoreList":[]}