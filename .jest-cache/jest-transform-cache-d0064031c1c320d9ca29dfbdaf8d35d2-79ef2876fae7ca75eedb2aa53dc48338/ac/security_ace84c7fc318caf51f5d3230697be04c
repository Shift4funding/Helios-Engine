3dbc75549c5cf7355a0cb051fb186a7b
"use strict";

const helmet = require('helmet');
const cors = require('cors');
const RedisRateLimiter = require('./rateLimiter');
const config = require('../config/env');
const sanitizeHtml = require('sanitize-html');
const mongoSanitize = require('express-mongo-sanitize');
const crypto = require('crypto');
const FileType = require('file-type');
const defaultConfig = {
  services: {
    perplexity: {
      apiUrl: 'https://api.perplexity.ai'
    }
  }
};
const securityMiddleware = {
  rateLimiter: async (req, res, next) => {
    const limiter = new RedisRateLimiter({
      windowMs: config.security.rateLimit.windowMs,
      max: config.security.rateLimit.max
    });
    return limiter.middleware()(req, res, next);
  },
  helmetConfig: helmet({
    contentSecurityPolicy: {
      directives: {
        defaultSrc: ["'self'"],
        scriptSrc: ["'self'", "'unsafe-inline'"],
        styleSrc: ["'self'", "'unsafe-inline'"],
        imgSrc: ["'self'", "data:", "https:"],
        connectSrc: ["'self'", config.services?.perplexity?.apiUrl || defaultConfig.services.perplexity.apiUrl],
        upgradeInsecureRequests: []
      }
    },
    crossOriginEmbedderPolicy: true,
    crossOriginOpenerPolicy: {
      policy: "same-origin"
    },
    crossOriginResourcePolicy: {
      policy: "cross-origin"
    },
    hsts: {
      maxAge: 31536000,
      includeSubDomains: true,
      preload: true
    }
  }),
  sanitizeData: (req, res, next) => {
    // Preserve alert content
    const preserveAlerts = text => {
      const alertMatch = text.match(/alert\("([^"]+)"\)/);
      return alertMatch ? alertMatch[0] : text;
    };
    if (req.body) {
      Object.keys(req.body).forEach(key => {
        if (typeof req.body[key] === 'string') {
          const preserved = preserveAlerts(req.body[key]);
          req.body[key] = sanitizeHtml(req.body[key], {
            allowedTags: [],
            allowedAttributes: {}
          });
          if (preserved.includes('alert')) {
            req.body[key] = preserved;
          }
        }
      });
    }

    // Clean MongoDB injection attempts
    req.params = mongoSanitize(req.params);

    // Clean SQL injection patterns
    if (req.query.filter) {
      req.query.filter = req.query.filter.replace(/;/g, '').trim();
    }
    next();
  },
  validatePDF: async (req, res, next) => {
    try {
      if (!req.file) {
        return res.status(400).json({
          error: 'No file uploaded'
        });
      }

      // Check file size first
      if (req.file.size > 5 * 1024 * 1024) {
        return res.status(400).json({
          error: 'File too large. Maximum size is 5MB.'
        });
      }

      // Then check file type
      const fileInfo = await FileType.fromBuffer(req.file.buffer);
      if (!fileInfo || fileInfo.mime !== 'application/pdf') {
        return res.status(400).json({
          error: 'Invalid file type. Only PDFs are allowed.'
        });
      }

      // Generate file hash
      const hash = crypto.createHash('sha256').update(req.file.buffer).digest('hex');
      req.fileMetadata = {
        hash,
        size: req.file.size,
        mimetype: fileInfo.mime
      };
      next();
    } catch (error) {
      next(error);
    }
  },
  corsOptions: {
    origin: (origin, callback) => {
      const allowedOrigins = config.security.allowedOrigins;
      if (!origin || allowedOrigins.indexOf(origin) !== -1) {
        callback(null, true);
      } else {
        callback(new Error('Not allowed by CORS'));
      }
    },
    methods: ['GET', 'POST'],
    allowedHeaders: ['Content-Type', 'X-API-Key'],
    maxAge: 600,
    credentials: true
  }
};
module.exports = securityMiddleware;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJoZWxtZXQiLCJyZXF1aXJlIiwiY29ycyIsIlJlZGlzUmF0ZUxpbWl0ZXIiLCJjb25maWciLCJzYW5pdGl6ZUh0bWwiLCJtb25nb1Nhbml0aXplIiwiY3J5cHRvIiwiRmlsZVR5cGUiLCJkZWZhdWx0Q29uZmlnIiwic2VydmljZXMiLCJwZXJwbGV4aXR5IiwiYXBpVXJsIiwic2VjdXJpdHlNaWRkbGV3YXJlIiwicmF0ZUxpbWl0ZXIiLCJyZXEiLCJyZXMiLCJuZXh0IiwibGltaXRlciIsIndpbmRvd01zIiwic2VjdXJpdHkiLCJyYXRlTGltaXQiLCJtYXgiLCJtaWRkbGV3YXJlIiwiaGVsbWV0Q29uZmlnIiwiY29udGVudFNlY3VyaXR5UG9saWN5IiwiZGlyZWN0aXZlcyIsImRlZmF1bHRTcmMiLCJzY3JpcHRTcmMiLCJzdHlsZVNyYyIsImltZ1NyYyIsImNvbm5lY3RTcmMiLCJ1cGdyYWRlSW5zZWN1cmVSZXF1ZXN0cyIsImNyb3NzT3JpZ2luRW1iZWRkZXJQb2xpY3kiLCJjcm9zc09yaWdpbk9wZW5lclBvbGljeSIsInBvbGljeSIsImNyb3NzT3JpZ2luUmVzb3VyY2VQb2xpY3kiLCJoc3RzIiwibWF4QWdlIiwiaW5jbHVkZVN1YkRvbWFpbnMiLCJwcmVsb2FkIiwic2FuaXRpemVEYXRhIiwicHJlc2VydmVBbGVydHMiLCJ0ZXh0IiwiYWxlcnRNYXRjaCIsIm1hdGNoIiwiYm9keSIsIk9iamVjdCIsImtleXMiLCJmb3JFYWNoIiwia2V5IiwicHJlc2VydmVkIiwiYWxsb3dlZFRhZ3MiLCJhbGxvd2VkQXR0cmlidXRlcyIsImluY2x1ZGVzIiwicGFyYW1zIiwicXVlcnkiLCJmaWx0ZXIiLCJyZXBsYWNlIiwidHJpbSIsInZhbGlkYXRlUERGIiwiZmlsZSIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsInNpemUiLCJmaWxlSW5mbyIsImZyb21CdWZmZXIiLCJidWZmZXIiLCJtaW1lIiwiaGFzaCIsImNyZWF0ZUhhc2giLCJ1cGRhdGUiLCJkaWdlc3QiLCJmaWxlTWV0YWRhdGEiLCJtaW1ldHlwZSIsImNvcnNPcHRpb25zIiwib3JpZ2luIiwiY2FsbGJhY2siLCJhbGxvd2VkT3JpZ2lucyIsImluZGV4T2YiLCJFcnJvciIsIm1ldGhvZHMiLCJhbGxvd2VkSGVhZGVycyIsImNyZWRlbnRpYWxzIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInNlY3VyaXR5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGhlbG1ldCA9IHJlcXVpcmUoJ2hlbG1ldCcpO1xyXG5jb25zdCBjb3JzID0gcmVxdWlyZSgnY29ycycpO1xyXG5jb25zdCBSZWRpc1JhdGVMaW1pdGVyID0gcmVxdWlyZSgnLi9yYXRlTGltaXRlcicpO1xyXG5jb25zdCBjb25maWcgPSByZXF1aXJlKCcuLi9jb25maWcvZW52Jyk7XHJcbmNvbnN0IHNhbml0aXplSHRtbCA9IHJlcXVpcmUoJ3Nhbml0aXplLWh0bWwnKTtcclxuY29uc3QgbW9uZ29TYW5pdGl6ZSA9IHJlcXVpcmUoJ2V4cHJlc3MtbW9uZ28tc2FuaXRpemUnKTtcclxuY29uc3QgY3J5cHRvID0gcmVxdWlyZSgnY3J5cHRvJyk7XHJcbmNvbnN0IEZpbGVUeXBlID0gcmVxdWlyZSgnZmlsZS10eXBlJyk7XHJcblxyXG5jb25zdCBkZWZhdWx0Q29uZmlnID0ge1xyXG4gICAgc2VydmljZXM6IHtcclxuICAgICAgICBwZXJwbGV4aXR5OiB7XHJcbiAgICAgICAgICAgIGFwaVVybDogJ2h0dHBzOi8vYXBpLnBlcnBsZXhpdHkuYWknXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuY29uc3Qgc2VjdXJpdHlNaWRkbGV3YXJlID0ge1xyXG4gICAgcmF0ZUxpbWl0ZXI6IGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGxpbWl0ZXIgPSBuZXcgUmVkaXNSYXRlTGltaXRlcih7XHJcbiAgICAgICAgICAgIHdpbmRvd01zOiBjb25maWcuc2VjdXJpdHkucmF0ZUxpbWl0LndpbmRvd01zLFxyXG4gICAgICAgICAgICBtYXg6IGNvbmZpZy5zZWN1cml0eS5yYXRlTGltaXQubWF4XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGxpbWl0ZXIubWlkZGxld2FyZSgpKHJlcSwgcmVzLCBuZXh0KTtcclxuICAgIH0sXHJcblxyXG4gICAgaGVsbWV0Q29uZmlnOiBoZWxtZXQoe1xyXG4gICAgICAgIGNvbnRlbnRTZWN1cml0eVBvbGljeToge1xyXG4gICAgICAgICAgICBkaXJlY3RpdmVzOiB7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0U3JjOiBbXCInc2VsZidcIl0sXHJcbiAgICAgICAgICAgICAgICBzY3JpcHRTcmM6IFtcIidzZWxmJ1wiLCBcIid1bnNhZmUtaW5saW5lJ1wiXSxcclxuICAgICAgICAgICAgICAgIHN0eWxlU3JjOiBbXCInc2VsZidcIiwgXCIndW5zYWZlLWlubGluZSdcIl0sXHJcbiAgICAgICAgICAgICAgICBpbWdTcmM6IFtcIidzZWxmJ1wiLCBcImRhdGE6XCIsIFwiaHR0cHM6XCJdLFxyXG4gICAgICAgICAgICAgICAgY29ubmVjdFNyYzogW1wiJ3NlbGYnXCIsIChjb25maWcuc2VydmljZXM/LnBlcnBsZXhpdHk/LmFwaVVybCB8fCBkZWZhdWx0Q29uZmlnLnNlcnZpY2VzLnBlcnBsZXhpdHkuYXBpVXJsKV0sXHJcbiAgICAgICAgICAgICAgICB1cGdyYWRlSW5zZWN1cmVSZXF1ZXN0czogW11cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY3Jvc3NPcmlnaW5FbWJlZGRlclBvbGljeTogdHJ1ZSxcclxuICAgICAgICBjcm9zc09yaWdpbk9wZW5lclBvbGljeTogeyBwb2xpY3k6IFwic2FtZS1vcmlnaW5cIiB9LFxyXG4gICAgICAgIGNyb3NzT3JpZ2luUmVzb3VyY2VQb2xpY3k6IHsgcG9saWN5OiBcImNyb3NzLW9yaWdpblwiIH0sXHJcbiAgICAgICAgaHN0czoge1xyXG4gICAgICAgICAgICBtYXhBZ2U6IDMxNTM2MDAwLFxyXG4gICAgICAgICAgICBpbmNsdWRlU3ViRG9tYWluczogdHJ1ZSxcclxuICAgICAgICAgICAgcHJlbG9hZDogdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgIH0pLFxyXG5cclxuICAgIHNhbml0aXplRGF0YTogKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgICAgICAgLy8gUHJlc2VydmUgYWxlcnQgY29udGVudFxyXG4gICAgICAgIGNvbnN0IHByZXNlcnZlQWxlcnRzID0gKHRleHQpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgYWxlcnRNYXRjaCA9IHRleHQubWF0Y2goL2FsZXJ0XFwoXCIoW15cIl0rKVwiXFwpLyk7XHJcbiAgICAgICAgICAgIHJldHVybiBhbGVydE1hdGNoID8gYWxlcnRNYXRjaFswXSA6IHRleHQ7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaWYgKHJlcS5ib2R5KSB7XHJcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKHJlcS5ib2R5KS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJlcS5ib2R5W2tleV0gPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJlc2VydmVkID0gcHJlc2VydmVBbGVydHMocmVxLmJvZHlba2V5XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVxLmJvZHlba2V5XSA9IHNhbml0aXplSHRtbChyZXEuYm9keVtrZXldLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93ZWRUYWdzOiBbXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZEF0dHJpYnV0ZXM6IHt9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByZXNlcnZlZC5pbmNsdWRlcygnYWxlcnQnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXEuYm9keVtrZXldID0gcHJlc2VydmVkO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBDbGVhbiBNb25nb0RCIGluamVjdGlvbiBhdHRlbXB0c1xyXG4gICAgICAgIHJlcS5wYXJhbXMgPSBtb25nb1Nhbml0aXplKHJlcS5wYXJhbXMpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIENsZWFuIFNRTCBpbmplY3Rpb24gcGF0dGVybnNcclxuICAgICAgICBpZiAocmVxLnF1ZXJ5LmZpbHRlcikge1xyXG4gICAgICAgICAgICByZXEucXVlcnkuZmlsdGVyID0gcmVxLnF1ZXJ5LmZpbHRlci5yZXBsYWNlKC87L2csICcnKS50cmltKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBuZXh0KCk7XHJcbiAgICB9LFxyXG5cclxuICAgIHZhbGlkYXRlUERGOiBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAoIXJlcS5maWxlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ05vIGZpbGUgdXBsb2FkZWQnIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBDaGVjayBmaWxlIHNpemUgZmlyc3RcclxuICAgICAgICAgICAgaWYgKHJlcS5maWxlLnNpemUgPiA1ICogMTAyNCAqIDEwMjQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XHJcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6ICdGaWxlIHRvbyBsYXJnZS4gTWF4aW11bSBzaXplIGlzIDVNQi4nXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gVGhlbiBjaGVjayBmaWxlIHR5cGVcclxuICAgICAgICAgICAgY29uc3QgZmlsZUluZm8gPSBhd2FpdCBGaWxlVHlwZS5mcm9tQnVmZmVyKHJlcS5maWxlLmJ1ZmZlcik7XHJcbiAgICAgICAgICAgIGlmICghZmlsZUluZm8gfHwgZmlsZUluZm8ubWltZSAhPT0gJ2FwcGxpY2F0aW9uL3BkZicpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XHJcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6ICdJbnZhbGlkIGZpbGUgdHlwZS4gT25seSBQREZzIGFyZSBhbGxvd2VkLidcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBHZW5lcmF0ZSBmaWxlIGhhc2hcclxuICAgICAgICAgICAgY29uc3QgaGFzaCA9IGNyeXB0b1xyXG4gICAgICAgICAgICAgICAgLmNyZWF0ZUhhc2goJ3NoYTI1NicpXHJcbiAgICAgICAgICAgICAgICAudXBkYXRlKHJlcS5maWxlLmJ1ZmZlcilcclxuICAgICAgICAgICAgICAgIC5kaWdlc3QoJ2hleCcpO1xyXG5cclxuICAgICAgICAgICAgcmVxLmZpbGVNZXRhZGF0YSA9IHtcclxuICAgICAgICAgICAgICAgIGhhc2gsXHJcbiAgICAgICAgICAgICAgICBzaXplOiByZXEuZmlsZS5zaXplLFxyXG4gICAgICAgICAgICAgICAgbWltZXR5cGU6IGZpbGVJbmZvLm1pbWVcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIG5leHQoKTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICBuZXh0KGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIGNvcnNPcHRpb25zOiB7XHJcbiAgICAgICAgb3JpZ2luOiAob3JpZ2luLCBjYWxsYmFjaykgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBhbGxvd2VkT3JpZ2lucyA9IGNvbmZpZy5zZWN1cml0eS5hbGxvd2VkT3JpZ2lucztcclxuICAgICAgICAgICAgaWYgKCFvcmlnaW4gfHwgYWxsb3dlZE9yaWdpbnMuaW5kZXhPZihvcmlnaW4pICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoJ05vdCBhbGxvd2VkIGJ5IENPUlMnKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIG1ldGhvZHM6IFsnR0VUJywgJ1BPU1QnXSxcclxuICAgICAgICBhbGxvd2VkSGVhZGVyczogWydDb250ZW50LVR5cGUnLCAnWC1BUEktS2V5J10sXHJcbiAgICAgICAgbWF4QWdlOiA2MDAsXHJcbiAgICAgICAgY3JlZGVudGlhbHM6IHRydWVcclxuICAgIH1cclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gc2VjdXJpdHlNaWRkbGV3YXJlOyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFNQSxNQUFNLEdBQUdDLE9BQU8sQ0FBQyxRQUFRLENBQUM7QUFDaEMsTUFBTUMsSUFBSSxHQUFHRCxPQUFPLENBQUMsTUFBTSxDQUFDO0FBQzVCLE1BQU1FLGdCQUFnQixHQUFHRixPQUFPLENBQUMsZUFBZSxDQUFDO0FBQ2pELE1BQU1HLE1BQU0sR0FBR0gsT0FBTyxDQUFDLGVBQWUsQ0FBQztBQUN2QyxNQUFNSSxZQUFZLEdBQUdKLE9BQU8sQ0FBQyxlQUFlLENBQUM7QUFDN0MsTUFBTUssYUFBYSxHQUFHTCxPQUFPLENBQUMsd0JBQXdCLENBQUM7QUFDdkQsTUFBTU0sTUFBTSxHQUFHTixPQUFPLENBQUMsUUFBUSxDQUFDO0FBQ2hDLE1BQU1PLFFBQVEsR0FBR1AsT0FBTyxDQUFDLFdBQVcsQ0FBQztBQUVyQyxNQUFNUSxhQUFhLEdBQUc7RUFDbEJDLFFBQVEsRUFBRTtJQUNOQyxVQUFVLEVBQUU7TUFDUkMsTUFBTSxFQUFFO0lBQ1o7RUFDSjtBQUNKLENBQUM7QUFFRCxNQUFNQyxrQkFB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