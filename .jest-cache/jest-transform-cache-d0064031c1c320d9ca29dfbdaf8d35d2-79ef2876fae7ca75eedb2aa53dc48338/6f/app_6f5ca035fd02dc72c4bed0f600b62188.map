{"version":3,"names":["express","require","cors","helmet","morgan","multer","path","requestLogger","errorHandler","docsRouter","analysisRouter","prometheusMiddleware","responseTime","monitoringRoutes","sanitizeRequest","rateLimiter","cacheService","healthCheck","statementRoutes","swaggerUI","swaggerSpec","app","upload","limits","fileSize","fileFilter","req","file","cb","extname","originalname","Error","use","origin","process","env","ALLOWED_ORIGINS","split","methods","allowedHeaders","middleware","json","limit","urlencoded","extended","compression","metricsPath","collectDefaultMetrics","requestDurationBuckets","get","serve","setup","single","err","res","next","console","error","stack","status","success","uploadsDir","join","__dirname","mkdirSync","recursive","startCleanup","module","exports"],"sources":["app.js"],"sourcesContent":["// This file configures the Express application, sets up middleware for parsing requests, and defines API routes.\n\nconst express = require('express');\nconst cors = require('cors');\nconst helmet = require('helmet');\nconst morgan = require('morgan');\nconst multer = require('multer');\nconst path = require('path');\nconst requestLogger = require('./middleware/requestLogger');\nconst errorHandler = require('./middleware/errorHandler');\nconst docsRouter = require('./routes/docs');\nconst analysisRouter = require('./routes/analysisRoutes');\nconst prometheusMiddleware = require('express-prometheus-middleware');\nconst responseTime = require('response-time');\nconst monitoringRoutes = require('./routes/monitoringRoutes');\nconst { sanitizeRequest } = require('./middleware/sanitizer');\nconst rateLimiter = require('./middleware/rateLimiter');\nconst cacheService = require('./services/cacheService');\nconst healthCheck = require('./middleware/healthCheck');\nconst statementRoutes = require('./routes/statementRoutes');\nconst swaggerUI = require('swagger-ui-express');\nconst swaggerSpec = require('./config/swagger');\n\nconst app = express();\nconst upload = multer({\n    limits: {\n        fileSize: 5 * 1024 * 1024 // 5MB limit\n    },\n    fileFilter: (req, file, cb) => {\n        if (path.extname(file.originalname) !== '.pdf') {\n            return cb(new Error('Only PDF files are allowed'));\n        }\n        cb(null, true);\n    }\n});\n\n// Security middleware\napp.use(helmet());\napp.use(cors({\n    origin: process.env.ALLOWED_ORIGINS?.split(',') || '*',\n    methods: ['GET', 'POST'],\n    allowedHeaders: ['Content-Type', 'Authorization']\n}));\napp.use(rateLimiter.middleware());\n\n// Request parsing & compression\napp.use(express.json({ limit: '1mb' }));\napp.use(express.urlencoded({ extended: true, limit: '1mb' }));\napp.use(sanitizeRequest);\napp.use(compression());\n\n// Logging and monitoring\napp.use(requestLogger);\napp.use(responseTime());\napp.use(prometheusMiddleware({\n    metricsPath: '/metrics',\n    collectDefaultMetrics: true,\n    requestDurationBuckets: [0.1, 0.5, 1, 2, 5]\n}));\napp.use(morgan('dev'));\n\n// Health and monitoring routes\napp.get('/health', healthCheck.middleware());\napp.use('/monitoring', monitoringRoutes);\n\n// API Documentation\napp.use('/api-docs', swaggerUI.serve, swaggerUI.setup(swaggerSpec));\n\n// API Routes with file upload\napp.use('/api/analysis', upload.single('bankStatement'), analysisRouter);\napp.use('/api/statements', statementRoutes);\n\n// Error handling\napp.use((err, req, res, next) => {\n    console.error(err.stack);\n    res.status(500).json({\n        success: false,\n        error: 'Internal Server Error'\n    });\n});\n\n// Create uploads directory if it doesn't exist\nconst uploadsDir = path.join(__dirname, '../uploads');\nrequire('fs').mkdirSync(uploadsDir, { recursive: true });\n\n// Initialize cache cleanup\ncacheService.startCleanup();\n\nmodule.exports = app;"],"mappings":";;AAAA;;AAEA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAS,CAAC;AAClC,MAAMC,IAAI,GAAGD,OAAO,CAAC,MAAM,CAAC;AAC5B,MAAME,MAAM,GAAGF,OAAO,CAAC,QAAQ,CAAC;AAChC,MAAMG,MAAM,GAAGH,OAAO,CAAC,QAAQ,CAAC;AAChC,MAAMI,MAAM,GAAGJ,OAAO,CAAC,QAAQ,CAAC;AAChC,MAAMK,IAAI,GAAGL,OAAO,CAAC,MAAM,CAAC;AAC5B,MAAMM,aAAa,GAAGN,OAAO,CAAC,4BAA4B,CAAC;AAC3D,MAAMO,YAAY,GAAGP,OAAO,CAAC,2BAA2B,CAAC;AACzD,MAAMQ,UAAU,GAAGR,OAAO,CAAC,eAAe,CAAC;AAC3C,MAAMS,cAAc,GAAGT,OAAO,CAAC,yBAAyB,CAAC;AACzD,MAAMU,oBAAoB,GAAGV,OAAO,CAAC,+BAA+B,CAAC;AACrE,MAAMW,YAAY,GAAGX,OAAO,CAAC,eAAe,CAAC;AAC7C,MAAMY,gBAAgB,GAAGZ,OAAO,CAAC,2BAA2B,CAAC;AAC7D,MAAM;EAAEa;AAAgB,CAAC,GAAGb,OAAO,CAAC,wBAAwB,CAAC;AAC7D,MAAMc,WAAW,GAAGd,OAAO,CAAC,0BAA0B,CAAC;AACvD,MAAMe,YAAY,GAAGf,OAAO,CAAC,yBAAyB,CAAC;AACvD,MAAMgB,WAAW,GAAGhB,OAAO,CAAC,0BAA0B,CAAC;AACvD,MAAMiB,eAAe,GAAGjB,OAAO,CAAC,0BAA0B,CAAC;AAC3D,MAAMkB,SAAS,GAAGlB,OAAO,CAAC,oBAAoB,CAAC;AAC/C,MAAMmB,WAAW,GAAGnB,OAAO,CAAC,kBAAkB,CAAC;AAE/C,MAAMoB,GAAG,GAAGrB,OAAO,CAAC,CAAC;AACrB,MAAMsB,MAAM,GAAGjB,MAAM,CAAC;EAClBkB,MAAM,EAAE;IACJC,QAAQ,EAAE,CAAC,GAAG,IAAI,GAAG,IAAI,CAAC;EAC9B,CAAC;EACDC,UAAU,EAAEA,CAACC,GAAG,EAAEC,IAAI,EAAEC,EAAE,KAAK;IAC3B,IAAItB,IAAI,CAACuB,OAAO,CAACF,IAAI,CAACG,YAAY,CAAC,KAAK,MAAM,EAAE;MAC5C,OAAOF,EAAE,CAAC,IAAIG,KAAK,CAAC,4BAA4B,CAAC,CAAC;IACtD;IACAH,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC;EAClB;AACJ,CAAC,CAAC;;AAEF;AACAP,GAAG,CAACW,GAAG,CAAC7B,MAAM,CAAC,CAAC,CAAC;AACjBkB,GAAG,CAACW,GAAG,CAAC9B,IAAI,CAAC;EACT+B,MAAM,EAAEC,OAAO,CAACC,GAAG,CAACC,eAAe,EAAEC,KAAK,CAAC,GAAG,CAAC,IAAI,GAAG;EACtDC,OAAO,EAAE,CAAC,KAAK,EAAE,MAAM,CAAC;EACxBC,cAAc,EAAE,CAAC,cAAc,EAAE,eAAe;AACpD,CAAC,CAAC,CAAC;AACHlB,GAAG,CAACW,GAAG,CAACjB,WAAW,CAACyB,UAAU,CAAC,CAAC,CAAC;;AAEjC;AACAnB,GAAG,CAACW,GAAG,CAAChC,OAAO,CAACyC,IAAI,CAAC;EAAEC,KAAK,EAAE;AAAM,CAAC,CAAC,CAAC;AACvCrB,GAAG,CAACW,GAAG,CAAChC,OAAO,CAAC2C,UAAU,CAAC;EAAEC,QAAQ,EAAE,IAAI;EAAEF,KAAK,EAAE;AAAM,CAAC,CAAC,CAAC;AAC7DrB,GAAG,CAACW,GAAG,CAAClB,eAAe,CAAC;AACxBO,GAAG,CAACW,GAAG,CAACa,WAAW,CAAC,CAAC,CAAC;;AAEtB;AACAxB,GAAG,CAACW,GAAG,CAACzB,aAAa,CAAC;AACtBc,GAAG,CAACW,GAAG,CAACpB,YAAY,CAAC,CAAC,CAAC;AACvBS,GAAG,CAACW,GAAG,CAACrB,oBAAoB,CAAC;EACzBmC,WAAW,EAAE,UAAU;EACvBC,qBAAqB,EAAE,IAAI;EAC3BC,sBAAsB,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;AAC9C,CAAC,CAAC,CAAC;AACH3B,GAAG,CAACW,GAAG,CAAC5B,MAAM,CAAC,KAAK,CAAC,CAAC;;AAEtB;AACAiB,GAAG,CAAC4B,GAAG,CAAC,SAAS,EAAEhC,WAAW,CAACuB,UAAU,CAAC,CAAC,CAAC;AAC5CnB,GAAG,CAACW,GAAG,CAAC,aAAa,EAAEnB,gBAAgB,CAAC;;AAExC;AACAQ,GAAG,CAACW,GAAG,CAAC,WAAW,EAAEb,SAAS,CAAC+B,KAAK,EAAE/B,SAAS,CAACgC,KAAK,CAAC/B,WAAW,CAAC,CAAC;;AAEnE;AACAC,GAAG,CAACW,GAAG,CAAC,eAAe,EAAEV,MAAM,CAAC8B,MAAM,CAAC,eAAe,CAAC,EAAE1C,cAAc,CAAC;AACxEW,GAAG,CAACW,GAAG,CAAC,iBAAiB,EAAEd,eAAe,CAAC;;AAE3C;AACAG,GAAG,CAACW,GAAG,CAAC,CAACqB,GAAG,EAAE3B,GAAG,EAAE4B,GAAG,EAAEC,IAAI,KAAK;EAC7BC,OAAO,CAACC,KAAK,CAACJ,GAAG,CAACK,KAAK,CAAC;EACxBJ,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAAClB,IAAI,CAAC;IACjBmB,OAAO,EAAE,KAAK;IACdH,KAAK,EAAE;EACX,CAAC,CAAC;AACN,CAAC,CAAC;;AAEF;AACA,MAAMI,UAAU,GAAGvD,IAAI,CAACwD,IAAI,CAACC,SAAS,EAAE,YAAY,CAAC;AACrD9D,OAAO,CAAC,IAAI,CAAC,CAAC+D,SAAS,CAACH,UAAU,EAAE;EAAEI,SAAS,EAAE;AAAK,CAAC,CAAC;;AAExD;AACAjD,YAAY,CAACkD,YAAY,CAAC,CAAC;AAE3BC,MAAM,CAACC,OAAO,GAAG/C,GAAG","ignoreList":[]}