{"version":3,"names":["mongoose","require","MongoMemoryServer","winston","logger","createLogger","level","transports","Console","format","simple","mongoServer","setupTestDatabase","disconnect","create","mongoUri","getUri","connect","info","error","cleanupTestDatabase","connection","readyState","dropDatabase","stop","module","exports"],"sources":["testDb.js"],"sourcesContent":["const mongoose = require('mongoose');\r\nconst { MongoMemoryServer } = require('mongodb-memory-server');\r\nconst winston = require('winston');\r\n\r\nconst logger = winston.createLogger({\r\n    level: 'error',\r\n    transports: [\r\n        new winston.transports.Console({\r\n            format: winston.format.simple()\r\n        })\r\n    ]\r\n});\r\n\r\nlet mongoServer;\r\n\r\nconst setupTestDatabase = async () => {\r\n    try {\r\n        // Close existing connections\r\n        await mongoose.disconnect();\r\n        \r\n        // Create new server instance\r\n        mongoServer = await MongoMemoryServer.create();\r\n        const mongoUri = mongoServer.getUri();\r\n        \r\n        // Connect to the in-memory database\r\n        await mongoose.connect(mongoUri);\r\n        \r\n        logger.info('Test database connected');\r\n    } catch (error) {\r\n        logger.error('Test database setup failed:', error);\r\n        throw error;\r\n    }\r\n};\r\n\r\nconst cleanupTestDatabase = async () => {\r\n    try {\r\n        // Only cleanup if we have an active connection\r\n        if (mongoose.connection.readyState !== 0) {\r\n            await mongoose.connection.dropDatabase();\r\n            await mongoose.disconnect();\r\n        }\r\n        \r\n        // Stop the in-memory server\r\n        if (mongoServer) {\r\n            await mongoServer.stop();\r\n            mongoServer = null;\r\n        }\r\n        \r\n        logger.info('Test database cleanup completed');\r\n    } catch (error) {\r\n        logger.error('Test database cleanup failed:', error);\r\n        throw error;\r\n    }\r\n};\r\n\r\nmodule.exports = {\r\n    setupTestDatabase,\r\n    cleanupTestDatabase\r\n};"],"mappings":";;AAAA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAU,CAAC;AACpC,MAAM;EAAEC;AAAkB,CAAC,GAAGD,OAAO,CAAC,uBAAuB,CAAC;AAC9D,MAAME,OAAO,GAAGF,OAAO,CAAC,SAAS,CAAC;AAElC,MAAMG,MAAM,GAAGD,OAAO,CAACE,YAAY,CAAC;EAChCC,KAAK,EAAE,OAAO;EACdC,UAAU,EAAE,CACR,IAAIJ,OAAO,CAACI,UAAU,CAACC,OAAO,CAAC;IAC3BC,MAAM,EAAEN,OAAO,CAACM,MAAM,CAACC,MAAM,CAAC;EAClC,CAAC,CAAC;AAEV,CAAC,CAAC;AAEF,IAAIC,WAAW;AAEf,MAAMC,iBAAiB,GAAG,MAAAA,CAAA,KAAY;EAClC,IAAI;IACA;IACA,MAAMZ,QAAQ,CAACa,UAAU,CAAC,CAAC;;IAE3B;IACAF,WAAW,GAAG,MAAMT,iBAAiB,CAACY,MAAM,CAAC,CAAC;IAC9C,MAAMC,QAAQ,GAAGJ,WAAW,CAACK,MAAM,CAAC,CAAC;;IAErC;IACA,MAAMhB,QAAQ,CAACiB,OAAO,CAACF,QAAQ,CAAC;IAEhCX,MAAM,CAACc,IAAI,CAAC,yBAAyB,CAAC;EAC1C,CAAC,CAAC,OAAOC,KAAK,EAAE;IACZf,MAAM,CAACe,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;IAClD,MAAMA,KAAK;EACf;AACJ,CAAC;AAED,MAAMC,mBAAmB,GAAG,MAAAA,CAAA,KAAY;EACpC,IAAI;IACA;IACA,IAAIpB,QAAQ,CAACqB,UAAU,CAACC,UAAU,KAAK,CAAC,EAAE;MACtC,MAAMtB,QAAQ,CAACqB,UAAU,CAACE,YAAY,CAAC,CAAC;MACxC,MAAMvB,QAAQ,CAACa,UAAU,CAAC,CAAC;IAC/B;;IAEA;IACA,IAAIF,WAAW,EAAE;MACb,MAAMA,WAAW,CAACa,IAAI,CAAC,CAAC;MACxBb,WAAW,GAAG,IAAI;IACtB;IAEAP,MAAM,CAACc,IAAI,CAAC,iCAAiC,CAAC;EAClD,CAAC,CAAC,OAAOC,KAAK,EAAE;IACZf,MAAM,CAACe,KAAK,CAAC,+BAA+B,EAAEA,KAAK,CAAC;IACpD,MAAMA,KAAK;EACf;AACJ,CAAC;AAEDM,MAAM,CAACC,OAAO,GAAG;EACbd,iBAAiB;EACjBQ;AACJ,CAAC","ignoreList":[]}